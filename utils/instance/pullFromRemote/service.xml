<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="a6be72f61bcd4e1a823d42f8e64418c4"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			disabled="false"
			id="ad71c62d423a4ccbb009b4fa0ebd2b23"
			lineNumber="2"
			query="input/metadataOnly">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="dc6a0e63c17a4039af6ecd8c7ed17299"
				label="true"
				lineNumber="3">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="379f28411843415895a72fec1e58b6fa"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>pull-meta</from>
				<to>direction</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="8362145ce47b4ca6ba7e4d7270fb8aac"
				lineNumber="4">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="aa967be87ec3464da29778c43203126d"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>pull</from>
				<to>direction</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get the latest content for the cdm instance"
			disabled="false"
			id="90666d38fdfa457582085830687ee690"
			lineNumber="5">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="62bc4a2f5e8b4276ad909f3bfab1a518"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceContent.services.list"
				resultName="result73d08e58afc14b1bb13c4bebd910fc19"
				temporaryMapping="true"
				x="30"
				y="30"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="99d3f26244fa40679d7841d284081fc4"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>filter/cdmInstanceId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="77d8e8f40fb84bd8a2385122f311e601"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>filter/active</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="f05c810ff96d48e6b7f6951cbca9e619"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result73d08e58afc14b1bb13c4bebd910fc19/results[0]</from>
			<to>currentContent</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="7881e167effa466dacd24d207de064fd"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceExternalId.services.list"
				resultName="resultc2873d5da9474f8c99944f8a9583ae84"
				temporaryMapping="true"
				x="117"
				y="166"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="77c58de785764ea881a9d631fdd6c5ec"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>filter/cdmInstanceId[0]</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="ed6669755265403e98756bb5771cd045"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result73d08e58afc14b1bb13c4bebd910fc19/results[0]/typeId</from>
			<to>typeId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="ad8783b61e5143d4bec9d75230ceeecc"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultc2873d5da9474f8c99944f8a9583ae84/results</from>
			<to>output/externalIds</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get all active relations"
			disabled="false"
			id="b15e56c8c96a4f10934a8481b447c8dc"
			lineNumber="6">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="0dd76794d96e41cd81e2e6e4f2bd7273"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceRelation.services.list"
				resultName="result9fcad811ad5743d9a0848f060ca00eda"
				temporaryMapping="true"
				x="185"
				y="80"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d0bbeeb153694475a7342798c0569e83"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>filter/sourceId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ad17531b81f7431ab4f9b2ae8deba98e"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>filter/active</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="0b56e12022dd431192e4fdd856d9d9a3"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result9fcad811ad5743d9a0848f060ca00eda/results</from>
			<to>allExistingRelations</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get the instance"
			disabled="false"
			id="c5ff5a68616143c6830bbce5ec6b2466"
			lineNumber="7">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="e65dd5ad3ebe4496948f1095e20980d0"
				serviceId="nabu.frameworks.cdm.crud.cdmInstance.services.get"
				resultName="result21b9f7e910474dd6b8ef375ec73d0ea2"
				temporaryMapping="true"
				x="96"
				y="85"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="71e61becfa0a480b8ab9eb2b5bd5f984"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>id</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="4520773d0daf4d06983a24c884a56f6f"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result21b9f7e910474dd6b8ef375ec73d0ea2/result</from>
			<to>instance</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6c8bf8f9865a469489039b6358b4affb"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result21b9f7e910474dd6b8ef375ec73d0ea2/result/typeId</from>
			<to>typeId</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			disabled="false"
			id="3a33073a471f4c24be2b92704d354635"
			lineNumber="8">
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="If it's new, there might not be content yet, create an empty object"
				disabled="false"
				id="a0600641d1704133b9236689acaf61a3"
				label="!currentContent"
				lineNumber="9">
			<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
					disabled="false"
					id="1b6d815c9e224c77aecb689d0e94fc8c"
					label="!instance"
					lineNumber="10"
					message="Instance does not exist"
					whitelist="false" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Get the primary key field"
					disabled="false"
					id="a9f64c5c828d44c78d2b5483a9f2cd13"
					lineNumber="11">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="548feac846aa48378ea7574b2aec06de"
						serviceId="nabu.utils.reflection.Type.describe"
						resultName="resultdb736c3440914c05a309592c241c9346"
						temporaryMapping="true"
						x="151"
						y="223"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="630e58d4ef4e4c02899e83a21a00283a"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instance/typeId</from>
						<to>typeId</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="94a99e06a09b4496b521291982f452ca"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultdb736c3440914c05a309592c241c9346/parameters[primary == true]</from>
					<to>primaryKeyField</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
					description="=&quot;Could not find primary key field for: &quot; + instance/typeId"
					disabled="false"
					id="6a66cea23b7e4ee987eb41dde793d8ae"
					label="!primaryKeyField"
					lineNumber="12"
					message="Could not find primary key field"
					whitelist="false" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Instantiate actual instance"
					disabled="false"
					id="2412ffda96fc4c80aa671a4f72ae64c8"
					lineNumber="13">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="c2da96960e81489f978ae5d9f08225b0"
						serviceId="nabu.utils.reflection.Type.newInstance"
						resultName="result9173699ddf954da2a058b99a2ed761a9"
						temporaryMapping="true"
						x="205"
						y="83"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0aa6a2b01eb14ab8b8bbb0c6e47e9ab7"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instance/typeId</from>
						<to>typeId</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d66cc7ec03b44889a12acb0a39240001"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result9173699ddf954da2a058b99a2ed761a9/typeInstance</from>
					<to>cdmInstance</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Set the primary key value"
					disabled="false"
					id="420542037dc345d8bb51c348741367ef"
					lineNumber="14">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="04962b59a0e94ea686a65e731d9a4697"
						serviceId="nabu.utils.reflection.Type.set"
						resultName="result787e3899081549eaaa974580ffcbdd1b"
						temporaryMapping="true"
						x="252"
						y="151"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="41e4d5f8198e4ecb87a45fa35dc21df6"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>cdmInstance</from>
						<to>typeInstance</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="f07fd94cefc24079a767e557a73c74c5"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>primaryKeyField/name</from>
						<to>path</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e6cc208149fd4ec580c9af46fe630599"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/cdmInstanceId</from>
						<to>value</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="76e9b8e16b9949cc8c4d07b7ad9d8cec"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>1</from>
					<to>newVersion</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Set the booleans to maximize the data gathering for an initial sync"
					disabled="false"
					features="!CDM_SKIP_SMART_MERGE"
					id="0b1f0f2957184b7f82594238640def4d"
					lineNumber="15">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="bc34f7698ce94ad08ac68079f6d47eaf"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>input/skipNulls</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8b265d2c797c45cda567ec5e030e7984"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>input/skipMaster</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="2e823d7c11a74f5eb9a80f6f71745217"
				lineNumber="16">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="65e1782b8a2c4d669e35fe94fb1c4f10"
					serviceId="nabu.data.json.Services.unmarshal"
					resultName="resultb6de630b8c3d4d8e80a11ea1a75998f6"
					temporaryMapping="true"
					x="413"
					y="180"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f6b33e181f6a441284071c88d2e6c724"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>currentContent/typeId</from>
					<to>type</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="97c7cc77450e4b12b702d7bce5222df1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result74bf8adf698c47ff8d286e0a9eba57bb/stream</from>
					<to>input</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="bbde68ac89a74c0f835a2b4cd9d40840"
					serviceId="nabu.utils.String.toStream"
					resultName="result74bf8adf698c47ff8d286e0a9eba57bb"
					temporaryMapping="true"
					x="41"
					y="184"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="154586f4d5b645b299bffe980101e153"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>currentContent/content</from>
					<to>string</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="e9ce0c8f4afd4fa3baebfa8f705139a2"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>UTF-8</from>
					<to>charset</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="c7d0b8aa02f344a4a46581b4dd908d82"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultb6de630b8c3d4d8e80a11ea1a75998f6/unmarshalled</from>
				<to>cdmInstance</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="6e590d8ea0b647689e925924f7dd1e10"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>=currentContent/version + 1</from>
				<to>newVersion</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get all subscriptions for this type and the given systems"
			disabled="false"
			id="c8ccf6bdc27743508a92e605636ff0b3"
			lineNumber="17">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="73513eacb34c4f169d3d17bc3a82ed7e"
				serviceId="nabu.frameworks.cdm.crud.cdmSystemSubscription.services.list"
				resultName="result14d39a25b63b47b59f630d390f770a62"
				temporaryMapping="true"
				x="273"
				y="104"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="4837402007dd4ab9851a4e39bcf76137"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/system</from>
				<to>filter/system</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="1cbbd250f4fb429aa4cf4d470c999107"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>typeId</from>
				<to>filter/coreTypeId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ceda20ef5a6048cfae0a74b39c5a87ef"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>priority</from>
				<to>orderBy[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="9f1e1d91fbac4f519a0cb0bf4b3531e5"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>filter/hasPull</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="630b28f3b9ba4054abeb25e960a61985"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/notSystem</from>
				<to>filter/notSystem</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="385c1cd3ea834d3bb69a5633dbcb179a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result14d39a25b63b47b59f630d390f770a62/results</from>
			<to>subscriptions</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="2a5108cdd6bf42099a8ef95431609590"
				serviceId="nabu.utils.Date.now"
				resultName="resultb98124df50ce453394418aa94b184c9c"
				temporaryMapping="true"
				x="262"
				y="230"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="ccc575e968c34b069303bd5678e3cf16"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultb98124df50ce453394418aa94b184c9c/date</from>
			<to>date</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="cc87666564d04411bba89794efe06503"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultb98124df50ce453394418aa94b184c9c/date</from>
			<to>instanceSync/started</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="4a3f6502cd5642d18a8f33938710fe11"
				serviceId="nabu.utils.Server.uuid"
				resultName="resultd75d8599fcb649b8ac78c2e1e5d9bdcb"
				temporaryMapping="true"
				x="347"
				y="359"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="9247db8725eb4e97be9ac60948ecaafd"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultd75d8599fcb649b8ac78c2e1e5d9bdcb/uuid</from>
			<to>instanceSync/id</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="0b42c3e3353f49a4b0358d7ee2310c3b"
				serviceId="nabu.utils.Runtime.getCurrentToken"
				resultName="resultbc208c33e6354443928c5cd2122e06d1"
				temporaryMapping="true"
				x="350"
				y="497"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="91d3d6b760e44ce29f38e847352093be"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultbc208c33e6354443928c5cd2122e06d1/token/authenticationId</from>
			<to>instanceSync/actorId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="ad29d06160184a288f95071757c0245b"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>input/cdmInstanceId</from>
			<to>instanceSync/cdmInstanceId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="e292b0f2293049c49e99e28fae54ca9c"
				serviceId="nabu.utils.Runtime.getCorrelationId"
				resultName="result780b6434f7bc4abcb877550337176dd6"
				temporaryMapping="true"
				x="427"
				y="568"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="16a43cfbd6704925838f8b101390d385"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result780b6434f7bc4abcb877550337176dd6/correlationId</from>
			<to>instanceSync/correlationId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="26977242a4704f43b47772cdd68f739a"
				serviceId="nabu.utils.Server.getServerName"
				resultName="result61825099215f49848d5ce74dcad5ce21"
				temporaryMapping="true"
				x="755"
				y="565"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="4e41705c84384e4fa6be1f9de11d79bf"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result61825099215f49848d5ce74dcad5ce21/server</from>
			<to>instanceSync/server</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="03a7380f562744f4a15f83f5e272f09b"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>input/source</from>
			<to>instanceSync/source</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="8255f6a56b2e4f3d8c799cb1b95b27a0"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result14d39a25b63b47b59f630d390f770a62/results/system</from>
			<to>output/systems</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="01c4ad18cd3941a98c0a35bb4112b875"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>direction</from>
			<to>instanceSync/direction</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Break"
			disabled="false"
			id="6a05b09fbc7743048fff7dcd421067af"
			label="!subscriptions"
			lineNumber="18">
		<count>1</count>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="If we haven't resolved it yet, get the primary key field"
			disabled="false"
			id="221bf163756f42f08d4d9246990f3f40"
			label="!primaryKeyField"
			lineNumber="19">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="e9aa2425759043aa9d223565b6e7d0a9"
				serviceId="nabu.utils.reflection.Type.describe"
				resultName="resultdb736c3440914c05a309592c241c9346"
				temporaryMapping="true"
				x="151"
				y="223"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="eec3c3a3cda44d5fb7dae03650b65e48"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>instance/typeId</from>
				<to>typeId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="c6eea258eab64068936056a714f26160"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultdb736c3440914c05a309592c241c9346/parameters[primary == true]</from>
			<to>primaryKeyField</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get all the subscription instances for this particular cdm instance. We also need a stable date for later comparison to prevent additional unnecessary pulls."
			disabled="false"
			id="efb62d4736974efcac77f27272e3714e"
			label="subscriptions"
			lineNumber="20">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="545d483814e4494fae07d55ba605dc8e"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceSubscription.services.list"
				resultName="result7c52ecd25d5b4ac49e870950883b2d12"
				temporaryMapping="true"
				x="170"
				y="75"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="7b3e865a1b7e4aa39fedfc5981cb588b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>subscriptions/id</from>
				<to>filter/cdmSubscriptionId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="2d8cc6ccbc05470697de49e10f9d6a5b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>filter/cdmInstanceId[0]</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="99d143abf29d4ec28680c5656e525599"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result7c52ecd25d5b4ac49e870950883b2d12/results</from>
			<to>instanceSubscriptions</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.For"
			disabled="false"
			id="f13795a754bb45e68937444d97840789"
			lineNumber="21"
			variable="subscription">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Drop master documents"
				disabled="false"
				id="4cfcdf72e4664a1ca880111d28e395e3"
				label="input/skipMaster"
				lineNumber="22">
			<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
					disabled="false"
					id="1129b5efb090404fa581f34f8da5e11e"
					path="subscription/initialMasterTypeId" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
					disabled="false"
					id="ab77bf87bc0a41e7b54f756d6cb6acf5"
					path="subscription/masterTypeId" xsi:nil="true"/>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="If we have no pull interval, set to 5 minutes. By default we don't want to overpoll systems and want to be able to push content. You can manually set it lower if necessary"
				disabled="false"
				features="CDM_DEFAULT_PULL_INTERVAL"
				id="6aec5f1e3d8941c0bcd019ff826cfc61"
				label="subscription/pullInterval == null"
				lineNumber="23">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="361e923c94e64edeae23070c7f414591"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>PT5M</from>
				<to>subscription/pullInterval</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get the current instance subscription and the correct relations"
				disabled="false"
				id="6b69e25f25b348cd81d7661da8f30231"
				lineNumber="24">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="269cbf1b43394045baf081894df4f742"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>instanceSubscriptions[cdmSubscriptionId == /subscription/id]</from>
				<to>instanceSubscription</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="961e60ce436a412e8742e656c0130b1a"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>allExistingRelations[cdmSystemSubscriptionId == /subscription/id]</from>
				<to>existingRelations</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="e6df6dc195b745f284b23aea9ff60d50"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>pull</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Break"
				comment="Deleted in the target system"
				disabled="false"
				id="2809d46e91c0463eba7d91f9354061c2"
				label="instanceSubscription/decoupled != null"
				lineNumber="25">
			<count>1</count>
			<continueExecution>true</continueExecution>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				disabled="false"
				id="bc599c60079a4aed86524534c4e5013a"
				label="input/force != true &amp;&amp; subscription/pullInterval != null &amp;&amp; instanceSubscription/pulled != null"
				lineNumber="26">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="9258387d4d10487aa017dd86a04e527d"
					lineNumber="27">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="f1090a14e6a446e69e12b9bf2d590a15"
						serviceId="nabu.utils.Date.incrementDuration"
						resultName="resultf6bfd6b8195c4b1cb2015a69fe300dbb"
						temporaryMapping="true"
						x="188"
						y="125"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="75a4fefd5fd346b6b2fe94c362a95f4a"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/pullInterval</from>
						<to>duration</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="091c1d5361924681aff7b422efb68073"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instanceSubscription/pulled</from>
						<to>start</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="516422cb825f422f9f1bbed7c3f033a3"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultf6bfd6b8195c4b1cb2015a69fe300dbb/date</from>
					<to>earliestNextPull</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Set pull to false if we are not yet at the window"
					disabled="false"
					id="793cb7db41eb45f7a8609b1c3ef2c6b3"
					lineNumber="28">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="90e11df37ab243038427933c06224c21"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>=date &gt;= earliestNextPull</from>
					<to>pull</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Break"
					comment="If we pulled in the past and its not decoupled, we _should_ have content? If we don't, skip"
					disabled="false"
					id="124ef618cfd44c8995d8a1343ac67384"
					label="!pull &amp;&amp; instanceSubscription/content == null"
					lineNumber="29">
				<count>2</count>
				<continueExecution>true</continueExecution>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Check that we don't need to skip it"
				disabled="false"
				id="3aac6e8f3bd64460be4d7cb7421dd813"
				label="input/skipPullForSystem != null &amp;&amp; pull"
				lineNumber="30">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="710282f30cfb48229b9f513ebce17e16"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>=subscription/system !# /input/skipPullForSystem</from>
				<to>pull</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Break"
				comment="We have determined that we don't want to pull but there is no content, nothing to see here."
				disabled="false"
				id="d54bb2e57772456aa6228ce12d685c23"
				label="instanceSubscription/content == null &amp;&amp; !pull"
				lineNumber="31">
			<count>1</count>
			<continueExecution>true</continueExecution>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				disabled="false"
				id="9f68ee8130824789bdf568d5fabfb05b"
				lineNumber="32"
				query="pull">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Get the remote data"
					disabled="false"
					id="ac704f8c0222464e8cb8d14d2fdbe72a"
					label="true"
					lineNumber="33">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="24e337cca52f47549755a227099c7aec"
						serviceId="nabu.frameworks.cdm.specs.pull"
						resultName="result3b05240074894973ab337e9b7f531fab"
						temporaryMapping="true"
						x="98"
						y="69"
						invocationOrder="2"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="b2cd1b114ccf48b899b9f4840e820420"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instance/id</from>
						<to>cdmInstanceId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="827f323986d74370981bbea10e101b64"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>output/externalIds</from>
						<to>externalIds</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="77a57eac1670456980f8cce0419bfa97"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/pullId</from>
						<to>implementationId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="32833dc710704ab0aaf01ae4debccac3"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>existingRelations</from>
						<to>relations</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="622c82dd252b4934b9a0137d93528412"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result3b05240074894973ab337e9b7f531fab/cdmInstance</from>
					<to>partialInstance</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="3601b7d9443046dfae9cb7210380edf0"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result3b05240074894973ab337e9b7f531fab/externalIds</from>
					<to>newExternalIds</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="2108bdfa46ca4a8ba74a599de8dd84f5"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result3b05240074894973ab337e9b7f531fab/externalIds</from>
					<to>newExternalIds</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="0e54e32889f242dca72877cc545364f2"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result3b05240074894973ab337e9b7f531fab/relations</from>
					<to>newRelations</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Otherwise, we take the previous version"
					disabled="false"
					id="16f7034d51ec4930bf46983b6d7d085d"
					lineNumber="34">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="0a5c595e57554f00a4fa250c9cd8d264"
						serviceId="nabu.data.json.Services.unmarshal"
						resultName="resulteab9fe33598a40ffa1d83c088ab209bb"
						temporaryMapping="true"
						x="635"
						y="120"
						invocationOrder="1"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e833cfa614e54c95aa3c300415af6bee"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultee9bcb56784044abac626c8aff7e0395/stream</from>
						<to>input</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="97ba6174cf794b458004ff7e484dc0be"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultd50cf8e1e04d48b38074370a49f0c432/first</from>
						<to>type</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="6749e65374b64b01b248b7770e6bfd8e"
						serviceId="nabu.utils.String.toStream"
						resultName="resultee9bcb56784044abac626c8aff7e0395"
						temporaryMapping="true"
						x="62"
						y="88"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d130e9d585ae4f25b6909faf7967d578"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instanceSubscription/content</from>
						<to>string</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a9b59ff8da8f4864b9a4fe3e8eac43f6"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>UTF-8</from>
						<to>charset</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="638ca002049349b1b51fb3a3fcc836d7"
						serviceId="nabu.utils.Object.first"
						resultName="resultd50cf8e1e04d48b38074370a49f0c432"
						temporaryMapping="true"
						x="80"
						y="298"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e294315eb27e4bc5848f22bedb5a5591"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/typeId</from>
						<to>options[0]</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="68ddf774e77d4a3c91db6d2b3a6b304e"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/coreTypeId</from>
						<to>options[1]</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="44300ee7d7a9450a9b91418eb68dc193"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resulteab9fe33598a40ffa1d83c088ab209bb/unmarshalled</from>
					<to>partialInstance</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Update the ids"
				disabled="false"
				id="85b3245ea4094a81be16363511293e35"
				label="newExternalIds"
				lineNumber="35">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="6cf7e93e611e4992b036a591cfde2745"
					serviceId="nabu.frameworks.cdm.utils.externalId.update"
					resultName="result35cf43d44d4343a393614080fe7f194e"
					temporaryMapping="true"
					x="170"
					y="85"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="964472ec7f674609956afb0468b8a211"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/cdmInstanceId</from>
					<to>cdmInstanceId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="dbc4c19f291f46cd99ab31038c93a345"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>output/externalIds</from>
					<to>existingExternalIds</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="0508f1ac7976489da0addf480f2ad304"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>newExternalIds</from>
					<to>newExternalIds</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1e0c3b227b354538918b351d8d5f8bfc"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>instanceSubscription/id</from>
					<to>cdmInstanceSubscription</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="7356ec516294430c866ebc31d39dc6fa"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>instanceSync/id</from>
					<to>cdmInstanceSyncId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="5544fe5ffdcc4f2dbc316b1064528b1b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result35cf43d44d4343a393614080fe7f194e/externalIds</from>
				<to>output/externalIds</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="c05dacf7035a46ac87dca002c51a1a7f"
					serviceId="nabu.utils.List.addAll"
					resultName="result05d891f177154dd0bd17dc4df415ccac"
					temporaryMapping="true"
					x="765"
					y="387"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="e94ee129287749bb8fa6a10c449f12a1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result35cf43d44d4343a393614080fe7f194e/logs</from>
					<to>objects</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="9542a0e9096442f5baed8304e8bbb607"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>logs</from>
					<to>list</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="dfbc0ecdec97492c9bca0ad93293938b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result05d891f177154dd0bd17dc4df415ccac/list</from>
				<to>logs</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="If we have no partial instance, we can't do much"
				disabled="false"
				id="a4db5ca168674268a8c8219d6fcade3c"
				label="partialInstance == null"
				lineNumber="36">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="If we had content before but now don't have any, we decouple it"
					disabled="false"
					id="3cfcfbde83e449e3b50e63c219bf369b"
					label="instanceSubscription/content != null"
					lineNumber="37">
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="d5030fea32204fba9270581003bb92f6"
						path="instanceSubscription/content" xsi:nil="true"/>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6a7707a8ab9c4cec9b50ab1c321e25b4"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>date</from>
					<to>instanceSubscription/decoupled</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Break"
					comment="Continue with the next"
					disabled="false"
					id="55da7c7b91844332980b9a2d1fb420f9"
					lineNumber="38">
				<count>2</count>
				<continueExecution>true</continueExecution>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="Only update our system if we actually pulled data"
				disabled="false"
				id="ecc2413c983c4363853e6ffe1e545fe2"
				label="pull"
				lineNumber="39">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Update relations"
					disabled="false"
					id="c2b53ccdfb474501a48645a543e46f59"
					lineNumber="40">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="664c01d6f53a4eea83b358a8ac3c1239"
						serviceId="nabu.frameworks.cdm.utils.relation.update"
						resultName="resultcbc069f97a48421e92d2a498d3017a60"
						temporaryMapping="true"
						x="206"
						y="85"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d054bd29ddcc4ff88ceb3c183b3bdfe2"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instance/id</from>
						<to>cdmInstanceId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="59e7432867df439d9f8978fccd4d4f34"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>newRelations</from>
						<to>newRelations</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="10cb6dc62d9a422693277867bec51c26"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>existingRelations</from>
						<to>existingRelations</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e459e3169a42496680ef84de3b707fc0"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instance/cdmDefinitionId</from>
						<to>cdmDefinitionId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="6f1fc09f987c447a9e4014fe0019a8df"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/id</from>
						<to>cdmSystemSubscriptionId</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6b431af050e2458ebebd28c2a4beb715"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultcbc069f97a48421e92d2a498d3017a60/existingRelations</from>
					<to>existingRelations</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Marshal the data"
					disabled="false"
					id="6da1d7bd11d24dc7b48af06171d9b9b3"
					lineNumber="41">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="12a67a5197f945468f682d8f4f7b73d8"
						serviceId="nabu.data.json.Services.marshal"
						resultName="result87860471066f473ba7a4320337676d7f"
						temporaryMapping="true"
						x="55"
						y="124"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a358ceda9e464a92a4d85a5d905edbeb"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>partialInstance</from>
						<to>data</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a2bce7014e234c328758ed98d4041f38"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>UTF-8</from>
						<to>charset</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="dc07d28c871049268001eceef4250223"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>true</from>
						<to>prettyPrint</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="d78efc01868643629738e94c1dab0d8a"
						serviceId="nabu.utils.Stream.toString"
						resultName="result31d38b2b989847e0932c9f0da6d02305"
						temporaryMapping="true"
						x="473"
						y="184"
						invocationOrder="1"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="6c11a1c2ed07491f8609d95f3ea8426e"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result87860471066f473ba7a4320337676d7f/marshalled</from>
						<to>stream</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="b35ff9682f05460fb8460efd3cdcc3e9"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>UTF-8</from>
						<to>charset</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="2048144c25d744b9887b92e82d34a7a0"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result31d38b2b989847e0932c9f0da6d02305/string</from>
					<to>content</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
					disabled="false"
					id="28656ca4b3204f919416cf8d87974135"
					lineNumber="42">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="If it did not exist yet, create it"
						disabled="false"
						id="8f8228407adb403c87aa37d91ada54fd"
						label="!instanceSubscription"
						lineNumber="43">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="594375aedb354cf4b70219fdee34521f"
							serviceId="nabu.frameworks.cdm.crud.cdmInstanceSubscription.services.create"
							resultName="resulta51d1a957e64493bacb1d3b911329678"
							temporaryMapping="true"
							x="238"
							y="48"
							invocationOrder="1"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="4d0fdbbe5b15419499ccd3157a1668f9"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/id</from>
							<to>instance/cdmSubscriptionId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="129c35cecfd3429abe076099a6ee42da"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>content</from>
							<to>instance/content</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="09e15d53fc6a42f0b6ffbbb7645eba40"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>date</from>
							<to>instance/pulled</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="ce25d3daf54e4d81bf4fdc76e7abf0c8"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/cdmInstanceId</from>
							<to>instance/cdmInstanceId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="eb066c05ae504513b44f7538687bf2e9"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>false</from>
							<to>instance/assumedContent</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="3f426242ad5a4d67b3260304baa84553"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>true</from>
						<to>newInstanceSubscription</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Otherwise, we update it"
						disabled="false"
						id="31eb024ff7784b5e81d5f13a092b6a44"
						lineNumber="44">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="b1267276b40643a8b34d6d4f1f603c8b"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>content</from>
						<to>instanceSubscription/content</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a26bacb27722443294779b7758dbba90"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>date</from>
						<to>instanceSubscription/pulled</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="c1d1c0046ae54f908b895d95ad49d83e"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>false</from>
						<to>instanceSubscription/assumedContent</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
							disabled="false"
							id="f57c398cfc68435b855a26a56f2f7262"
							path="instanceSubscription/cdmSystemBatchPullId" xsi:nil="true"/>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="5c3ca18118f34bdcbc3ce43492840d9a"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>false</from>
						<to>newInstanceSubscription</to>
					</steps>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Break"
				comment="If we don't want to merge the content, continue with the next system"
				disabled="false"
				id="bfb36127764f400494d7cec67d1d5b88"
				label="input/metadataOnly"
				lineNumber="45">
			<count>1</count>
			<continueExecution>true</continueExecution>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="If it is a new subscription and we have an initial master, use that"
				disabled="false"
				id="b545ae1561594a628c1b489c33111e76"
				label="newInstanceSubscription &amp;&amp; subscription/initialMasterTypeId != null"
				lineNumber="46">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="15b883594508468ca7847c9eea7b32ca"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>subscription/initialMasterTypeId</from>
				<to>subscription/masterTypeId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="If we have a master type, let's limit our impact to that. Let's also figure out if the system changed fields beyond that"
				disabled="false"
				id="d641b8be6d674b2495b6af331f9f0033"
				label="subscription/masterTypeId != null"
				lineNumber="47">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Diff full pull against the root, we want to see if you changed something beyond the fields you are master of"
					disabled="false"
					id="95822d616b114d48b75f1ab7819e3764"
					lineNumber="48">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="b30bc7493bcf48838fb4f4a98a5877f2"
						serviceId="nabu.frameworks.cdm.utils.diff"
						resultName="resulte2c7ebff579444bd91c60459e68d4f99"
						temporaryMapping="true"
						x="211"
						y="86"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="451706047ee34b5181e289f98eb17f14"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>partialInstance</from>
						<to>new</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="822222b54798403fa7f851a104c3ecaa"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>cdmInstance</from>
						<to>original</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="e85a72ae490745a59951e9c5e3ea20f7"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resulte2c7ebff579444bd91c60459e68d4f99/diffs[propertyPath != /primaryKeyField/name]</from>
					<to>fullDiff</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Limit to the subtype"
					disabled="false"
					id="2effbef738cb461daedd76dc8cbda7aa"
					lineNumber="49">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="f541a65d16e648fab0297f62504d374a"
						serviceId="nabu.utils.reflection.Type.mask"
						resultName="resultc092dfe6e0c74c209110b2888faebb2b"
						temporaryMapping="true"
						x="191"
						y="78"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e1f05518faf046ffb5be024b08662d09"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>partialInstance</from>
						<to>instance</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e8cdb2e1060d4a82915de2070bea32d6"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/masterTypeId</from>
						<to>type</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="5033579f6c414299b362ad5c934d2027"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultc092dfe6e0c74c209110b2888faebb2b/masked</from>
					<to>partialInstance</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Diff the partial against the root, don't take the primary key of the cdm into account"
				disabled="false"
				id="b6c4e76d5e2241508be8a3fe9cd6aa22"
				lineNumber="50">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="4d357090ab7548caa4688be2315ffd1d"
					serviceId="nabu.frameworks.cdm.utils.diff"
					resultName="resulte2c7ebff579444bd91c60459e68d4f99"
					temporaryMapping="true"
					x="211"
					y="86"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="39e10fa0e9fb489da1d03c892b55b062"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>partialInstance</from>
					<to>new</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="768658b4a7e840f7996fd6987e27aad9"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>cdmInstance</from>
					<to>original</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="19aaad906fc0441087ad4bdb3f73d6df"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resulte2c7ebff579444bd91c60459e68d4f99/diffs[propertyPath != /primaryKeyField/name]</from>
				<to>diffs</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="We don't want to &quot;unset&quot; values, especially useful during initial merge where data may be fragmented across systems initially"
				disabled="false"
				id="4c3dec79a2ba4851bc0316a72dc70ef1"
				label="input/skipNulls"
				lineNumber="51">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="f4ce04cbdb4b44f08172dec9e6acb1a5"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>diffs[newValue != null &amp;&amp; newValue != ""]</from>
				<to>diffs</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.For"
				comment="Map to the output"
				disabled="false"
				id="af40ecb9fd7d49018b7dcd7434f9ab0b"
				lineNumber="52"
				variable="diff"
				into="output/changes">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="1cc06feff9ca40f2b3613fd6caccaefa"
					lineNumber="53">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="85151013203b4915914b51a5f3c3b362"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>diff/path</from>
					<to>output/changes[0]/path</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8c42b5dda1dd47b08f2a1212b4db88f5"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>diff/action</from>
					<to>output/changes[0]/action</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8de1403f96104525a263da827d7116ca"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>diff/oldValue</from>
					<to>output/changes[0]/oldValue</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="caa427d0c1de4eaaa3a40ce0b3b730bc"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>diff/newValue</from>
					<to>output/changes[0]/newValue</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="ec1b908be0d74b6f8ef164e0d5c34f5e"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>subscription/system</from>
					<to>output/changes[0]/system</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="ca8bdf8e94164af6ad0cd41302de120e"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>diff/propertyPath</from>
					<to>output/changes[0]/propertyPath</to>
				</steps>
			</steps>
			<query>diffs</query>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.For"
				comment="Map to the sync diffs"
				disabled="false"
				id="e4a6cb993550471f98a25ae5dfc0f1dd"
				lineNumber="54"
				variable="diff"
				into="instanceSyncDiffs">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="b4db0a5c7164413093c7516d19fc5ebc"
					lineNumber="55">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="aaffd1c37fb54efab55667d065ed3855"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>diff/path</from>
					<to>instanceSyncDiffs[0]/path</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8e1656db2de845ffb32c1a6bc7eb48bc"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>diff/action</from>
					<to>instanceSyncDiffs[0]/action</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="33748abfb23d4c91aed9eadc5545914f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>diff/propertyPath</from>
					<to>instanceSyncDiffs[0]/propertyPath</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f33f6a1898774b6394fb7a75adbe9e9a"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>subscription/id</from>
					<to>instanceSyncDiffs[0]/cdmSystemSubscriptionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="ba37a017894040cda47b09bd288301e3"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>instanceSync/id</from>
					<to>instanceSyncDiffs[0]/cdmInstanceSyncId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="9a299c0a924c446291cbc2464e96c0f7"
						serviceId="nabu.utils.Server.uuid"
						resultName="result7cbedd5fce1840409a546077499e3848"
						temporaryMapping="true"
						x="404"
						y="235"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a4fe009ab44540eea84b141317416e5d"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result7cbedd5fce1840409a546077499e3848/uuid</from>
					<to>instanceSyncDiffs[0]/id</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="cec6a0e8bff749d99a7b28797bc95bbc"
						serviceId="nabu.utils.Object.toString"
						resultName="result92f60fd4601144b186fd103fb94f39eb"
						temporaryMapping="true"
						x="340"
						y="364"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="b08293f0a4aa4257a0026b39b8bf19c0"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>diff/oldValue</from>
						<to>object</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="5533f49c3fb44a75b18c7be6a5dcc66a"
						serviceId="nabu.utils.Object.toString"
						resultName="result30e05ea790e74763bfcd908f46d50b76"
						temporaryMapping="true"
						x="343"
						y="461"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="abf40c50811f44b0950191503aee4e2e"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>diff/newValue</from>
						<to>object</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="763a2ee585e14a2cb553625a555108c8"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result92f60fd4601144b186fd103fb94f39eb/string</from>
					<to>instanceSyncDiffs[0]/oldValue</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="615e62381df94475aa40c7a6e733a61f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result30e05ea790e74763bfcd908f46d50b76/string</from>
					<to>instanceSyncDiffs[0]/newValue</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="5fc98e2cdfed4dff9bdc40b593ed0bbf"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>false</from>
					<to>instanceSyncDiffs[0]/rejected</to>
				</steps>
			</steps>
			<query>diffs</query>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="We have a full diff as well, let's compare our master diff"
				disabled="false"
				id="5be3d6fd32424d66a41abaf98c97e4ca"
				label="subscription/masterTypeId != null"
				lineNumber="56">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Retain all the diffs in the full diff that are not in the localized diff"
					disabled="false"
					id="d03d9d2d665f41ca97220c856df8a523"
					lineNumber="57">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="49a9702e13664e1f9ec0e3ad64bb0ee6"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>fullDiff[path !# /diffs/path]</from>
					<to>forbiddenDiffs</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					disabled="false"
					id="45bb799f73994c379bb59ea933b53368"
					label="forbiddenDiffs"
					lineNumber="58">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="f3da102652be44a08b06c82a35834565"
						lineNumber="59">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="0cb78188cb364b28a473a2be2da9ead6"
							serviceId="nabu.frameworks.cdm.utils.instance.serializeDiff"
							resultName="resultf4c82547524a4545ae48d2205f87595c"
							temporaryMapping="true"
							x="116"
							y="84"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="ad2499187b2d4083aef8a77a2a0a6479"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>forbiddenDiffs</from>
							<to>diffs</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d360134400f8422b9ecccb2dc52e36cf"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultf4c82547524a4545ae48d2205f87595c/marshalled</from>
						<to>log/content</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="cc61f44b1c1e4750bbb4ebf5d76d152b"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>date</from>
						<to>log/created</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="aaf210be32844727a45711b046d88949"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>forbidden-diff</from>
						<to>log/logType</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e5612f3b5aa54367af12cd17511d06e5"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instance/id</from>
						<to>log/cdmInstanceId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="4632c7b9b0c0453fad36339a88692837"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instanceSubscription/id</from>
						<to>log/cdmInstanceSubscription</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="c6f1f605ec1145d5bcf4fd761907928b"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instanceSync/id</from>
						<to>log/cdmInstanceSyncId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="cfc02d90ab1f4095beb44ce1d930269a"
							serviceId="nabu.utils.Server.uuid"
							resultName="resulte49ce79af42141e0b8a83c9b60f2e774"
							temporaryMapping="true"
							x="341"
							y="598"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="f32a369496454b4faf2724a32da55eec"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resulte49ce79af42141e0b8a83c9b60f2e774/uuid</from>
						<to>log/id</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="c77fd2cc0c3e4d8db87be70b53b86d4b"
						lineNumber="60">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="faba110bb2ab470e8289c5f3aa9a5ee2"
							serviceId="nabu.utils.List.add"
							resultName="result747601e4b6b449709764bff79738a1c9"
							temporaryMapping="true"
							x="165"
							y="160"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="64de2d9083f148d7a090cc7d65e0bf19"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>logs</from>
							<to>list</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f4363f0c079d4b148fd868c142fc3f15"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>log</from>
							<to>object</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="ab3f4e58ddcd487d86cd63867e5f0e63"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result747601e4b6b449709764bff79738a1c9/list</from>
						<to>logs</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
							disabled="false"
							id="1f1a4aea489f4ea391cd83c8c53df16a"
							path="log" xsi:nil="true"/>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Distinguish between array insertion/deletion and plain update diffs (no longer the case!)"
				disabled="true"
				id="53af76b2f94f43668ae65ad02cc44dec"
				lineNumber="61">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="ff3217b246bb4d7d89dfe24488807e47"
					serviceId="nabu.utils.List.addAll"
					resultName="result92e4a7fefb2d4646b4ec4c29ed123668"
					temporaryMapping="true"
					x="311"
					y="124"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="eb45f2991b1f41afb01d201fab5d462a"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>diffs[propertyPath == path || action == "update"]</from>
					<to>objects</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1a1b64c4da5c496da9b7fff9c56fc05f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>cdmDiff</from>
					<to>list</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="0697d601cd174738ac685838d98d98fb"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result92e4a7fefb2d4646b4ec4c29ed123668/list</from>
				<to>cdmDiff</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="141dc66ce99946c18e69a46ac58df5db"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>diffs[propertyPath != path &amp;&amp; action != "update"]</from>
				<to>arrayDiffToApplyImmediately</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Add all diffs! Check documentation for array approaches"
				disabled="false"
				id="9cd0be76acd741f79cad2af473355714"
				lineNumber="62">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="fd73ae8ffaef44a4813c6fb829b58855"
					serviceId="nabu.utils.List.addAll"
					resultName="result92e4a7fefb2d4646b4ec4c29ed123668"
					temporaryMapping="true"
					x="311"
					y="124"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6572eea7576d421c85110ab358a8a3fc"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>diffs</from>
					<to>objects</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1d17b897ff2144c3a5011994a63f8778"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>cdmDiff</from>
					<to>list</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="591608584b244750af1a1411c98ebd78"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result92e4a7fefb2d4646b4ec4c29ed123668/list</from>
				<to>cdmDiff</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="If we have array insertion/deletion, we update the cdm immediately so future array changes are detected correctly. Other changes are combined into a bigger changeset"
				disabled="false"
				id="4bfae4044992436aaab862d494618902"
				label="arrayDiffToApplyImmediately"
				lineNumber="63">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="271b2e30e2ab48aa97f666fe09cdae96"
					serviceId="nabu.frameworks.cdm.utils.patch"
					resultName="result7ce67da90118494bac6fe8743533befc"
					temporaryMapping="true"
					x="242"
					y="84"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="878271724b5046ea8708b85d5dec9a33"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>cdmInstance</from>
					<to>instance</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="29db5436a1814ae4b47d2b08d3ceaaa0"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>arrayDiffToApplyImmediately</from>
					<to>diffs</to>
				</steps>
			</steps>
		</steps>
		<query>subscriptions</query>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Patch all the changes together AND in order"
			disabled="false"
			id="e8a7d51866d44d729542d7aaba76752e"
			label="cdmDiff"
			lineNumber="64">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="2fa2d02a84db49609022ac2bd3e42758"
				serviceId="nabu.frameworks.cdm.utils.patch"
				resultName="result1eb6e2bdd3024b5db32855b01395546f"
				temporaryMapping="true"
				x="193"
				y="110"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="5f137249fb8d4686bd8e9a7d6ab5dc3c"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>cdmDiff</from>
				<to>diffs</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="f1a7434caea046dc920856982158e0e7"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>cdmInstance</from>
				<to>instance</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="If we have subscriptions, they were updated"
			disabled="false"
			id="8956318aaadb43b8863efe2ac099a067"
			label="instanceSubscriptions"
			lineNumber="65">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="c0f5c6bb2eb842a58f3a53b05d4be141"
				serviceId="nabu.services.jdbc.Services.update"
				resultName="result276fc03391a343b092aba5760a7f7150"
				temporaryMapping="true"
				x="80"
				y="188"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="90bdb9aee7554c6c846f287d525487a7"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>instanceSubscriptions</from>
				<to>instances</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="If we have any changes, let's set a new content as well"
			disabled="false"
			id="967ae3a443df4161aa3d1d240ffc266b"
			label="output/changes"
			lineNumber="66">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Deactivate any active instance contents"
				disabled="false"
				id="ef0b33da560f447cb1b7d50c9f6b8833"
				lineNumber="67">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="b9ce091172004199a969f2b9121ea971"
					serviceId="nabu.frameworks.cdm.utils.instance.deactivateContent"
					resultName="result52f29c95108f4d189c86963f5e5de8ab"
					temporaryMapping="true"
					x="110"
					y="73"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="0fa8668c04f84bedb842ff198e46bfd6"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>date</from>
					<to>parameters[0]/stopped</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="7882ee12add74ea6bb2da6a7541b4fea"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/cdmInstanceId</from>
					<to>parameters[0]/instanceId</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Create a new instance content"
				disabled="false"
				id="383fed97c12441119fe4d960b885fdf5"
				lineNumber="68">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="1068925bcb4f4dd8a1c603fc1a099f15"
					serviceId="nabu.frameworks.cdm.crud.cdmInstanceContent.services.create"
					resultName="result5f961ec7988645ed81384dc7bafd87db"
					temporaryMapping="true"
					x="620"
					y="258"
					invocationOrder="2"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="7859b61974a74aeabb1c2ee8183c82ec"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>date</from>
					<to>instance/started</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4e4b8037635b43aaba368d436830edaf"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>instance/active</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="003b84b5405241aa9ffaa8b23cb7e231"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>newVersion</from>
					<to>instance/version</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="75a1ad27d8354a63aeaa5aefd3d4f56e"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultc9d1364e99c84b668f48b8f20aa81d91/string</from>
					<to>instance/content</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fcfb0fe0d2bc42609ae6df7b3d063a84"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/cdmInstanceId</from>
					<to>instance/cdmInstanceId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="0c66080c0a2c4fa89eb488e93751237f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>currentContent/id</from>
					<to>instance/previousInstanceContentId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="0fa9e9325e194911bd7d63949475fbc9"
					serviceId="nabu.data.json.Services.marshal"
					resultName="result26ae0fb37ad44972a9a077df2c5a9661"
					temporaryMapping="true"
					x="6"
					y="88"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="3a58bdbc68104bc099e9adca05d47fab"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>cdmInstance</from>
					<to>data</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a305d2dbc7694c76a5fea15bc0edac6b"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>UTF-8</from>
					<to>charset</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="7be07e0a9dd84e5abfe35b40399a2db4"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>prettyPrint</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="c0f426b694c34a07835be345c426390a"
					serviceId="nabu.utils.Stream.toString"
					resultName="resultc9d1364e99c84b668f48b8f20aa81d91"
					temporaryMapping="true"
					x="376"
					y="130"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="efb1bcb2da2d4d6fa0c61d6b57209573"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result26ae0fb37ad44972a9a077df2c5a9661/marshalled</from>
					<to>stream</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="b2f4417cf49043a0b05d706dd76b5c18"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>UTF-8</from>
					<to>charset</to>
				</steps>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Map the output"
			disabled="false"
			id="d56a6a46f13e4b7fb5194ab2f28b4996"
			lineNumber="69">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="21f9c84fe9fa47a19bd7f32d86f7976e"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>cdmInstance</from>
			<to>output/cdmInstance</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Map the stopped for the sync"
			disabled="false"
			id="55b22a44404e46f3a684e8a0bf07e1a4"
			lineNumber="70">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="7ceb0ed61b434367a70b84cac0b3d63b"
				serviceId="nabu.utils.Date.now"
				resultName="result19c939494411496aa2f85e7d09301754"
				temporaryMapping="true"
				x="295"
				y="276"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="53b4f645b59a4d5b9dcd79e7dfb2955f"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result19c939494411496aa2f85e7d09301754/date</from>
			<to>instanceSync/stopped</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="01fca7eadc9d4417adff5d814b3c04dd"
			lineNumber="71">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="20636b3db2f24c39bfa53a6371c21d84"
				serviceId="nabu.services.jdbc.Services.insert"
				resultName="result47b2d4ae6d8247699eaecbfe15a861a8"
				temporaryMapping="true"
				x="306"
				y="215"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="e5597656775c40afb7499c03c56156c1"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>instanceSync</from>
				<to>instances[0]</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="f483ce3eb03e4b0fbaa66c0e5ab6b8f3"
			label="instanceSyncDiffs"
			lineNumber="72">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="df3a6c1c27fd4fb786cb72d3faf3df3b"
				serviceId="nabu.services.jdbc.Services.insert"
				resultName="result1580698294f04cae92f5627ede6bc589"
				temporaryMapping="true"
				x="273"
				y="254"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="5d87c707981545b793f143d0b575dcc4"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>instanceSyncDiffs</from>
				<to>instances</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="a4335615970a434abc971065c7d8c73b"
			label="logs"
			lineNumber="73">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="c14050ce7d6f4fe285e4b280d6af1464"
				serviceId="nabu.services.jdbc.Services.insert"
				resultName="result545f30c888a14b8f83ce3c3cd30945b7"
				temporaryMapping="true"
				x="99"
				y="195"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="02b1c083978447b28bda8fd3369bbd18"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>logs</from>
				<to>instances</to>
			</steps>
		</steps>
	</steps>
</sequence>