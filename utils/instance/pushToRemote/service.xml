<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="9ed0d1493d26483a8566c430da26a7ca"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get the latest content for the cdm instance"
			disabled="false"
			id="90666d38fdfa457582085830687ee690"
			lineNumber="2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="62bc4a2f5e8b4276ad909f3bfab1a518"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceContent.services.list"
				resultName="result73d08e58afc14b1bb13c4bebd910fc19"
				temporaryMapping="true"
				x="30"
				y="30"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="99d3f26244fa40679d7841d284081fc4"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>filter/cdmInstanceId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="77d8e8f40fb84bd8a2385122f311e601"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>filter/active</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="f05c810ff96d48e6b7f6951cbca9e619"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result73d08e58afc14b1bb13c4bebd910fc19/results[0]</from>
			<to>currentContent</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="7881e167effa466dacd24d207de064fd"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceExternalId.services.list"
				resultName="resultc2873d5da9474f8c99944f8a9583ae84"
				temporaryMapping="true"
				x="117"
				y="166"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="77c58de785764ea881a9d631fdd6c5ec"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>filter/cdmInstanceId[0]</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="b03532c38afe4085a2327f09004fa842"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultc2873d5da9474f8c99944f8a9583ae84/results</from>
			<to>externalIds</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="3337126201714c00a17b1d072e8c5450"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result73d08e58afc14b1bb13c4bebd910fc19/results[0]/typeId</from>
			<to>typeId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="00f9df07706843aa84b3fa640573931a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultc2873d5da9474f8c99944f8a9583ae84/results</from>
			<to>externalIds</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Break"
			comment="Nothing to push"
			description="=&quot;There was no content to push for: &quot; + input/cdmInstanceId"
			disabled="false"
			id="489fe55e402840fd812ca00fc877e0ac"
			label="!currentContent"
			lineNumber="3">
		<count>1</count>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get all active relations"
			disabled="false"
			id="b15e56c8c96a4f10934a8481b447c8dc"
			lineNumber="4">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="0dd76794d96e41cd81e2e6e4f2bd7273"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceRelation.services.list"
				resultName="result9fcad811ad5743d9a0848f060ca00eda"
				temporaryMapping="true"
				x="57"
				y="43"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d0bbeeb153694475a7342798c0569e83"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>filter/sourceId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ad17531b81f7431ab4f9b2ae8deba98e"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>filter/active</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="abcfa81520d44874a69d11b3e3faa3b1"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result9fcad811ad5743d9a0848f060ca00eda/results</from>
			<to>allExistingRelations</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="2a50a6cd619a45ee86144599da112270"
				serviceId="nabu.utils.List.unique"
				resultName="result0170555d261942f3969a23237ce52d44"
				temporaryMapping="true"
				x="484"
				y="353"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="8cff9915028d431ab841f0f4b2bb0784"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result9fcad811ad5743d9a0848f060ca00eda/results[targetId != null]/targetId</from>
				<to>list</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="922c9b18b669437c8fe4481bc48ac806"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result0170555d261942f3969a23237ce52d44/list</from>
			<to>allExistingRelationTargetIds</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="b4e109485e724950a4ae68f7747c0bb1"
			label="allExistingRelationTargetIds"
			lineNumber="5">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="acd921c75e7241758673f7118700718d"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceExternalId.services.list"
				resultName="result5451f0c02f834df991e49f2ec8bcd01f"
				temporaryMapping="true"
				x="140"
				y="51"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="15dd23cfa1cd4e7b8e5e455e2b9cc48a"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>allExistingRelationTargetIds</from>
				<to>filter/cdmInstanceId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="9a57f3f0e97845429a580a233517258b"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result5451f0c02f834df991e49f2ec8bcd01f/results</from>
			<to>allExistingRelationTargetExternalIds</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Unmarshal current content"
			disabled="false"
			id="ef2d2a2ea65f445780734515211d150c"
			lineNumber="6">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="13a29775aa5c49b282184bf13e3f1672"
				serviceId="nabu.data.json.Services.unmarshal"
				resultName="result389a096181764bee92c6fe9502d8ff8c"
				temporaryMapping="true"
				x="311"
				y="222"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="9b073c434e6d4727acd1bba9dc749505"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result64523c7a322d4b29884fb98289034c18/stream</from>
				<to>input</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="088e10497e1e48e2af3c56b9e6e0128b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>currentContent/typeId</from>
				<to>type</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="7ce47ae820c443c1badae553de22e624"
				serviceId="nabu.utils.String.toStream"
				resultName="result64523c7a322d4b29884fb98289034c18"
				temporaryMapping="true"
				x="34"
				y="70"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d8442c2e32e643ab96343efa7b2cf2d6"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>currentContent/content</from>
				<to>string</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ce9bdeb3add948ceb212f4c022ce4997"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>UTF-8</from>
				<to>charset</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="38524ec42ea048168b4f8b04f5ad7919"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result389a096181764bee92c6fe9502d8ff8c/unmarshalled</from>
			<to>cdmInstance</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="If we have a previous content, diff it to get the actual change"
			disabled="false"
			id="99ebd193fddb43f58a710305c863bc8d"
			label="currentContent/previousInstanceContentId != null"
			lineNumber="7">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="e70e7f07a3aa4068918c2927112c0a2e"
				lineNumber="8">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="a3ed3ed41e194407a4cd64f4ebe86678"
					serviceId="nabu.frameworks.cdm.crud.cdmInstanceContent.services.get"
					resultName="resultdf5cc0d03d394024a8d633ae95e084df"
					temporaryMapping="true"
					x="37"
					y="61"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="61344381ae204ebbafb5ac3191fb3a21"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>currentContent/previousInstanceContentId</from>
					<to>id</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="cfc1b39f966240318c58575af8923b16"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultdf5cc0d03d394024a8d633ae95e084df/result</from>
				<to>previousContent</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Unmarshal previous content"
				disabled="false"
				id="b24b7b0511ec4d9eb3606b482b49d0f9"
				lineNumber="9">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="b3e3996a31cf44cda60637a20b09ba5b"
					serviceId="nabu.data.json.Services.unmarshal"
					resultName="result389a096181764bee92c6fe9502d8ff8c"
					temporaryMapping="true"
					x="311"
					y="222"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="aa02e434d63d4667a4fb705d9bd69a2c"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result64523c7a322d4b29884fb98289034c18/stream</from>
					<to>input</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="7a433842247b497b89f4697d97bf89b4"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>previousContent/typeId</from>
					<to>type</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="5253859bc0724d3db5f59925fa18ec50"
					serviceId="nabu.utils.String.toStream"
					resultName="result64523c7a322d4b29884fb98289034c18"
					temporaryMapping="true"
					x="34"
					y="70"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="c5151e7f9df54b2d9a0f08d5e7eb0bf1"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>UTF-8</from>
					<to>charset</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="e9bd1dcd5e104e5e881e10708cc2efcd"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>previousContent/content</from>
					<to>string</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="910298c1f9004ec592c19353ff4b50ed"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result389a096181764bee92c6fe9502d8ff8c/unmarshalled</from>
				<to>previousCdmInstance</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="72e2b8f360b4499cb894f29d47ce51f9"
				lineNumber="10">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="264ceab5834849179d50d5e363c497ff"
					serviceId="nabu.frameworks.cdm.utils.diff"
					resultName="resultf24d401a3c634222bf52c8ac718d43aa"
					temporaryMapping="true"
					x="95"
					y="152"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="df311ac275944f17a8c0a40c7a21488d"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>previousCdmInstance</from>
					<to>original</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="3163388fa9424db0ac1f4def4eab3236"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>cdmInstance</from>
					<to>new</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="639e3529d5434deeb4f5ebb1085ae2fa"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultf24d401a3c634222bf52c8ac718d43aa/diffs</from>
				<to>cdmDiff</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Break"
				description="No changes between versions, this should not occur"
				disabled="false"
				id="db88595e76b64ef88d652376343c7556"
				label="!cdmDiff"
				lineNumber="11">
			<count>2</count>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="291ab9f24ea34568977d969207472c2f"
			lineNumber="12">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="c77eef3c3da049cba2dcbf234fa24ee7"
				serviceId="nabu.frameworks.cdm.crud.cdmSystemSubscription.services.list"
				resultName="resultca49f03b896e42a68dacb4f9b8b8d892"
				temporaryMapping="true"
				x="187"
				y="49"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="65d9d45ddb084deabb8330f7e439a931"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/systems</from>
				<to>filter/system</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="a86bc11f5ffe45bca20e8cb0ac133a93"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>currentContent/typeId</from>
				<to>filter/coreTypeId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="f9218b1059fe4c1ab2b1b868191fc3b5"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>filter/hasPush</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="d279dbe5d9354075a54d089270463b39"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultca49f03b896e42a68dacb4f9b8b8d892/results</from>
			<to>subscriptions</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="5e751d03b7d04b3bb2ee849e2ef7d68a"
				serviceId="nabu.utils.Date.now"
				resultName="result5635c2495880477283d759f6cb0b4095"
				temporaryMapping="true"
				x="159"
				y="238"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="7d91685a79914b88ba7cac63ba5448f6"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result5635c2495880477283d759f6cb0b4095/date</from>
			<to>date</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="20cc73e4237c401eb083d0c30076e0fb"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result5635c2495880477283d759f6cb0b4095/date</from>
			<to>instanceSync/started</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="7b637276dc38495d8fd64daf4e7857d2"
				serviceId="nabu.utils.Server.uuid"
				resultName="result687fb21079f443f2bc1b7b7396fc2e9a"
				temporaryMapping="true"
				x="253"
				y="399"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="aaa5955a462240f288227d886e81ac1d"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result687fb21079f443f2bc1b7b7396fc2e9a/uuid</from>
			<to>instanceSync/id</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="b2ea7272ea3445608f9e92847dfb9787"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>push</from>
			<to>instanceSync/direction</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="0bd1df4be7154ce28fcdaebec45e22b3"
				serviceId="nabu.utils.Runtime.getCurrentToken"
				resultName="result6e10cc864d1141119b3f09c516fc4863"
				temporaryMapping="true"
				x="213"
				y="535"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="a41a6db5a69340c988aacfbabe4f9586"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result6e10cc864d1141119b3f09c516fc4863/token/authenticationId</from>
			<to>instanceSync/actorId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6438387a52854383a0d0a4c251deefa7"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>input/cdmInstanceId</from>
			<to>instanceSync/cdmInstanceId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="97717ee73e504cc08bb27222ba908f1e"
				serviceId="nabu.utils.Runtime.getCorrelationId"
				resultName="result6a0a6b578c354ee58666bd79219c724b"
				temporaryMapping="true"
				x="567"
				y="519"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="c008dbb6e0244f0d97a55fafff9a5af3"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result6a0a6b578c354ee58666bd79219c724b/correlationId</from>
			<to>instanceSync/correlationId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="d983cee80cf84fdf9f8ec280357c0a54"
				serviceId="nabu.utils.Server.getServerName"
				resultName="resultbb8f4f66659a4601b0fc951afb8aebee"
				temporaryMapping="true"
				x="924"
				y="560"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="3018a1f9dae3468eb8cd9b1d44d0c49b"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultbb8f4f66659a4601b0fc951afb8aebee/server</from>
			<to>instanceSync/server</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get interesting relation types"
			disabled="false"
			id="4c999f596d89436487761542da4fa4d4"
			label="subscriptions"
			lineNumber="13">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="cf25b001e9134edbb2885a18a5082cff"
				serviceId="nabu.frameworks.cdm.crud.cdmSystemRelationType.services.list"
				resultName="result28ccb09243694330b795acd19387506f"
				temporaryMapping="true"
				x="94"
				y="64"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="3b9e669a06cf49a2b551016cd15cdc43"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>subscriptions/id</from>
				<to>filter/cdmSystemSubscriptionId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="4f54f4864c334188966f78bc6755b8a6"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result28ccb09243694330b795acd19387506f/results</from>
			<to>allInterestedRelationTypes</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get the last data for the given subscriptions"
			disabled="false"
			id="acff44da480a47c2be1b6bb4d3f569bc"
			label="subscriptions"
			lineNumber="14">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="4ec2fd1688c74ae7a67dd693ca81d4cf"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceSubscription.services.list"
				resultName="result62e74915f6b947da898e6060967aec28"
				temporaryMapping="true"
				x="167"
				y="104"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="890b6f404faf48e2869d9b2f990a2d04"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>filter/cdmInstanceId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="26c9bb39bd794f4e8e50c4bd0e35becb"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>subscriptions/id</from>
				<to>filter/cdmSubscriptionId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="edeb4ec19b72402b9a28496a31ca243d"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result62e74915f6b947da898e6060967aec28/results</from>
			<to>instanceSubscriptions</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.For"
			disabled="false"
			id="9cd35a45cbdc4142ae9bcd48a15e2383"
			lineNumber="15"
			variable="subscription">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get the current instance subscription and relations"
				disabled="false"
				id="6b69e25f25b348cd81d7661da8f30231"
				lineNumber="16">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="269cbf1b43394045baf081894df4f742"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>instanceSubscriptions[cdmSubscriptionId == /subscription/id]</from>
				<to>instanceSubscription</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
					disabled="false"
					id="cd049a87c41444bf93b30d5abfb11367"
					path="partialInstance" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="478269a449c1400cadfe55d00b2cc922"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>false</from>
				<to>push</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="99769bddef89485d919b9fcc34c04bbd"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>allExistingRelations[cdmSystemSubscriptionId == /subscription/id]</from>
				<to>existingRelations</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="62bcf17dde4745388d37400fb7b1bcd5"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/forcePull</from>
				<to>pullNewData</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="4f36f7db38f54dbda3176006e5869573"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>allInterestedRelationTypes[cdmSystemSubscriptionId == /subscription/id]</from>
				<to>interestedRelationTypes</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
					disabled="false"
					id="52169474f12f41a4a46f92791a25e278"
					path="changedRelations" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
					disabled="false"
					id="53fbe20a2a4f49d5b975891ca49b9ed7"
					path="interestingRelations" xsi:nil="true"/>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Break"
				comment="If it's decoupled, we ignore it"
				disabled="false"
				id="a1affa07e8624896ad26b46418528a25"
				label="instanceSubscription/decoupled != null &amp;&amp; instanceSubscription/decoupled &lt;= date"
				lineNumber="17">
			<count>1</count>
			<continueExecution>true</continueExecution>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get interested relations"
				disabled="false"
				id="465168b1357345f78eb4ae556c041912"
				label="interestedRelationTypes"
				lineNumber="18">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="651f0d3dc8b441e9a310f38d08b289f5"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>allExistingRelations[cdmSystemSubscriptionId != /subscription/id &amp;&amp; cdmRelationTypeId # /interestedRelationTypes/cdmRelationTypeId]</from>
				<to>interestingRelations</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				comment="Get changed relations (if any)"
				disabled="false"
				id="1f634d45a4c645d4a5d4d8b64e66819c"
				label="interestingRelations"
				lineNumber="19">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Figure out the changed relations before we do any updates to them"
					disabled="false"
					id="dc626554df834aedb5dd4bf449381ee0"
					label="instanceSubscription/pushed != null"
					lineNumber="20">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="286005bcf58f4177935e3ef6d4db8219"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>interestingRelations[started &gt;= /instanceSubscription/pushed || (stopped != null &amp;&amp; stopped &gt;= /instanceSubscription/pushed)]</from>
					<to>changedRelations</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="3ef996e0abc44352b436a7d4c1aabb31"
					lineNumber="21">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="ee77f9966fff44efa25a1cfe3c90234c"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>interestingRelations</from>
					<to>changedRelations</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				disabled="false"
				id="cbf7945cc16b452fa4b152af6223f17f"
				lineNumber="22">
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					disabled="false"
					id="1cff32cfb0b847bfb8b1ef14e69852a5"
					label="instanceSubscription/pulled != null &amp;&amp; subscription/pullInterval != null"
					lineNumber="23">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Calculate the next pull window"
						disabled="false"
						id="c5f3a44f253449e8b6444ff5eeff9656"
						lineNumber="24">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="e03df6f8b9b74b0bbb1b446860b795c0"
							serviceId="nabu.utils.Date.incrementDuration"
							resultName="result5bfa6321f9b640cbb5facac56d37561d"
							temporaryMapping="true"
							x="219"
							y="120"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f22e33ff33e04a38907958c80e5291a5"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/pullInterval</from>
							<to>duration</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="7194becb482a47fe9eb045add5fc7bd1"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>instanceSubscription/pulled</from>
							<to>start</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="4a136e76cc9a41ec9fd863db9c989247"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result5bfa6321f9b640cbb5facac56d37561d/date</from>
						<to>nextPull</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Calculate whether or not to pull based on the available interval"
						disabled="false"
						id="6b01386f6b4942a29c1a274af44e1766"
						lineNumber="25">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0d31bbc53e8b4ba68c6d3dc2c2927c51"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>=date &gt;= nextPull</from>
						<to>pullNewData</to>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="If we have a pull service but have not yet pulled, do that first"
					disabled="false"
					id="8c39e658dac5486a9383159b66570372"
					label="subscription/pullId != null &amp;&amp; instanceSubscription/pulled == null"
					lineNumber="26">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="96bac7c05a734c3c9fd4df63204b96fc"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>pullNewData</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="No subscription yet, create it"
				disabled="false"
				id="86804d5db1924c979911c8e9715265f9"
				label="!instanceSubscription"
				lineNumber="27">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="3185ee12cd6544c98bb7ff320322c17d"
					serviceId="nabu.frameworks.cdm.crud.cdmInstanceSubscription.services.create"
					resultName="resultb3e4c754b5454ba189248b491714cdec"
					temporaryMapping="true"
					x="269"
					y="89"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8176d9b51b2a45bd9949dd4fe5ac866f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/cdmInstanceId</from>
					<to>instance/cdmInstanceId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f6bf40fed78c4ad9b7f29f1d9c0a4c43"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>subscription/id</from>
					<to>instance/cdmSubscriptionId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="8ee02f293d5342d98950ddb646b333d9"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultb3e4c754b5454ba189248b491714cdec/created</from>
				<to>instanceSubscription</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="28a0e53c43804565a955ad0274723dad"
					serviceId="nabu.utils.List.add"
					resultName="resultd01e31c6574e4a49b5c1ab70576dc5fe"
					temporaryMapping="true"
					x="776"
					y="213"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="bb7094631d04439183ca2e9813727f2d"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultb3e4c754b5454ba189248b491714cdec/created</from>
					<to>object</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="931ab98e43f04db39f4e515675ebaef3"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>instanceSubscriptions</from>
					<to>list</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="54f7bc65dc1a4d1bb3b865cf358912f0"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultd01e31c6574e4a49b5c1ab70576dc5fe/list</from>
				<to>instanceSubscriptions</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Unmarshal the content if we have it"
				disabled="false"
				id="b9a17fc543e749089e00a37c2671a397"
				label="instanceSubscription/content != null"
				lineNumber="28">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="9d7bfca6ffc742b9be6a2c45c0f2b5a1"
					serviceId="nabu.data.json.Services.unmarshal"
					resultName="resultffe171ae34a4424a980935209f42ef0b"
					temporaryMapping="true"
					x="460"
					y="108"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="744bcc4f6d614fd08e4b472850902f9f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result902358dc10374006a97af3a8d18f7146/first</from>
					<to>type</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d3c8ce3269fa49c4aa7d2b0592a6a9b4"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result3bc1f50959f946408d8cb565bf8660ce/stream</from>
					<to>input</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="b5af7116ed8041e6842d26debcceb228"
					serviceId="nabu.utils.Object.first"
					resultName="result902358dc10374006a97af3a8d18f7146"
					temporaryMapping="true"
					x="23"
					y="58"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d29f415361d1407aa9141bdae91c5c92"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>subscription/typeId</from>
					<to>options[0]</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="899cc828e755416085470034484b3bbe"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>subscription/coreTypeId</from>
					<to>options[1]</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="666bd20f09d04f42939c7e57d7b52d5f"
					serviceId="nabu.utils.String.toStream"
					resultName="result3bc1f50959f946408d8cb565bf8660ce"
					temporaryMapping="true"
					x="59"
					y="245"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="b9b07165b6a74a2c9de439d11c7f69c1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>instanceSubscription/content</from>
					<to>string</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="c9255f798fec4c1a94dd60f34d8cb77d"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>UTF-8</from>
					<to>charset</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="e4565322aaf043548b9a4fc7f478557e"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultffe171ae34a4424a980935209f42ef0b/unmarshalled</from>
				<to>partialInstance</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Check that we don't need to skip it"
				disabled="false"
				id="3aac6e8f3bd64460be4d7cb7421dd813"
				label="input/skipPullForSystem != null &amp;&amp; pullNewData"
				lineNumber="29">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="4a3e4989e86f491c8e1b62a4a37fe7dc"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>=subscription/system !# /input/skipPullForSystem</from>
				<to>pullNewData</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="Refresh potentially stale data first"
				disabled="false"
				id="f1a03dc39cb6491482ab9662175c4974"
				label="subscription/pullId != null &amp;&amp; pullNewData"
				lineNumber="30">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="d4e23b29cbc94b71bfa396fad18c33b6"
					lineNumber="31">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="82a793554830497997dc523ec3ee1602"
						serviceId="nabu.frameworks.cdm.specs.pull"
						resultName="result7183429fcb04496d9a75bc61d18aba32"
						temporaryMapping="true"
						x="78"
						y="36"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d9111639041e4fc4b6181c368cd94ffb"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>externalIds</from>
						<to>externalIds</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="5e78a274c44843b2ab85fd95b2c3d943"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/cdmInstanceId</from>
						<to>cdmInstanceId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="ab5412bd2b9f4084920568e991af313d"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/pullId</from>
						<to>implementationId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="6eea7e65f43545039c41732070b765d5"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>existingRelations</from>
						<to>relations</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fefbacb7deae4630833a61630f1b85f8"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result7183429fcb04496d9a75bc61d18aba32/externalIds</from>
					<to>newExternalIds</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="39c24ff1b8cb4afda9a22c04f2c99355"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>date</from>
					<to>instanceSubscription/pulled</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="848dd845961b48b192b39a8db2af890e"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result7183429fcb04496d9a75bc61d18aba32/cdmInstance</from>
					<to>newestPartialInstance</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="34a2c0c039f84c8bbe9d39208388afbd"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result7183429fcb04496d9a75bc61d18aba32/relations</from>
					<to>newRelations</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Update the ids"
					disabled="false"
					id="85b3245ea4094a81be16363511293e35"
					label="newExternalIds"
					lineNumber="32">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="6cf7e93e611e4992b036a591cfde2745"
						serviceId="nabu.frameworks.cdm.utils.externalId.update"
						resultName="result35cf43d44d4343a393614080fe7f194e"
						temporaryMapping="true"
						x="170"
						y="85"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="964472ec7f674609956afb0468b8a211"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/cdmInstanceId</from>
						<to>cdmInstanceId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0508f1ac7976489da0addf480f2ad304"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>newExternalIds</from>
						<to>newExternalIds</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="894bfedb901c4031b2557fac6fe04a73"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>externalIds</from>
						<to>existingExternalIds</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="3d7cd2ee60bb442db884be87f2ed583d"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result35cf43d44d4343a393614080fe7f194e/externalIds</from>
					<to>externalIds</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="If we had an instance but no longer have one, we set to decoupled and skip"
					disabled="false"
					id="257de5fdc8074f2fa2ddb923e512c2eb"
					label="newestPartialInstance == null &amp;&amp; partialInstance != null"
					lineNumber="33">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Set decoupled"
						disabled="false"
						id="f5d7b17cc44e4dbb92c42318e8915d70"
						lineNumber="34">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="7d4137b6a8e140d1b784ad0709feed7d"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>date</from>
						<to>instanceSubscription/decoupled</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
							disabled="false"
							id="31d40dce32714d33a250892463f576f0"
							path="instanceSubscription/content" xsi:nil="true"/>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Break"
						disabled="false"
						id="d858080656ed46a9984cf6cc68cff605"
						lineNumber="35">
					<count>3</count>
					<continueExecution>true</continueExecution>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="073aa9d29a7745f8a83c0356cb40fa61"
					lineNumber="36">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="26fdfc8c9c774cc1b9a1f5dadebe6f59"
						serviceId="nabu.frameworks.cdm.utils.relation.update"
						resultName="result267941eb0565452e8d2e8bb5ebb9e2a9"
						temporaryMapping="true"
						x="66"
						y="54"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="ed59964937b94933ae3c163434642819"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/cdmInstanceId</from>
						<to>cdmInstanceId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="f30d584c21934784b75073d1bb681bec"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>newRelations</from>
						<to>newRelations</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="60044718bfc84ba6a0030f37b4782197"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>existingRelations</from>
						<to>existingRelations</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="6c5eff5419a64ecea233ded70b956d06"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/cdmDefinitionId</from>
						<to>cdmDefinitionId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="cd25dda848364291bfd4c97f7c798d24"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/id</from>
						<to>cdmSystemSubscriptionId</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="78c6cb7f04c44ea9aa56ecf92e09d90b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result267941eb0565452e8d2e8bb5ebb9e2a9/existingRelations</from>
					<to>existingRelations</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="If we have a master type, we need to &quot;overwrite&quot; any changes you might have done to fields that you are not master off"
					disabled="false"
					id="fb884cb0c87e408385992d9348570773"
					label="subscription/masterTypeId != null"
					lineNumber="37">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Diff our new pull against the cdm and get all the fields that you are allowed to change"
						disabled="false"
						id="14a8096fad534d2aaaa1634592e92131"
						lineNumber="38">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="6a661863fd304ef7a75fcbfcfe8d7a83"
							serviceId="nabu.frameworks.cdm.utils.diff"
							resultName="result1a43fa07b3cc40379a81e47e265f4f9e"
							temporaryMapping="true"
							x="226"
							y="86"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="aaa745d4db0c42598223c8f5f95ef43a"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>newestPartialInstance</from>
							<to>original</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="1924391f3db74eb7bbcd7d2827a9891a"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>cdmInstance</from>
							<to>new</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="2bcfe197be6948ad83dd3fa4c57b37f7"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result1a43fa07b3cc40379a81e47e265f4f9e/diffs</from>
						<to>revertToCdmDiffs</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="bc0407b02eeb4068a10ad3e629de8a3e"
							serviceId="nabu.utils.reflection.Type.describe"
							resultName="result9f33297a72514b099dbfb0adeecaaa73"
							temporaryMapping="true"
							x="309"
							y="232"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="076841beb8f242d2a3ce8d144806b1e4"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/masterTypeId</from>
							<to>typeId</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="58d9d30182194ca78fd1733ec3e24a43"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result9f33297a72514b099dbfb0adeecaaa73/parameters</from>
						<to>masterParameters</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Retain reversion diff for paths that are not in the master"
						disabled="false"
						id="48307ca528cb46bd8a85586cbe3ad4de"
						lineNumber="39">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="95840b02b4cd403dbe776a5e0307a0ba"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>revertToCdmDiffs[propertyPath !# /masterParameters/path]</from>
						<to>revertToCdmDiffs</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="If we have any, apply them and log the reversion"
						disabled="false"
						id="4ada0022fc85430a8fb7aa3a28376417"
						label="revertToCdmDiffs"
						lineNumber="40">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="a8a24d6923f84d48823edcb9823ba561"
							serviceId="nabu.frameworks.cdm.utils.patch"
							resultName="resultfeb124fc2b5d448588e8092217b8fb67"
							temporaryMapping="true"
							x="73"
							y="207"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="99927ab64c1a46519cf0dcf20ec87cc7"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>newestPartialInstance</from>
							<to>instance</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="c1bb13d9e0944e3e9c70a5ee262603ae"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>revertToCdmDiffs</from>
							<to>diffs</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="6fd6e5783194459baebb3c251b72289a"
							serviceId="nabu.frameworks.cdm.utils.instance.serializeDiff"
							resultName="resulte5fed61ac5c041a2b5357233f89ae8f6"
							temporaryMapping="true"
							x="82"
							y="20"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="4bd1c874c579452b9bd0829af677a47c"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>revertToCdmDiffs</from>
							<to>diffs</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="f215d486ade64abcb40b476951de481c"
							serviceId="nabu.frameworks.cdm.crud.cdmInstanceLog.services.create"
							resultName="resultc263e434ec7d4399b6702ba4dac94841"
							temporaryMapping="true"
							x="483"
							y="24"
							invocationOrder="1"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f02d3ff548fe4a02af0ebc38e8eedab1"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>resulte5fed61ac5c041a2b5357233f89ae8f6/marshalled</from>
							<to>instance/content</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="b22c3dca3ca64e408265a2aa988d1174"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>revert-changed</from>
							<to>instance/logType</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="3278cb23290649779dfa63a1e4f9de1d"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>date</from>
							<to>instance/created</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="1c14f0786a724005ad3cf63cb0462b11"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>currentContent/cdmInstanceId</from>
							<to>instance/cdmInstanceId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="23ad2ab8425c48d6ae034d2da8bd756c"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>instanceSubscription/id</from>
							<to>instance/cdmInstanceSubscription</to>
						</steps>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Map the new instance to partial so we use the latest data"
					disabled="false"
					id="f177683cfedf4ebdbf3489a925b89bdc"
					lineNumber="41">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="0650eb581f0c46df8b13952e2f02d9ab"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>newestPartialInstance</from>
					<to>partialInstance</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				disabled="false"
				id="042d9859899445629b1caa39b950eb71"
				lineNumber="42"
				query="partialInstance">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Push a masked version of the current content"
					disabled="false"
					id="754602a8b8b34af2afe15099fbda80c5"
					label="null"
					lineNumber="43">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="34666b682dff4a5ab199d8f23508b2b4"
						serviceId="nabu.utils.reflection.Type.mask"
						resultName="result5211ea5434e34fee8c30dfb90b6241ed"
						temporaryMapping="true"
						x="350"
						y="211"
						invocationOrder="1"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="83be00fbf7d241f3a987672bb22cff92"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultb9458ad39dd24836aabbf5d2cfec7afe/first</from>
						<to>type</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="11dd87e480244b23bd2ec2c4c2cd38cc"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>cdmInstance</from>
						<to>instance</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="1619b6afa96147debe2197e9a5728a18"
						serviceId="nabu.utils.Object.first"
						resultName="resultb9458ad39dd24836aabbf5d2cfec7afe"
						temporaryMapping="true"
						x="14"
						y="135"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="9fcc4bd987ca40ce9b19b98dc7fcf6ff"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/coreTypeId</from>
						<to>options[1]</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="604346b0735f4bcd82b03215fcbb0b74"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/typeId</from>
						<to>options[0]</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fc35d0a9c7f64b5eaeb18cc347510304"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>push</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="34a11e2e14154cad8e91c5981a2dc1c7"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result5211ea5434e34fee8c30dfb90b6241ed/masked</from>
					<to>patchedPartialInstance</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="3ebcf4ab030145bd800566cf5a9044c0"
						path="appliedDiffs" xsi:nil="true"/>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					disabled="false"
					id="8a8899f28b7641bcac5546c3c531a834"
					lineNumber="44">
				<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
						comment="Check which diff we want to apply"
						disabled="false"
						id="ec294afc6a0f45c086fd33124403f7ba"
						lineNumber="45">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="If we have no cdm diff (first sync of entire cdm instance), we diff against the full thing"
							disabled="false"
							id="49fec5a94f3646c38aa4eecefd0b8f73"
							label="cdmDiff == null"
							lineNumber="46">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="a1f8e0295b654532bf64854a17d6f141"
								serviceId="nabu.frameworks.cdm.utils.diff"
								resultName="result104dde8382fc43cf9beb8fee1f16aeaf"
								temporaryMapping="true"
								x="71"
								y="110"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="196b460e42404ad98d911ede4bc986f2"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>cdmInstance</from>
								<to>new</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="e912e012212a49dbb4538103d0d94817"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>partialInstance</from>
								<to>original</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f77e68038ee94b6a8a38b202d39947fc"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result104dde8382fc43cf9beb8fee1f16aeaf/diffs</from>
							<to>diffToApply</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="We only apply actual changes we noticed, not the full cdm, this leaves unreported changes as is for the next pickup"
							disabled="false"
							id="a0ab974ebd154ad19f88e92b89f2cdb6"
							lineNumber="47">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="ad8f25cc2fc14a6494e9143617e2e4d4"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>cdmDiff</from>
							<to>diffToApply</to>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Make a masked instance so we can diff changes"
						disabled="false"
						id="85cd6980258040bd86dcec236c73e940"
						lineNumber="48">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="13fa4bb6084649879ca04a33e97b6351"
							serviceId="nabu.utils.reflection.Type.mask"
							resultName="resultcd6647e639e348e6a41a7777bd6291d0"
							temporaryMapping="true"
							x="402"
							y="200"
							invocationOrder="1"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="604f08378d4c412c892913caeae523ad"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>partialInstance</from>
							<to>instance</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="994d44f75c964612b60e2348e3a35156"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result591302c7e709455bb2db428f4d111d3d/typeId</from>
							<to>type</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="be635669b5b84bceae151af2557f771e"
							serviceId="nabu.utils.reflection.Type.of"
							resultName="result591302c7e709455bb2db428f4d111d3d"
							temporaryMapping="true"
							x="36"
							y="72"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="3a25268ad1be4350a79876356c26461a"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>partialInstance</from>
							<to>typeInstance</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="572f619afc814dc4964e7a817a66f8e3"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultcd6647e639e348e6a41a7777bd6291d0/masked</from>
						<to>patchedPartialInstance</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
							disabled="false"
							id="d875a87f877342eca113c3076a13aece"
							path="appliedDiffs" xsi:nil="true"/>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						disabled="false"
						id="1d204adfc4294a98b199d56263e78644"
						label="diffToApply"
						lineNumber="49">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Patch the masked instance"
							disabled="false"
							id="7915d995367049a9b6221c79d23a2d79"
							lineNumber="50">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="7f19490b45e0449cb1e97162ab991083"
								serviceId="nabu.frameworks.cdm.utils.patch"
								resultName="result7c839e519cf5497296db0747c89b84ef"
								temporaryMapping="true"
								x="236"
								y="65"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="dc21c84746034d0bb00c90ce90aceb1b"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>diffToApply</from>
								<to>diffs</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="05db97e7f74645d2babad41e08d65e2a"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>patchedPartialInstance</from>
								<to>instance</to>
							</steps>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
							disabled="false"
							id="d5587294311e414d84c14cbc450d89f5"
							lineNumber="51"
							query="subscription/slaveTypeId">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Diff the masked"
								disabled="false"
								id="00e5fbbc222d431e8cf3fe9435fb8645"
								label="null"
								lineNumber="52">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="1410591b35474904a2332492e3b5405d"
									serviceId="nabu.frameworks.cdm.utils.diff"
									resultName="resultb0dec1ae89e04adb92a3b6c9c0200b0d"
									temporaryMapping="true"
									x="199"
									y="129"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="e3375a9f39d04da2adc0dc89a8642a68"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>partialInstance</from>
									<to>original</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="39988f582450490a9dde2a157a8016b2"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>patchedPartialInstance</from>
									<to>new</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="2cb07b89b9d54919a7715677feffc616"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>resultb0dec1ae89e04adb92a3b6c9c0200b0d/diffs</from>
								<to>appliedDiffs</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Diff the cast version of the slave. Any changes to unchangeable fields should not trigger a sync"
								disabled="false"
								id="8392d461f4be4e4c9eb3017a394d9e5f"
								lineNumber="53">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="8d4285fcbb3648eeb058711928dfb186"
									serviceId="nabu.frameworks.cdm.utils.diff"
									resultName="resultb0dec1ae89e04adb92a3b6c9c0200b0d"
									temporaryMapping="true"
									x="467"
									y="158"
									invocationOrder="1"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="ec969455174c49c08ac6fee19753a894"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>resultea0f5c44cfc84354a0e6355e040c99c6/masked</from>
									<to>new</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="ebe8ef050471492b9368e2d2d4906342"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>result182474d388644f1b8019b741b6dcc5a5/masked</from>
									<to>original</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="93d410177a6b4f9bbfd4216d0941aac0"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>resultb0dec1ae89e04adb92a3b6c9c0200b0d/diffs</from>
								<to>appliedDiffs</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="8e3f31a57b3448108f3f96e65e1575be"
									serviceId="nabu.utils.reflection.Type.mask"
									resultName="result182474d388644f1b8019b741b6dcc5a5"
									temporaryMapping="true"
									x="80"
									y="113"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="b5c0440b78004e40a9a10a9cf8e571aa"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>partialInstance</from>
									<to>instance</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="30072ed135344c67a60d17a374781d17"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>subscription/slaveTypeId</from>
									<to>type</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="f7e3ad1419ad4748a593b3f14e642a24"
									serviceId="nabu.utils.reflection.Type.mask"
									resultName="resultea0f5c44cfc84354a0e6355e040c99c6"
									temporaryMapping="true"
									x="69"
									y="299"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="cd2f21ed7ed2445a8c43ad986fd0f60e"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>patchedPartialInstance</from>
									<to>instance</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="93d03b4515fb405a92f34e24be545952"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>subscription/slaveTypeId</from>
									<to>type</to>
								</steps>
							</steps>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Push if we have applied changes"
							disabled="false"
							id="f7a2d5a4e13145a2a622b2530477c8ef"
							lineNumber="54">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="ed6d0816566f48cdab98744dd25360ff"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>=appliedDiffs != null</from>
							<to>push</to>
						</steps>
					</steps>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="If we aren't pushing but interesting relations have been updated, push anyway"
				disabled="false"
				id="9f5df03d2f8c48bfab684f9018f5eb54"
				label="!push &amp;&amp; changedRelations != null"
				lineNumber="55">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="11886c295f2c47b3a13eeacb62ba1c29"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>push</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="99135964fd6446a4a6a7b4656bae5b2a"
				label="!push &amp;&amp; input/forcePushForSystem != null &amp;&amp; subscription/system # input/forcePushForSystem"
				lineNumber="56">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="02b9dc4f96904670809830d0038f391c"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>push</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="If we want to push at this point, let's do it"
				disabled="false"
				id="cbf94e36ee064b4ea604de0b810e5e32"
				label="push"
				lineNumber="57">
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="Enrich with external ids"
					disabled="false"
					id="76746ebf4d544977a096530fddecbd09"
					label="interestingRelations"
					lineNumber="58">
				<steps xsi:type="be.nabu.libs.services.vm.step.For"
						disabled="false"
						id="f6a036ca5cd640a78c7ba6455c2191e8"
						lineNumber="59"
						variable="singleInterestingRelation"
						into="interestingRelationsWithIds">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Map initial"
							disabled="false"
							id="8175b453426e44e79c12655ad5c423a8"
							lineNumber="60">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="b407752e735847bf908c392869fd4a2e"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>singleInterestingRelation</from>
							<to>interestingRelationsWithIds[0]</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Map external ids"
							disabled="false"
							id="90c67617f13b453b8d6c9c32bd3b9fb9"
							label="singleInterestingRelation/targetId != null"
							lineNumber="61">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9c5a9465baa140a980b029b80aa8401b"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>allExistingRelationTargetExternalIds[cdmInstanceId == /singleInterestingRelation/targetId]</from>
							<to>interestingRelationsWithIds[0]/targetExternalIds</to>
						</steps>
					</steps>
					<query>interestingRelations</query>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.For"
					disabled="false"
					id="9e141712ece540a781f468245641d9c5"
					lineNumber="62"
					variable="appliedDiff"
					into="instanceSyncDiffs">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="6441928ac44142639daf31fbfa9718ee"
						lineNumber="63">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="28fe544f5360439d819389e7a591a70e"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>appliedDiff/propertyPath</from>
						<to>instanceSyncDiffs[0]/propertyPath</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="7bf715b3860c48ad8f999c6710f89160"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>appliedDiff/path</from>
						<to>instanceSyncDiffs[0]/path</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="6e60e0906b7f4ac584a52a8e455ed40a"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>appliedDiff/action</from>
						<to>instanceSyncDiffs[0]/action</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="6cf15faaaaa642b2a9ed7f967bf8b387"
							serviceId="nabu.utils.Object.toString"
							resultName="result7f23da2910234dde84698ad4eb2d5b3b"
							temporaryMapping="true"
							x="160"
							y="467"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="b88ba5f8a7a141c482d5f513e30de154"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>appliedDiff/oldValue</from>
							<to>object</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="f905a5d6549b43bca8406cf7cfe41202"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result7f23da2910234dde84698ad4eb2d5b3b/string</from>
						<to>instanceSyncDiffs[0]/oldValue</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="4e23275bd9494b53922d832ff21da686"
							serviceId="nabu.utils.Object.toString"
							resultName="resultad43eeb1d4d34ea9ab08937b9dbbe0a0"
							temporaryMapping="true"
							x="170"
							y="589"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="e86fdbb2868b403588c469207630675c"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>appliedDiff/newValue</from>
							<to>object</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="b547fb8b0f454730b4804e562e7eb450"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultad43eeb1d4d34ea9ab08937b9dbbe0a0/string</from>
						<to>instanceSyncDiffs[0]/newValue</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="fabca94a582f4b84aedbfe6ad9d908df"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instanceSync/id</from>
						<to>instanceSyncDiffs[0]/cdmInstanceSyncId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a1e424598de64c7098cbd6fb1a0b5fa9"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/id</from>
						<to>instanceSyncDiffs[0]/cdmSystemSubscriptionId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="54796e7d60244b1e9210ee699e8e48dc"
							serviceId="nabu.utils.Server.uuid"
							resultName="result7498bbd68eb34ae5b8a101026dc082d1"
							temporaryMapping="true"
							x="250"
							y="191"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="3efdf2dfa24a4f119f5bdf9a310142a7"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result7498bbd68eb34ae5b8a101026dc082d1/uuid</from>
						<to>instanceSyncDiffs[0]/id</to>
					</steps>
				</steps>
				<query>appliedDiffs</query>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					disabled="false"
					id="25ef206d71a54d4d9daef3baaf84dbbd"
					lineNumber="64"
					scopeDefaultTransaction="true">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="d6b3bf8a67954136acca6df8a0a8ec7b"
						lineNumber="65">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="fbb3af112b5c4c659b777757d7852d8a"
							serviceId="nabu.frameworks.cdm.specs.push"
							resultName="result66c3d0f3aebe4c9596df5ce60f3bda6f"
							temporaryMapping="true"
							x="137"
							y="65"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="d49f94464db04ebd8e8e8a6dcf93c720"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>externalIds</from>
							<to>externalIds</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="a26718217f73435abfb495e984b8d1cb"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>patchedPartialInstance</from>
							<to>cdmInstance</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="e1cd59656cbe4c9c94b464447fec36b4"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/pushId</from>
							<to>implementationId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f62d5967300e4c7ab931134b4ceca091"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>existingRelations</from>
							<to>relations</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="692799ef588f40f48d497b57c912c31f"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>interestingRelationsWithIds</from>
							<to>interestingRelations</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d9e8484f44274d98a13c0329f9d8d703"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result66c3d0f3aebe4c9596df5ce60f3bda6f/externalIds</from>
						<to>newExternalIds</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="8b0f86a9779e4886873c6c0a13a7cb7f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result66c3d0f3aebe4c9596df5ce60f3bda6f/rejected</from>
						<to>rejected</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="badf254c7a9848fa9dc3467e504ef3fc"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result66c3d0f3aebe4c9596df5ce60f3bda6f/relations</from>
						<to>newRelations</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
						disabled="false"
						id="c2243305dcd04460b9ecdbb8c2dd7ce8"
						lineNumber="66"
						variable="exception">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="d1d29d9eacfd4d38b854124ac5fbbfcc"
							lineNumber="67">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f9be0a5c0cef40cbaebc4e6bc21de404"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>true</from>
							<to>rejected</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="1a85a00b03a442aba785dc72e8cdf414"
								serviceId="nabu.utils.Runtime.summarizeException"
								resultName="result5990a55b187b4e80bb88d45ea66f8fad"
								temporaryMapping="true"
								x="161"
								y="311"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="2c435ef308db4628a30d2bd3991cc1d1"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>exception</from>
								<to>exception</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="7d787d09c6764c7996b66331d1194689"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result5990a55b187b4e80bb88d45ea66f8fad/summary/exceptionStack</from>
							<to>rejectionReason</to>
						</steps>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Update the ids"
					disabled="false"
					id="58998ed9bb87401695f0ec19f343fb3c"
					label="newExternalIds"
					lineNumber="68">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="08d00c30ca704f279e31c675ccec59e3"
						serviceId="nabu.frameworks.cdm.utils.externalId.update"
						resultName="result35cf43d44d4343a393614080fe7f194e"
						temporaryMapping="true"
						x="170"
						y="85"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0d665b6ae4914fb49c39cae32e1d2800"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/cdmInstanceId</from>
						<to>cdmInstanceId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="163b1bbe0a3045b3b824b9e6f2b30da2"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>newExternalIds</from>
						<to>newExternalIds</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="075cf384be5b4c84afccefe798670c60"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>externalIds</from>
						<to>existingExternalIds</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f4556219132a4c71913b408b1b01417e"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result35cf43d44d4343a393614080fe7f194e/externalIds</from>
					<to>externalIds</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Update the &quot;pushed&quot;"
					disabled="false"
					id="47ce2c02fd6940e49af9c25a62a932f9"
					lineNumber="69">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1df901e2220943f494f58a70007211ed"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>date</from>
					<to>instanceSubscription/pushed</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
					disabled="false"
					id="2a80362c53a24e9a8da73b4701a30989"
					lineNumber="70">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="2e53fda4265a4fd985df381cc8f78a2b"
						label="rejected"
						lineNumber="71">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="34bb96ca848044fa9a377bafa49b1709"
							serviceId="nabu.frameworks.cdm.crud.cdmInstanceLog.services.create"
							resultName="result3bfc1242ce19401f812500bb48e201c2"
							temporaryMapping="true"
							x="470"
							y="146"
							invocationOrder="1"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="ea36e97c71a64fc8b7b30d2ec48a0857"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>push-rejected</from>
							<to>instance/logType</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="0952e19aac8347a3befabaaad551f1d2"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/cdmInstanceId</from>
							<to>instance/cdmInstanceId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="61b29da9503844f295a112763457b20b"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>instanceSubscription/id</from>
							<to>instance/cdmInstanceSubscription</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="32620ada3d584be98b412ec386d82d83"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>rejectionReason</from>
							<to>instance/content</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="70a33605b9a9465db90c7508a664a89f"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>date</from>
							<to>instance/created</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
							disabled="false"
							id="38d63c670bcf4630a061b546e3d4c7df"
							path="rejectionReason" xsi:nil="true"/>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Marshal the content and update &quot;pulled&quot;. We assume that the data is now synchronized and pulling it would yield the same result"
						disabled="false"
						id="fa7f762ff61a489fa7b4361eb2da8eeb"
						lineNumber="72">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="dc1c5baeaf7f4f9481cedafcbd5eb200"
							serviceId="nabu.data.json.Services.marshal"
							resultName="result41b021e3eff64fd5a8d115315540a448"
							temporaryMapping="true"
							x="33"
							y="97"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="41ed42c5076f4e85931e441f19e233db"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>patchedPartialInstance</from>
							<to>data</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="da1eefb913804c43ab3d4e0e288b8f3d"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>UTF-8</from>
							<to>charset</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="46b1bbe4186a46559b6f6a916ff336d4"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>true</from>
							<to>prettyPrint</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="a01f4e50f86c44989faa9673b122bef0"
							serviceId="nabu.utils.Stream.toString"
							resultName="resultc080d996a16b454ba2a937a8580614de"
							temporaryMapping="true"
							x="529"
							y="268"
							invocationOrder="1"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="1e9f3611471042bab9660097322b03e5"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result41b021e3eff64fd5a8d115315540a448/marshalled</from>
							<to>stream</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9079bd6889544bbf8f2ff93941977ad3"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>UTF-8</from>
							<to>charset</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="06a1a5bfa6204615a0c0659703b6ecdb"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultc080d996a16b454ba2a937a8580614de/string</from>
						<to>instanceSubscription/content</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="ce3321e16bb84dc4aabfc753467d146a"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>date</from>
						<to>instanceSubscription/pulled</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="ab618da291cd430c9d8ffe7e99862cd4"
							serviceId="nabu.frameworks.cdm.utils.relation.update"
							resultName="result417ae9edbfb34d01a81411d1706558da"
							temporaryMapping="true"
							x="65"
							y="213"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="4b1c4d264d7141089ae48a876ae1c8db"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/cdmInstanceId</from>
							<to>cdmInstanceId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f593bad9f6d84baf8dd82889a7956fbf"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>existingRelations</from>
							<to>existingRelations</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9cbb3e8059eb40f7a8778dcdab8ef1b0"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>newRelations</from>
							<to>newRelations</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="357d566336f1492db1bf1211aac9ebc3"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/cdmDefinitionId</from>
							<to>cdmDefinitionId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9dc19a06570345f18293ae5bcc793e25"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/id</from>
							<to>cdmSystemSubscriptionId</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="cb60107e04cc49c6ba69df4a2c7bb414"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result417ae9edbfb34d01a81411d1706558da/existingRelations</from>
						<to>existingRelations</to>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="If it is rejected and we have a provider service, check if it was perhaps deleted"
					disabled="false"
					id="4132d113246d4032b1696a06e5d3cf2e"
					label="rejected &amp;&amp; subscription/pullId != null"
					lineNumber="73">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="069dd61ddfa14701bcbf5b5979595f02"
						lineNumber="74">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="c33dfb78212641d99ef61702bad14fee"
							serviceId="nabu.frameworks.cdm.specs.pull"
							resultName="result7183429fcb04496d9a75bc61d18aba32"
							temporaryMapping="true"
							x="118"
							y="50"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="4e0342d25e184793b98322fda2206f94"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>externalIds</from>
							<to>externalIds</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9353eab251084659bd080f604fa6aa4f"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/cdmInstanceId</from>
							<to>cdmInstanceId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f15ccb055366456a97186206764d86b0"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/pullId</from>
							<to>implementationId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f427bc13628a44bbabd3cc4aaf7a432a"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>existingRelations</from>
							<to>relations</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="07f7445396ea43a7b75ed83d637ccd4f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result7183429fcb04496d9a75bc61d18aba32/externalIds</from>
						<to>newExternalIds</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="c37c29359ef748c4b9a0f401eae06bc3"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>date</from>
						<to>instanceSubscription/pulled</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="23f5e38548df4584b776d15698ed750a"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result7183429fcb04496d9a75bc61d18aba32/cdmInstance</from>
						<to>newestPartialInstance</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="5aedb71e2ed24cd68957cee73ca8ee29"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result7183429fcb04496d9a75bc61d18aba32/relations</from>
						<to>newRelations</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Update the ids"
						disabled="false"
						id="bcc8f2de21804a80a8ac1489085f6e48"
						label="newExternalIds"
						lineNumber="75">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="6ef0320513574c938aa1a50db885f23a"
							serviceId="nabu.frameworks.cdm.utils.externalId.update"
							resultName="result35cf43d44d4343a393614080fe7f194e"
							temporaryMapping="true"
							x="170"
							y="85"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="82e73e972df04c1e9b3228f1b2a58510"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/cdmInstanceId</from>
							<to>cdmInstanceId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="071f19878350409fb907a756989da5db"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>newExternalIds</from>
							<to>newExternalIds</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="01d61456fae341e288b4c33e18abb3ad"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>externalIds</from>
							<to>existingExternalIds</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0ea9a81cfefd4a1c95df64ef7058f22a"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result35cf43d44d4343a393614080fe7f194e/externalIds</from>
						<to>externalIds</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
						disabled="false"
						id="6faf0afbca574587b2c91e211902f55a"
						lineNumber="76">
					<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
							comment="If we had an instance but no longer have one, we set to decoupled and skip"
							disabled="false"
							id="ffb7d4deb8fe479bae2861c08d7366e1"
							label="newestPartialInstance == null"
							lineNumber="77">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Set decoupled"
								disabled="false"
								id="ef62fef8824a4a33be9d5a4d827b8e23"
								lineNumber="78">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="c85727e81e1b4527beb9ce4a963da28a"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>date</from>
								<to>instanceSubscription/decoupled</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
									disabled="false"
									id="d1e919ed1f0d487ebba56a0450c653d5"
									path="instanceSubscription/content" xsi:nil="true"/>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Break"
								disabled="false"
								id="ad081687be8c451d84b3542e473c1a7b"
								lineNumber="79">
							<count>3</count>
							<continueExecution>true</continueExecution>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
							comment="Otherwise we set the (potentially partially updated data) and update the pulled"
							disabled="false"
							id="deb73f6d87034eba93a02a1cdbc86e3b"
							lineNumber="80">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								disabled="false"
								id="e1160032a1b34a7ab0c0e3c97c8859cb"
								lineNumber="81">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="e518c8be6543420aa9924b333af18e03"
									serviceId="nabu.data.json.Services.marshal"
									resultName="result41b021e3eff64fd5a8d115315540a448"
									temporaryMapping="true"
									x="33"
									y="97"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="a82197097a0c4181add19c15acfd07df"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>UTF-8</from>
									<to>charset</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="b57cbfd8d19d4520b76efc5b055fdcaa"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>true</from>
									<to>prettyPrint</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="30976f74c4c74884a93a736041fba781"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>newestPartialInstance</from>
									<to>data</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="50f0cf4f69424a058e1ab7c429f9df7e"
									serviceId="nabu.utils.Stream.toString"
									resultName="resultc080d996a16b454ba2a937a8580614de"
									temporaryMapping="true"
									x="529"
									y="268"
									invocationOrder="1"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="44c7c862eb72460ca9d255d6c91e4bed"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>result41b021e3eff64fd5a8d115315540a448/marshalled</from>
									<to>stream</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="d3f402ea223048dcbc7a9692ce210511"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>UTF-8</from>
									<to>charset</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="6e7f7e6a4cdf493ea8f1d3c3291e988d"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>resultc080d996a16b454ba2a937a8580614de/string</from>
								<to>instanceSubscription/content</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="576535b9b92345a6acd0b2cb8b032725"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>date</from>
								<to>instanceSubscription/pulled</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="2fefbe9b0e9e48f5b85bb320872982a0"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>true</from>
								<to>instanceSubscription/assumedContent</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
									disabled="false"
									id="d4e8912cbd444f2f8ecb18769cea7cce"
									path="instanceSubscription/cdmSystemBatchPullId" xsi:nil="true"/>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								disabled="false"
								id="b3797462d2b243d1bbfcc71f906bd77c"
								lineNumber="82">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="fff2b0f16d2d4ec7af91d52f07d60e6f"
									serviceId="nabu.frameworks.cdm.utils.relation.update"
									resultName="result267941eb0565452e8d2e8bb5ebb9e2a9"
									temporaryMapping="true"
									x="91"
									y="41"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="a4c92ca50d1a477b8e9ff13956ccb71e"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>input/cdmInstanceId</from>
									<to>cdmInstanceId</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="f3ea5a12abfb46619f6456e9de9d7441"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>newRelations</from>
									<to>newRelations</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="8d05e48beb3d45c9add2f5d72aaad0cd"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>existingRelations</from>
									<to>existingRelations</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="7fed51059abb454f9bc10b2f72b01a51"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>subscription/cdmDefinitionId</from>
									<to>cdmDefinitionId</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="133e61b398254f9aa02faf2f257fafdf"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>subscription/id</from>
									<to>cdmSystemSubscriptionId</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="0463b8bfea8649bda54f68b01a523a29"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result267941eb0565452e8d2e8bb5ebb9e2a9/existingRelations</from>
								<to>existingRelations</to>
							</steps>
						</steps>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
					disabled="false"
					features="CDM_FAIL_ON_REJECT"
					id="113e7060dfdf49d0ad84f3596bf1a758"
					label="rejected"
					lineNumber="83"
					message="Rejected"
					whitelist="false" xsi:nil="true"/>
		</steps>
		<query>subscriptions</query>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="973ff9e5d7214e1898fc333ee23eab74"
			label="instanceSubscriptions"
			lineNumber="84">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="aa2f63054aa74874baa41d5989e99a55"
				serviceId="nabu.services.jdbc.Services.update"
				resultName="resultfefc0156ccc547ac9de3704288e24200"
				temporaryMapping="true"
				x="94"
				y="64"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="3c184849a70947a5a0073a124a2ae7f4"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>instanceSubscriptions</from>
				<to>instances</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Map the stopped for the sync"
			disabled="false"
			id="55b22a44404e46f3a684e8a0bf07e1a4"
			lineNumber="85">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="7ceb0ed61b434367a70b84cac0b3d63b"
				serviceId="nabu.utils.Date.now"
				resultName="result19c939494411496aa2f85e7d09301754"
				temporaryMapping="true"
				x="295"
				y="276"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="53b4f645b59a4d5b9dcd79e7dfb2955f"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result19c939494411496aa2f85e7d09301754/date</from>
			<to>instanceSync/stopped</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="01fca7eadc9d4417adff5d814b3c04dd"
			lineNumber="86">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="20636b3db2f24c39bfa53a6371c21d84"
				serviceId="nabu.services.jdbc.Services.insert"
				resultName="result47b2d4ae6d8247699eaecbfe15a861a8"
				temporaryMapping="true"
				x="306"
				y="215"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="e5597656775c40afb7499c03c56156c1"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>instanceSync</from>
				<to>instances[0]</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="f483ce3eb03e4b0fbaa66c0e5ab6b8f3"
			label="instanceSyncDiffs"
			lineNumber="87">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="df3a6c1c27fd4fb786cb72d3faf3df3b"
				serviceId="nabu.services.jdbc.Services.insert"
				resultName="result1580698294f04cae92f5627ede6bc589"
				temporaryMapping="true"
				x="273"
				y="254"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="5d87c707981545b793f143d0b575dcc4"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>instanceSyncDiffs</from>
				<to>instances</to>
			</steps>
		</steps>
	</steps>
</sequence>