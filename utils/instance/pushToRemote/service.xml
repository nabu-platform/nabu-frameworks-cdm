<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="9ed0d1493d26483a8566c430da26a7ca"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get the latest content for the cdm instance"
			disabled="false"
			id="90666d38fdfa457582085830687ee690"
			lineNumber="2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="62bc4a2f5e8b4276ad909f3bfab1a518"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceContent.services.list"
				resultName="result73d08e58afc14b1bb13c4bebd910fc19"
				temporaryMapping="true"
				x="30"
				y="30"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="99d3f26244fa40679d7841d284081fc4"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>filter/cdmInstanceId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="77d8e8f40fb84bd8a2385122f311e601"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>filter/active</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="f05c810ff96d48e6b7f6951cbca9e619"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result73d08e58afc14b1bb13c4bebd910fc19/results[0]</from>
			<to>currentContent</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="7881e167effa466dacd24d207de064fd"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceExternalId.services.list"
				resultName="resultc2873d5da9474f8c99944f8a9583ae84"
				temporaryMapping="true"
				x="117"
				y="166"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="77c58de785764ea881a9d631fdd6c5ec"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>filter/cdmInstanceId[0]</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="b03532c38afe4085a2327f09004fa842"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultc2873d5da9474f8c99944f8a9583ae84/results</from>
			<to>externalIds</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="3337126201714c00a17b1d072e8c5450"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result73d08e58afc14b1bb13c4bebd910fc19/results[0]/typeId</from>
			<to>typeId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="00f9df07706843aa84b3fa640573931a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultc2873d5da9474f8c99944f8a9583ae84/results</from>
			<to>externalIds</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="d244e28f88884e649b5154387408909e"
				serviceId="nabu.utils.List.maximum"
				resultName="result8ae6b131e1d64a22ac6d7c1d3c0d7b37"
				temporaryMapping="true"
				x="552"
				y="347"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="e8a397d11d754d4c965c946e9f4cc8ea"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultc2873d5da9474f8c99944f8a9583ae84/results/modified</from>
				<to>list</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="82038e1b6898475badebd75878105c90"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result8ae6b131e1d64a22ac6d7c1d3c0d7b37/maximum</from>
			<to>mostRecentExternalIdModification</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Break"
			comment="Nothing to push"
			description="=&quot;There was no content to push for: &quot; + input/cdmInstanceId"
			disabled="false"
			id="489fe55e402840fd812ca00fc877e0ac"
			label="!currentContent"
			lineNumber="3">
		<count>1</count>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Unmarshal current content"
			disabled="false"
			id="ef2d2a2ea65f445780734515211d150c"
			lineNumber="4">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="13a29775aa5c49b282184bf13e3f1672"
				serviceId="nabu.data.json.Services.unmarshal"
				resultName="result389a096181764bee92c6fe9502d8ff8c"
				temporaryMapping="true"
				x="311"
				y="222"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="9b073c434e6d4727acd1bba9dc749505"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result64523c7a322d4b29884fb98289034c18/stream</from>
				<to>input</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="088e10497e1e48e2af3c56b9e6e0128b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>currentContent/typeId</from>
				<to>type</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="9d266dff6e264a5a95b469b9e75508a4"
					fixedValue="true">
				<from>true</from>
				<to>ignoreUndefinedFields</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="7ce47ae820c443c1badae553de22e624"
				serviceId="nabu.utils.String.toStream"
				resultName="result64523c7a322d4b29884fb98289034c18"
				temporaryMapping="true"
				x="34"
				y="70"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d8442c2e32e643ab96343efa7b2cf2d6"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>currentContent/content</from>
				<to>string</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ce9bdeb3add948ceb212f4c022ce4997"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>UTF-8</from>
				<to>charset</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="38524ec42ea048168b4f8b04f5ad7919"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result389a096181764bee92c6fe9502d8ff8c/unmarshalled</from>
			<to>cdmInstance</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="291ab9f24ea34568977d969207472c2f"
			lineNumber="5">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="c77eef3c3da049cba2dcbf234fa24ee7"
				serviceId="nabu.frameworks.cdm.crud.cdmSystemSubscription.services.list"
				resultName="resultca49f03b896e42a68dacb4f9b8b8d892"
				temporaryMapping="true"
				x="187"
				y="49"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="65d9d45ddb084deabb8330f7e439a931"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/systems</from>
				<to>filter/system</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="a86bc11f5ffe45bca20e8cb0ac133a93"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>currentContent/typeId</from>
				<to>filter/coreTypeId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="f9218b1059fe4c1ab2b1b868191fc3b5"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>filter/hasPush</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="9ab66154e12141c38f3adf4a5cfc40e3"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>priority desc</from>
				<to>orderBy[0]</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="d279dbe5d9354075a54d089270463b39"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultca49f03b896e42a68dacb4f9b8b8d892/results</from>
			<to>subscriptions</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="5e751d03b7d04b3bb2ee849e2ef7d68a"
				serviceId="nabu.utils.Date.now"
				resultName="result5635c2495880477283d759f6cb0b4095"
				temporaryMapping="true"
				x="159"
				y="238"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="7d91685a79914b88ba7cac63ba5448f6"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result5635c2495880477283d759f6cb0b4095/date</from>
			<to>date</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="20cc73e4237c401eb083d0c30076e0fb"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result5635c2495880477283d759f6cb0b4095/date</from>
			<to>instanceSync/started</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="7b637276dc38495d8fd64daf4e7857d2"
				serviceId="nabu.utils.Server.uuid"
				resultName="result687fb21079f443f2bc1b7b7396fc2e9a"
				temporaryMapping="true"
				x="253"
				y="399"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="aaa5955a462240f288227d886e81ac1d"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result687fb21079f443f2bc1b7b7396fc2e9a/uuid</from>
			<to>instanceSync/id</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="b2ea7272ea3445608f9e92847dfb9787"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>push</from>
			<to>instanceSync/direction</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="0bd1df4be7154ce28fcdaebec45e22b3"
				serviceId="nabu.utils.Runtime.getCurrentToken"
				resultName="result6e10cc864d1141119b3f09c516fc4863"
				temporaryMapping="true"
				x="213"
				y="535"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="a41a6db5a69340c988aacfbabe4f9586"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result6e10cc864d1141119b3f09c516fc4863/token/authenticationId</from>
			<to>instanceSync/actorId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6438387a52854383a0d0a4c251deefa7"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>input/cdmInstanceId</from>
			<to>instanceSync/cdmInstanceId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="97717ee73e504cc08bb27222ba908f1e"
				serviceId="nabu.utils.Runtime.getCorrelationId"
				resultName="result6a0a6b578c354ee58666bd79219c724b"
				temporaryMapping="true"
				x="567"
				y="519"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="c008dbb6e0244f0d97a55fafff9a5af3"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result6a0a6b578c354ee58666bd79219c724b/correlationId</from>
			<to>instanceSync/correlationId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="d983cee80cf84fdf9f8ec280357c0a54"
				serviceId="nabu.utils.Server.getServerName"
				resultName="resultbb8f4f66659a4601b0fc951afb8aebee"
				temporaryMapping="true"
				x="924"
				y="560"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="3018a1f9dae3468eb8cd9b1d44d0c49b"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultbb8f4f66659a4601b0fc951afb8aebee/server</from>
			<to>instanceSync/server</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="ea9b05cb089f45e5b525f641ebc5f56a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>input/source</from>
			<to>instanceSync/source</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="80463c14480b4ee987d5aa141761fefb"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultca49f03b896e42a68dacb4f9b8b8d892/results</from>
			<to>output/subscriptions</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get interesting relation types"
			disabled="false"
			id="4c999f596d89436487761542da4fa4d4"
			label="subscriptions"
			lineNumber="6">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="cf25b001e9134edbb2885a18a5082cff"
				serviceId="nabu.frameworks.cdm.crud.cdmSystemRelationType.services.list"
				resultName="result28ccb09243694330b795acd19387506f"
				temporaryMapping="true"
				x="94"
				y="64"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="3b9e669a06cf49a2b551016cd15cdc43"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>subscriptions/id</from>
				<to>filter/cdmSystemSubscriptionId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="4f54f4864c334188966f78bc6755b8a6"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result28ccb09243694330b795acd19387506f/results</from>
			<to>allInterestedRelationTypes</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get the last data for the given subscriptions"
			disabled="false"
			id="acff44da480a47c2be1b6bb4d3f569bc"
			label="subscriptions"
			lineNumber="7">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="4ec2fd1688c74ae7a67dd693ca81d4cf"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceSubscription.services.list"
				resultName="result62e74915f6b947da898e6060967aec28"
				temporaryMapping="true"
				x="167"
				y="104"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="890b6f404faf48e2869d9b2f990a2d04"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>filter/cdmInstanceId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="26c9bb39bd794f4e8e50c4bd0e35becb"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>subscriptions/id</from>
				<to>filter/cdmSubscriptionId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="edeb4ec19b72402b9a28496a31ca243d"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result62e74915f6b947da898e6060967aec28/results</from>
			<to>instanceSubscriptions</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="25f1c8757cf14ea8b19f084214bf59dd"
				serviceId="nabu.utils.List.minimum"
				resultName="result3b3716981b0448f09a4b117d46688e6c"
				temporaryMapping="true"
				x="657"
				y="327"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="58b94e0a06ba4046877b79a1a40741c3"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result62e74915f6b947da898e6060967aec28/results[pushed != null]/pushed</from>
				<to>list</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="ea18b8b912b847db9ba62a2fd8a859d8"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result3b3716981b0448f09a4b117d46688e6c/minimum</from>
			<to>oldestPush</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Always get all active relations"
			disabled="false"
			id="f4ba31c10d3347569435c217267280de"
			lineNumber="8">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="9120cee72316448a9f6542e3201bd52a"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceRelation.services.list"
				resultName="result9fcad811ad5743d9a0848f060ca00eda"
				temporaryMapping="true"
				x="57"
				y="43"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="8fa1d9616a4748a095486fd06c06d258"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>filter/sourceId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d1912a49999549e09dd8f1777bc4a520"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>filter/active</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="500fff2df6524a90af8b975c730cbcb1"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result9fcad811ad5743d9a0848f060ca00eda/results</from>
			<to>allExistingRelations</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="4cc37b7d542b4835beff1331994248f2"
				serviceId="nabu.utils.List.unique"
				resultName="result0170555d261942f3969a23237ce52d44"
				temporaryMapping="true"
				x="558"
				y="372"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="b40a55e4e639483c8fb02c137560f885"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result9fcad811ad5743d9a0848f060ca00eda/results[targetId != null]/targetId</from>
				<to>list</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="2f0d230d432843d0ad555d0cffce718d"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result0170555d261942f3969a23237ce52d44/list</from>
			<to>allExistingRelationTargetIds</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="If we have a previous (oldest) push date, get the inactivated ones as well with a modified after that time"
			disabled="false"
			id="b15e56c8c96a4f10934a8481b447c8dc"
			label="oldestPush != null"
			lineNumber="9">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="0dd76794d96e41cd81e2e6e4f2bd7273"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceRelation.services.list"
				resultName="result9fcad811ad5743d9a0848f060ca00eda"
				temporaryMapping="true"
				x="57"
				y="43"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d0bbeeb153694475a7342798c0569e83"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmInstanceId</from>
				<to>filter/sourceId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="495d6e91714547e8aaf65f6125fe9d10"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>oldestPush</from>
				<to>filter/modifiedSince</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="0fedd472e834480089dee8b8f2dc8bd9"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>false</from>
				<to>filter/active</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="2a50a6cd619a45ee86144599da112270"
				serviceId="nabu.utils.List.unique"
				resultName="result0170555d261942f3969a23237ce52d44"
				temporaryMapping="true"
				x="692"
				y="455"
				invocationOrder="2"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="7a5b5759b9ad491faf465b72a61ad820"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultbd8ee1ddd5494fd1a6f6de6656f13a60/list</from>
				<to>list</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="922c9b18b669437c8fe4481bc48ac806"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result0170555d261942f3969a23237ce52d44/list</from>
			<to>allExistingRelationTargetIds</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="f5aadef9bb9e4e27901be7ac12873a19"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result9fcad811ad5743d9a0848f060ca00eda/results[active != true]</from>
			<to>allInactivatedRelations</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="faf1c59c139848ec992763ed08a937b2"
				serviceId="nabu.utils.List.addAll"
				resultName="resultbd8ee1ddd5494fd1a6f6de6656f13a60"
				temporaryMapping="true"
				x="423"
				y="590"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d855202f8ad248c39ae28a0c96cc0127"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result9fcad811ad5743d9a0848f060ca00eda/results[targetId != null]/targetId</from>
				<to>objects</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="eddee44066d145ad8cd6375359313602"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>allExistingRelationTargetIds</from>
				<to>list</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="b4e109485e724950a4ae68f7747c0bb1"
			label="allExistingRelationTargetIds"
			lineNumber="10">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="acd921c75e7241758673f7118700718d"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceExternalId.services.list"
				resultName="result5451f0c02f834df991e49f2ec8bcd01f"
				temporaryMapping="true"
				x="140"
				y="51"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="15dd23cfa1cd4e7b8e5e455e2b9cc48a"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>allExistingRelationTargetIds</from>
				<to>filter/cdmInstanceId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="9a57f3f0e97845429a580a233517258b"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result5451f0c02f834df991e49f2ec8bcd01f/results</from>
			<to>allExistingRelationTargetExternalIds</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.For"
			disabled="false"
			id="9cd35a45cbdc4142ae9bcd48a15e2383"
			lineNumber="11"
			variable="subscription">
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="If we have a filter, check that we are interested"
				disabled="false"
				id="451e79842264480ca429eb4d1634cb5b"
				label="subscription/filter != null"
				lineNumber="12">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="cb6e9a08b5e5477299fbe50495d8e1fc"
					lineNumber="13">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="24a5d12f96634fcab70aa3cc0cf4d3eb"
						serviceId="nabu.services.glue.Services.evaluate"
						resultName="result8af07d66e6454123861a8e82b3a52997"
						temporaryMapping="true"
						x="299"
						y="182"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="baf3e7305540488793bc9eff0b30b871"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/filter</from>
						<to>rule</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="6c1000d625524c3387b28b0b623865f2"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>cdmInstance</from>
						<to>context[0]</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="296d708f3e104cc4ba53ee29ab43883b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result8af07d66e6454123861a8e82b3a52997/response</from>
					<to>interested</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Break"
					disabled="false"
					id="9a8718c21dce42f2b4bbb7497280c089"
					label="!interested"
					lineNumber="14">
				<count>2</count>
				<continueExecution>true</continueExecution>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get the current instance subscription and relations"
				disabled="false"
				id="6b69e25f25b348cd81d7661da8f30231"
				lineNumber="15">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="269cbf1b43394045baf081894df4f742"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>instanceSubscriptions[cdmSubscriptionId == /subscription/id]</from>
				<to>instanceSubscription</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
					disabled="false"
					id="cd049a87c41444bf93b30d5abfb11367"
					path="partialInstance" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="478269a449c1400cadfe55d00b2cc922"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>false</from>
				<to>push</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="99769bddef89485d919b9fcc34c04bbd"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>allExistingRelations[cdmSystemSubscriptionId == /subscription/id]</from>
				<to>existingRelations</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="62bcf17dde4745388d37400fb7b1bcd5"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/forcePull</from>
				<to>pullNewData</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="4f36f7db38f54dbda3176006e5869573"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>allInterestedRelationTypes[cdmSystemSubscriptionId == /subscription/id]</from>
				<to>interestedRelationTypes</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
					disabled="false"
					id="52169474f12f41a4a46f92791a25e278"
					path="changedRelations" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
					disabled="false"
					id="53fbe20a2a4f49d5b975891ca49b9ed7"
					path="interestingRelations" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
					disabled="false"
					id="2317e5a738df4e7e8267f41a260c8376"
					path="cdmDiff" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
					disabled="false"
					id="371b020d2cbd4c409fce6b3fe3aedf1e"
					path="interestingRelationsWithIds" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="0d75d09bfa1e4bcb9ea14e5410e5198c"
					fixedValue="true">
				<from>true</from>
				<to>isFirstSync</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Break"
				comment="If it's decoupled, we ignore it"
				disabled="false"
				id="a1affa07e8624896ad26b46418528a25"
				label="instanceSubscription/decoupled != null &amp;&amp; instanceSubscription/decoupled &lt;= date"
				lineNumber="16">
			<count>1</count>
			<continueExecution>true</continueExecution>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="If we have a previous content, diff it to get the actual change"
				disabled="false"
				id="99ebd193fddb43f58a710305c863bc8d"
				label="instanceSubscription/lastCdmInstanceContentId != null"
				lineNumber="17">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="e70e7f07a3aa4068918c2927112c0a2e"
					label="instanceSubscription/lastCdmInstanceContentId != previousContent/id"
					lineNumber="18">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="a3ed3ed41e194407a4cd64f4ebe86678"
						serviceId="nabu.frameworks.cdm.crud.cdmInstanceContent.services.get"
						resultName="resultdf5cc0d03d394024a8d633ae95e084df"
						temporaryMapping="true"
						x="37"
						y="61"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="40a29aaef66349ea97ab8de046517d34"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instanceSubscription/lastCdmInstanceContentId</from>
						<to>id</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="cfc1b39f966240318c58575af8923b16"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultdf5cc0d03d394024a8d633ae95e084df/result</from>
					<to>previousContent</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="556ad604630246f1bfbf8d8595ffda30"
						path="previousCdmInstance" xsi:nil="true"/>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Unmarshal previous content"
					disabled="false"
					id="b24b7b0511ec4d9eb3606b482b49d0f9"
					label="previousCdmInstance == null"
					lineNumber="19">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="b3e3996a31cf44cda60637a20b09ba5b"
						serviceId="nabu.data.json.Services.unmarshal"
						resultName="result389a096181764bee92c6fe9502d8ff8c"
						temporaryMapping="true"
						x="311"
						y="222"
						invocationOrder="1"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="aa02e434d63d4667a4fb705d9bd69a2c"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result64523c7a322d4b29884fb98289034c18/stream</from>
						<to>input</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="7a433842247b497b89f4697d97bf89b4"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>previousContent/typeId</from>
						<to>type</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="8bca85e68c794d89b616968cb31d36eb"
							fixedValue="true">
						<from>true</from>
						<to>ignoreUndefinedFields</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="5253859bc0724d3db5f59925fa18ec50"
						serviceId="nabu.utils.String.toStream"
						resultName="result64523c7a322d4b29884fb98289034c18"
						temporaryMapping="true"
						x="34"
						y="70"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="c5151e7f9df54b2d9a0f08d5e7eb0bf1"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>UTF-8</from>
						<to>charset</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e9bd1dcd5e104e5e881e10708cc2efcd"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>previousContent/content</from>
						<to>string</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="910298c1f9004ec592c19353ff4b50ed"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result389a096181764bee92c6fe9502d8ff8c/unmarshalled</from>
					<to>previousCdmInstance</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="72e2b8f360b4499cb894f29d47ce51f9"
					lineNumber="20">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="264ceab5834849179d50d5e363c497ff"
						serviceId="nabu.frameworks.cdm.utils.diff"
						resultName="resultf24d401a3c634222bf52c8ac718d43aa"
						temporaryMapping="true"
						x="95"
						y="152"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="df311ac275944f17a8c0a40c7a21488d"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>previousCdmInstance</from>
						<to>original</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="3163388fa9424db0ac1f4def4eab3236"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>cdmInstance</from>
						<to>new</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0d0b7ac01a774e66a80917e8b70eaf43"
							fixedValue="true">
						<from>false</from>
						<to>changedOnly</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="639e3529d5434deeb4f5ebb1085ae2fa"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultf24d401a3c634222bf52c8ac718d43aa/diffs</from>
					<to>cdmDiff</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="9f89b582dc254cf6b63fdba9e502a3b0"
						fixedValue="true">
					<from>false</from>
					<to>isFirstSync</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Break"
					description="No changes between versions, this should not occur"
					disabled="true"
					id="db88595e76b64ef88d652376343c7556"
					label="!cdmDiff &amp;&amp; subscription/system !# input/forcePushForSystem"
					lineNumber="21">
				<count>2</count>
				<continueExecution>true</continueExecution>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="No subscription yet, create it"
				disabled="false"
				id="86804d5db1924c979911c8e9715265f9"
				label="!instanceSubscription"
				lineNumber="22">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="3185ee12cd6544c98bb7ff320322c17d"
					serviceId="nabu.frameworks.cdm.crud.cdmInstanceSubscription.services.create"
					resultName="resultb3e4c754b5454ba189248b491714cdec"
					temporaryMapping="true"
					x="269"
					y="89"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8176d9b51b2a45bd9949dd4fe5ac866f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/cdmInstanceId</from>
					<to>instance/cdmInstanceId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f6bf40fed78c4ad9b7f29f1d9c0a4c43"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>subscription/id</from>
					<to>instance/cdmSubscriptionId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="8ee02f293d5342d98950ddb646b333d9"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultb3e4c754b5454ba189248b491714cdec/created</from>
				<to>instanceSubscription</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="28a0e53c43804565a955ad0274723dad"
					serviceId="nabu.utils.List.add"
					resultName="resultd01e31c6574e4a49b5c1ab70576dc5fe"
					temporaryMapping="true"
					x="776"
					y="213"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="bb7094631d04439183ca2e9813727f2d"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultb3e4c754b5454ba189248b491714cdec/created</from>
					<to>object</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="931ab98e43f04db39f4e515675ebaef3"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>instanceSubscriptions</from>
					<to>list</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="54f7bc65dc1a4d1bb3b865cf358912f0"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultd01e31c6574e4a49b5c1ab70576dc5fe/list</from>
				<to>instanceSubscriptions</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Unmarshal the content if we have it"
				disabled="false"
				id="b9a17fc543e749089e00a37c2671a397"
				label="instanceSubscription/content != null"
				lineNumber="23">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="9d7bfca6ffc742b9be6a2c45c0f2b5a1"
					serviceId="nabu.data.json.Services.unmarshal"
					resultName="resultffe171ae34a4424a980935209f42ef0b"
					temporaryMapping="true"
					x="460"
					y="108"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="744bcc4f6d614fd08e4b472850902f9f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result902358dc10374006a97af3a8d18f7146/first</from>
					<to>type</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d3c8ce3269fa49c4aa7d2b0592a6a9b4"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result3bc1f50959f946408d8cb565bf8660ce/stream</from>
					<to>input</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="c595e547401442bc837080fb34673a0c"
						fixedValue="true">
					<from>true</from>
					<to>ignoreUndefinedFields</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="b5af7116ed8041e6842d26debcceb228"
					serviceId="nabu.utils.Object.first"
					resultName="result902358dc10374006a97af3a8d18f7146"
					temporaryMapping="true"
					x="23"
					y="58"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d29f415361d1407aa9141bdae91c5c92"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>subscription/typeId</from>
					<to>options[0]</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="899cc828e755416085470034484b3bbe"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>subscription/coreTypeId</from>
					<to>options[1]</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="666bd20f09d04f42939c7e57d7b52d5f"
					serviceId="nabu.utils.String.toStream"
					resultName="result3bc1f50959f946408d8cb565bf8660ce"
					temporaryMapping="true"
					x="59"
					y="245"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="b9b07165b6a74a2c9de439d11c7f69c1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>instanceSubscription/content</from>
					<to>string</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="c9255f798fec4c1a94dd60f34d8cb77d"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>UTF-8</from>
					<to>charset</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="e4565322aaf043548b9a4fc7f478557e"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultffe171ae34a4424a980935209f42ef0b/unmarshalled</from>
				<to>partialInstance</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get interested relations"
				disabled="false"
				id="465168b1357345f78eb4ae556c041912"
				label="interestedRelationTypes"
				lineNumber="24">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="651f0d3dc8b441e9a310f38d08b289f5"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>allExistingRelations[cdmSystemSubscriptionId != /subscription/id &amp;&amp; cdmRelationTypeId # /interestedRelationTypes/cdmRelationTypeId]</from>
				<to>interestingRelations</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d5700c9ee6424bf78b62e22ea76decb2"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>allInactivatedRelations[cdmSystemSubscriptionId != /subscription/id &amp;&amp; cdmRelationTypeId # /interestedRelationTypes/cdmRelationTypeId]</from>
				<to>interestingInactivatedRelations</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				comment="Get changed relations (if any)"
				disabled="false"
				id="1f634d45a4c645d4a5d4d8b64e66819c"
				label="interestingRelations"
				lineNumber="25">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Figure out the changed relations before we do any updates to them. Note that if the change is &quot;inactivation&quot;, we are also interested!"
					disabled="false"
					id="dc626554df834aedb5dd4bf449381ee0"
					label="instanceSubscription/pushed != null"
					lineNumber="26">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="dcf31bd6049448de968bc77db22e90cf"
						serviceId="nabu.utils.List.addAll"
						resultName="resulte23301bc39ff441e8af58605096ec600"
						temporaryMapping="true"
						x="331"
						y="94"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="fcc12eb87a054a529c40af31571d1f46"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>interestingInactivatedRelations[started &gt;= /instanceSubscription/pushed || (stopped != null &amp;&amp; stopped &gt;= /instanceSubscription/pushed) || (modified != null &amp;&amp; modified &gt;= /instanceSubscription/pushed)]</from>
						<to>list</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d9f00a7705dc4861a0d5602baaf546e9"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>interestingRelations[started &gt;= /instanceSubscription/pushed || (stopped != null &amp;&amp; stopped &gt;= /instanceSubscription/pushed) || (modified != null &amp;&amp; modified &gt;= /instanceSubscription/pushed)]</from>
						<to>objects</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="cab57a16e6344b58a52deba3d193ff0a"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resulte23301bc39ff441e8af58605096ec600/list</from>
					<to>changedRelations</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="3ef996e0abc44352b436a7d4c1aabb31"
					lineNumber="27">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="ee77f9966fff44efa25a1cfe3c90234c"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>interestingRelations</from>
					<to>changedRelations</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="If we aren't pushing but interesting relations have been updated, push anyway"
				disabled="false"
				id="9f5df03d2f8c48bfab684f9018f5eb54"
				label="!push &amp;&amp; changedRelations != null"
				lineNumber="28">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="11886c295f2c47b3a13eeacb62ba1c29"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>push</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="If the external ids were modified, also do a push. This assumes external ids do not modify often!"
				disabled="false"
				id="040be642c7a545b4806f9dfaae178076"
				label="!push &amp;&amp; instanceSubscription/pushed != null &amp;&amp; instanceSubscription/pushed &lt;= mostRecentExternalIdModification"
				lineNumber="29">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="bbe99dbf7f0644488b4e893a2a5cb927"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>push</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="99135964fd6446a4a6a7b4656bae5b2a"
				label="!push &amp;&amp; input/forcePushForSystem != null &amp;&amp; subscription/system # input/forcePushForSystem"
				lineNumber="30">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="02b9dc4f96904670809830d0038f391c"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>push</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="If we are not intent on pushing but there is no partial instance just yet, push it"
				disabled="false"
				id="2e48891ebde246348d528eb8d7f4afbd"
				label="!push &amp;&amp; partialInstance == null"
				lineNumber="31">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="622a7fdd4d8b405495562a6415254271"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>push</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="If we have never pushed, push now"
				disabled="false"
				id="5f96cf2352b84ceb8b8628f78fd49074"
				label="!push &amp;&amp; instanceSubscription/pushed == null"
				lineNumber="32">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d62810af82ba4541b3bccb13a3944536"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>push</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="Always calculate the patched instance in case we want to push it must be available"
				disabled="false"
				id="36a1cf0cce5441748b055782b4d9d2c3"
				label="partialInstance != null"
				lineNumber="33">
			<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
					comment="Check which diff we want to apply"
					disabled="false"
					id="e994ed4aefbc4d6589795824aa463cff"
					lineNumber="34">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="If we have no cdm diff (first sync of entire cdm instance), we diff against the full thing"
						disabled="false"
						id="b92c2b521a424531b6b877d250ca9fb8"
						label="isFirstSync || subscription/system # input/fullPushForSystem"
						lineNumber="35">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="b41e8892d2c54e57b9a3b0db397f0587"
							serviceId="nabu.frameworks.cdm.utils.diff"
							resultName="result104dde8382fc43cf9beb8fee1f16aeaf"
							temporaryMapping="true"
							x="71"
							y="110"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="75c817201d21486ab7300d959cdc7580"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>cdmInstance</from>
							<to>new</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="bc8e106dc941409a97196c7b23fa3a9e"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>partialInstance</from>
							<to>original</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9e55d6c3b0da4bd4a5b849232a63fc7b"
								fixedValue="true">
							<from>false</from>
							<to>changedOnly</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="bf0d2b94d3a84dac8faa0f9d5ab5c863"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result104dde8382fc43cf9beb8fee1f16aeaf/diffs</from>
						<to>diffToApply</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="We only apply actual changes we noticed, not the full cdm, this leaves unreported changes as is for the next pickup"
						disabled="false"
						id="667b9763e0cf4c61a6dcfb8d975a5374"
						lineNumber="36">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="3dd14a4ce4f34e2491bca0240d6ee05b"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>cdmDiff</from>
						<to>diffToApply</to>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Make a masked instance so we can diff changes"
					disabled="false"
					id="54055938073d43b3bfcff754c8990e8c"
					lineNumber="37">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="9fe510af26ef4800835cf85adef3dd73"
						serviceId="nabu.utils.reflection.Type.mask"
						resultName="resultcd6647e639e348e6a41a7777bd6291d0"
						temporaryMapping="true"
						x="402"
						y="200"
						invocationOrder="1"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="60be8a5d32cc42bbac41df4480d8a2cf"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>partialInstance</from>
						<to>instance</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="8441c32898f746658aab9ac38c4b62a7"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result591302c7e709455bb2db428f4d111d3d/typeId</from>
						<to>type</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="dc8241e03d294af2ae63e09eeb041eed"
						serviceId="nabu.utils.reflection.Type.of"
						resultName="result591302c7e709455bb2db428f4d111d3d"
						temporaryMapping="true"
						x="36"
						y="72"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="255c3d30f90643d29fecf83ff86dcdc0"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>partialInstance</from>
						<to>typeInstance</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8608849a0aff44e8ada2ffdd30f6d6d8"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultcd6647e639e348e6a41a7777bd6291d0/masked</from>
					<to>patchedPartialInstance</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="01b1b8bb08304eedb8cc3c8ca0b55aaa"
						path="appliedDiffs" xsi:nil="true"/>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					disabled="false"
					id="ca336aefba324a3bb1e89d395f9b56a9"
					label="diffToApply"
					lineNumber="38">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Patch the masked instance"
						disabled="false"
						id="a4544dc730364f2a8038a3923fa974b6"
						lineNumber="39">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="0e25811c26f04012b8b14e19850069a3"
							serviceId="nabu.frameworks.cdm.utils.patch"
							resultName="result7c839e519cf5497296db0747c89b84ef"
							temporaryMapping="true"
							x="236"
							y="65"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="6dda9496368c4e4d93ee5822d68f3748"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>diffToApply</from>
							<to>diffs</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="b917d4e88b05422786aae4376f0306bb"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>patchedPartialInstance</from>
							<to>instance</to>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
						disabled="false"
						id="e81e6d652e2e427c95d0679678f08990"
						lineNumber="40"
						query="subscription/slaveTypeId">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Diff the masked"
							disabled="false"
							id="d451521b8eee4bba9f4a8c198d356db5"
							label="null"
							lineNumber="41">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="b48ae9930ddf4069b1a9412b3b9b8079"
								serviceId="nabu.frameworks.cdm.utils.diff"
								resultName="resultb0dec1ae89e04adb92a3b6c9c0200b0d"
								temporaryMapping="true"
								x="199"
								y="129"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="318367004d8b491c88d0ea19b9d938f9"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>partialInstance</from>
								<to>original</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="82eb9eb3620541c69cfa2a71030fcfcf"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>patchedPartialInstance</from>
								<to>new</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9b383f2d672e4dd89f40cf1796d868a5"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>resultb0dec1ae89e04adb92a3b6c9c0200b0d/diffs</from>
							<to>appliedDiffs</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Diff the cast version of the slave. Any changes to unchangeable fields should not trigger a sync"
							disabled="false"
							id="face5ee0121342f78e1cbdc05fc281a4"
							lineNumber="42">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="a800e161f2984b02a900b5b843edc37b"
								serviceId="nabu.frameworks.cdm.utils.diff"
								resultName="resultb0dec1ae89e04adb92a3b6c9c0200b0d"
								temporaryMapping="true"
								x="467"
								y="158"
								invocationOrder="1"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="4b9011eda1214a3b9565f5214f811fdb"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>resultea0f5c44cfc84354a0e6355e040c99c6/masked</from>
								<to>new</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="f0af537b03e34bbdb37d52c5de25b933"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result182474d388644f1b8019b741b6dcc5a5/masked</from>
								<to>original</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="e8bab844bd59421a820e8be3d52bc3c6"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>resultb0dec1ae89e04adb92a3b6c9c0200b0d/diffs</from>
							<to>appliedDiffs</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="0a0dccc107854281a4bd30dde4beb16c"
								serviceId="nabu.utils.reflection.Type.mask"
								resultName="result182474d388644f1b8019b741b6dcc5a5"
								temporaryMapping="true"
								x="80"
								y="113"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="7d980fc374e446099d427d6e3c880d2b"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>partialInstance</from>
								<to>instance</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="911ef24e5c7f4f3db0b83d95b7a37398"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>subscription/slaveTypeId</from>
								<to>type</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="efa719c88b3348a28c6f62a4872f17e5"
								serviceId="nabu.utils.reflection.Type.mask"
								resultName="resultea0f5c44cfc84354a0e6355e040c99c6"
								temporaryMapping="true"
								x="69"
								y="299"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="196b2de560dd4005ac94a5798cef4722"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>patchedPartialInstance</from>
								<to>instance</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="baeff43293d842f480505ce4d90c1d99"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>subscription/slaveTypeId</from>
								<to>type</to>
							</steps>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="If we were not intending on pushing just yet, we do now"
						disabled="false"
						id="f7a2d5a4e13145a2a622b2530477c8ef"
						label="!push"
						lineNumber="43">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="ed6d0816566f48cdab98744dd25360ff"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>=appliedDiffs != null</from>
						<to>push</to>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="We want to proactively revert forbidden diffs if you have changed something you are not master of"
					disabled="false"
					id="fb884cb0c87e408385992d9348570773"
					label="subscription/masterTypeId != null"
					lineNumber="44">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Diff our patched instance against the cdm and get all the fields that you are allowed to change"
						disabled="false"
						id="14a8096fad534d2aaaa1634592e92131"
						lineNumber="45">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="6a661863fd304ef7a75fcbfcfe8d7a83"
							serviceId="nabu.frameworks.cdm.utils.diff"
							resultName="result1a43fa07b3cc40379a81e47e265f4f9e"
							temporaryMapping="true"
							x="226"
							y="86"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="8cbb02c396d74159927bad42a4bd98f3"
								fixedValue="false">
							<from>cdmInstance</from>
							<to>new</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f74c1e45f2584d108903e548febdfa46"
								fixedValue="true">
							<from>false</from>
							<to>changedOnly</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="995bc13492a14aaa94e570c789c7ab46"
								fixedValue="false">
							<from>patchedPartialInstance</from>
							<to>original</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="2bcfe197be6948ad83dd3fa4c57b37f7"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result1a43fa07b3cc40379a81e47e265f4f9e/diffs</from>
						<to>revertToCdmDiffs</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="bc0407b02eeb4068a10ad3e629de8a3e"
							serviceId="nabu.utils.reflection.Type.describe"
							resultName="result9f33297a72514b099dbfb0adeecaaa73"
							temporaryMapping="true"
							x="309"
							y="232"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="076841beb8f242d2a3ce8d144806b1e4"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/masterTypeId</from>
							<to>typeId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="fac0526b943d479e881f676da01356ff"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>true</from>
							<to>recursive</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="58d9d30182194ca78fd1733ec3e24a43"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result9f33297a72514b099dbfb0adeecaaa73/parameters</from>
						<to>masterParameters</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Retain reversion diff for paths that are not in the master"
						disabled="false"
						id="48307ca528cb46bd8a85586cbe3ad4de"
						lineNumber="46">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="95840b02b4cd403dbe776a5e0307a0ba"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>revertToCdmDiffs[propertyPath !# /masterParameters/path]</from>
						<to>revertToCdmDiffs</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						comment="If you have diffs to revert but you also have a slave document, make sure we only revert diffs you must follow"
						disabled="false"
						id="e8038aa36aad46fab72a1d7208b4cf0c"
						label="revertToCdmDiffs != null &amp;&amp; subscription/slaveTypeId != null"
						lineNumber="47">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="2ba687c91060428b894110d4013599e4"
							lineNumber="48">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="c05b71bb86214a2f858d04d97ea144a2"
								serviceId="nabu.utils.reflection.Type.describe"
								resultName="result73061734c6434fc785f96ddeb0f4bff5"
								temporaryMapping="true"
								x="136"
								y="50"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="fecd8bb8d104454ba8830c7b46cec6a6"
									fixedValue="false">
								<from>subscription/slaveTypeId</from>
								<to>typeId</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="85d0859864bb4833ab552a03e57ac79f"
								fixedValue="false">
							<from>result73061734c6434fc785f96ddeb0f4bff5/parameters</from>
							<to>slaveParameters</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Limit to slave parameters"
							disabled="false"
							id="ebced4c734a44a208912c8fe78f18e65"
							lineNumber="49">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="98c167387a3f45659bb70c3fb4285b13"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>revertToCdmDiffs[propertyPath # /slaveParameters/path]</from>
							<to>revertToCdmDiffs</to>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Make sure we push to revert unauthorized changes"
						disabled="false"
						id="fee008aaa5394e029cf7032bff3a9dc7"
						label="revertToCdmDiffs"
						lineNumber="50">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="6dffdd2934624751889e93e8c0e24f06"
							fixedValue="true">
						<from>true</from>
						<to>push</to>
					</steps>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="If we want to push at this point, let's do it"
				disabled="false"
				id="cbf94e36ee064b4ea604de0b810e5e32"
				label="push"
				lineNumber="51">
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="Pull: in some cases we need to refresh the data BEFORE we push it, to make sure we don't rollback pending changes"
					disabled="false"
					id="dba4d61c39224cf28cefc4e79363a336"
					lineNumber="52">
				<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
						disabled="false"
						id="cbf7945cc16b452fa4b152af6223f17f"
						lineNumber="53">
					<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
							comment="If you have a pullinterval, check if we are beyond it"
							disabled="false"
							id="1cff32cfb0b847bfb8b1ef14e69852a5"
							label="instanceSubscription/pulled != null &amp;&amp; subscription/pullInterval != null"
							lineNumber="54">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Calculate the next pull window"
								disabled="false"
								id="c5f3a44f253449e8b6444ff5eeff9656"
								lineNumber="55">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="e03df6f8b9b74b0bbb1b446860b795c0"
									serviceId="nabu.utils.Date.incrementDuration"
									resultName="result5bfa6321f9b640cbb5facac56d37561d"
									temporaryMapping="true"
									x="219"
									y="120"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="f22e33ff33e04a38907958c80e5291a5"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>subscription/pullInterval</from>
									<to>duration</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="7194becb482a47fe9eb045add5fc7bd1"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>instanceSubscription/pulled</from>
									<to>start</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="4a136e76cc9a41ec9fd863db9c989247"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result5bfa6321f9b640cbb5facac56d37561d/date</from>
								<to>nextPull</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Calculate whether or not to pull based on the available interval"
								disabled="false"
								id="6b01386f6b4942a29c1a274af44e1766"
								lineNumber="56">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="0d31bbc53e8b4ba68c6d3dc2c2927c51"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>=date &gt;= nextPull</from>
								<to>pullNewData</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Check that we don't need to skip it"
								disabled="false"
								id="3aac6e8f3bd64460be4d7cb7421dd813"
								label="input/skipPullForSystem != null &amp;&amp; pullNewData"
								lineNumber="57">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="4a3e4989e86f491c8e1b62a4a37fe7dc"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>=subscription/system !# /input/skipPullForSystem</from>
								<to>pullNewData</to>
							</steps>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="If we have a pull service but have not yet pulled, do that first. If we have pulled before but you claim to be trigger only, we want to make absolutely sure we didn't miss a trigger. Either webhook failure, configuration error,..."
							disabled="false"
							id="8c39e658dac5486a9383159b66570372"
							label="subscription/pullId != null &amp;&amp; (instanceSubscription/pulled == null || subscription/triggerOnly == true)"
							lineNumber="58">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="96bac7c05a734c3c9fd4df63204b96fc"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>true</from>
							<to>pullNewData</to>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						comment="Refresh potentially stale data first"
						disabled="false"
						id="f1a03dc39cb6491482ab9662175c4974"
						label="subscription/pullId != null &amp;&amp; pullNewData"
						lineNumber="59">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="d4e23b29cbc94b71bfa396fad18c33b6"
							lineNumber="60">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="82a793554830497997dc523ec3ee1602"
								serviceId="nabu.frameworks.cdm.specs.pull"
								resultName="result7183429fcb04496d9a75bc61d18aba32"
								temporaryMapping="true"
								x="78"
								y="36"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="d9111639041e4fc4b6181c368cd94ffb"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>externalIds</from>
								<to>externalIds</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="5e78a274c44843b2ab85fd95b2c3d943"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>input/cdmInstanceId</from>
								<to>cdmInstanceId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="ab5412bd2b9f4084920568e991af313d"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>subscription/pullId</from>
								<to>implementationId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="6eea7e65f43545039c41732070b765d5"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>existingRelations</from>
								<to>relations</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="fefbacb7deae4630833a61630f1b85f8"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result7183429fcb04496d9a75bc61d18aba32/externalIds</from>
							<to>newExternalIds</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="39c24ff1b8cb4afda9a22c04f2c99355"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>date</from>
							<to>instanceSubscription/pulled</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="848dd845961b48b192b39a8db2af890e"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result7183429fcb04496d9a75bc61d18aba32/cdmInstance</from>
							<to>newestPartialInstance</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="34a2c0c039f84c8bbe9d39208388afbd"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result7183429fcb04496d9a75bc61d18aba32/relations</from>
							<to>newRelations</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Update the ids"
							disabled="false"
							id="85b3245ea4094a81be16363511293e35"
							label="newExternalIds"
							lineNumber="61">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="6cf7e93e611e4992b036a591cfde2745"
								serviceId="nabu.frameworks.cdm.utils.externalId.update"
								resultName="result35cf43d44d4343a393614080fe7f194e"
								temporaryMapping="true"
								x="170"
								y="85"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="964472ec7f674609956afb0468b8a211"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>input/cdmInstanceId</from>
								<to>cdmInstanceId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="0508f1ac7976489da0addf480f2ad304"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>newExternalIds</from>
								<to>newExternalIds</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="894bfedb901c4031b2557fac6fe04a73"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>externalIds</from>
								<to>existingExternalIds</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="f4e5788c7ee74349a72edc6511579af1"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>instanceSync/id</from>
								<to>cdmInstanceSyncId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="501d507de8414642897e932df8c3b2a3"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>instanceSubscription/id</from>
								<to>cdmInstanceSubscription</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="3d7cd2ee60bb442db884be87f2ed583d"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result35cf43d44d4343a393614080fe7f194e/externalIds</from>
							<to>externalIds</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="d3fd90407aa44234820d0059fa121c88"
								serviceId="nabu.utils.List.addAll"
								resultName="result7984e6eb17a841c68fb85731972df2ef"
								temporaryMapping="true"
								x="507"
								y="341"
								invocationOrder="1"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="7a38626d6933411795948ecb967a89cb"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result35cf43d44d4343a393614080fe7f194e/logs</from>
								<to>objects</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="190c061fcd664632940e5a08b135a97c"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>logs</from>
								<to>list</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="c4a3d23bc5664f07a0cb4522d3f58df7"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result7984e6eb17a841c68fb85731972df2ef/list</from>
							<to>logs</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="2815fabf31764ac2866a61cd2a3c7da7"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>true</from>
							<to>output/hasNewMetadata</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
							comment="If we had an instance but no longer have one, we set to decoupled and skip"
							disabled="false"
							id="257de5fdc8074f2fa2ddb923e512c2eb"
							label="newestPartialInstance == null &amp;&amp; partialInstance != null"
							lineNumber="62">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Set decoupled"
								disabled="false"
								id="f5d7b17cc44e4dbb92c42318e8915d70"
								lineNumber="63">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="7d4137b6a8e140d1b784ad0709feed7d"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>date</from>
								<to>instanceSubscription/decoupled</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
									disabled="false"
									id="31d40dce32714d33a250892463f576f0"
									path="instanceSubscription/content" xsi:nil="true"/>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Break"
								disabled="false"
								id="d858080656ed46a9984cf6cc68cff605"
								lineNumber="64">
							<count>5</count>
							<continueExecution>true</continueExecution>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="073aa9d29a7745f8a83c0356cb40fa61"
							lineNumber="65">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="26fdfc8c9c774cc1b9a1f5dadebe6f59"
								serviceId="nabu.frameworks.cdm.utils.relation.update"
								resultName="result267941eb0565452e8d2e8bb5ebb9e2a9"
								temporaryMapping="true"
								x="66"
								y="54"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="ed59964937b94933ae3c163434642819"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>input/cdmInstanceId</from>
								<to>cdmInstanceId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="f30d584c21934784b75073d1bb681bec"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>newRelations</from>
								<to>newRelations</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="60044718bfc84ba6a0030f37b4782197"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>existingRelations</from>
								<to>existingRelations</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="6c5eff5419a64ecea233ded70b956d06"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>subscription/cdmDefinitionId</from>
								<to>cdmDefinitionId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="cd25dda848364291bfd4c97f7c798d24"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>subscription/id</from>
								<to>cdmSystemSubscriptionId</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="78c6cb7f04c44ea9aa56ecf92e09d90b"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result267941eb0565452e8d2e8bb5ebb9e2a9/existingRelations</from>
							<to>existingRelations</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="0457906455594e34862ed55a49975477"
								serviceId="nabu.utils.List.addAll"
								resultName="resultae3aa067c5cb471d842ca58b086b7ea8"
								temporaryMapping="true"
								x="299"
								y="266"
								invocationOrder="1"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="a9a221186f9f4f40afd53d5e9e0cdddf"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result267941eb0565452e8d2e8bb5ebb9e2a9/newRelations</from>
								<to>objects</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="4f732e3f56b44bb1b50144f4290fd3d6"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>allExistingRelations</from>
								<to>list</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="e9c04a8cdd694f53ba1e0e398fe5ae6c"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>resultae3aa067c5cb471d842ca58b086b7ea8/list</from>
							<to>allExistingRelations</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="If we have a new instance, it may be of a different type (e.g. master) which may have less information than the core definition. So we don't map it in full but use a map by key to update specific values"
							disabled="false"
							id="f177683cfedf4ebdbf3489a925b89bdc"
							label="partialInstance != null"
							lineNumber="66">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="a28ca62f5f7a4b8686ba1c78691e26a5"
								serviceId="nabu.utils.Object.mapByKey"
								resultName="result7face7d0f076489fa07ea825790e0f64"
								temporaryMapping="true"
								x="244"
								y="234"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="9f03ac6f883249fe9e0e581825d22431"
									fixedValue="false">
								<from>newestPartialInstance</from>
								<to>from</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="ff7bbbab16dd45d4ad885699c6f0a719"
									fixedValue="false">
								<from>partialInstance</from>
								<to>into</to>
							</steps>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
							comment="Make sure we have a correct partial instance, we recalculate the diff to apply (same code as above) on the new partial instance"
							disabled="false"
							id="042d9859899445629b1caa39b950eb71"
							lineNumber="67"
							query="partialInstance">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Push a masked version of the current content"
								disabled="false"
								id="754602a8b8b34af2afe15099fbda80c5"
								label="null"
								lineNumber="68">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="34666b682dff4a5ab199d8f23508b2b4"
									serviceId="nabu.utils.reflection.Type.mask"
									resultName="result5211ea5434e34fee8c30dfb90b6241ed"
									temporaryMapping="true"
									x="350"
									y="211"
									invocationOrder="1"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="83be00fbf7d241f3a987672bb22cff92"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>resultb9458ad39dd24836aabbf5d2cfec7afe/first</from>
									<to>type</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="11dd87e480244b23bd2ec2c4c2cd38cc"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>cdmInstance</from>
									<to>instance</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="1619b6afa96147debe2197e9a5728a18"
									serviceId="nabu.utils.Object.first"
									resultName="resultb9458ad39dd24836aabbf5d2cfec7afe"
									temporaryMapping="true"
									x="14"
									y="135"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="9fcc4bd987ca40ce9b19b98dc7fcf6ff"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>subscription/coreTypeId</from>
									<to>options[1]</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="604346b0735f4bcd82b03215fcbb0b74"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>subscription/typeId</from>
									<to>options[0]</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="34a11e2e14154cad8e91c5981a2dc1c7"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result5211ea5434e34fee8c30dfb90b6241ed/masked</from>
								<to>patchedPartialInstance</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
									disabled="false"
									id="3ebcf4ab030145bd800566cf5a9044c0"
									path="appliedDiffs" xsi:nil="true"/>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
								disabled="false"
								id="8a8899f28b7641bcac5546c3c531a834"
								lineNumber="69">
							<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
									comment="Check which diff we want to apply"
									disabled="false"
									id="ec294afc6a0f45c086fd33124403f7ba"
									lineNumber="70">
								<steps xsi:type="be.nabu.libs.services.vm.step.Map"
										comment="If we have no cdm diff (first sync of entire cdm instance), we diff against the full thing"
										disabled="false"
										id="49fec5a94f3646c38aa4eecefd0b8f73"
										label="isFirstSync|| subscription/system # input/fullPushForSystem"
										lineNumber="71">
									<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
											disabled="false"
											id="a1f8e0295b654532bf64854a17d6f141"
											serviceId="nabu.frameworks.cdm.utils.diff"
											resultName="result104dde8382fc43cf9beb8fee1f16aeaf"
											temporaryMapping="true"
											x="71"
											y="110"
											invocationOrder="0"
											asynchronous="false"
											recache="false">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="196b460e42404ad98d911ede4bc986f2"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>cdmInstance</from>
											<to>new</to>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="e912e012212a49dbb4538103d0d94817"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>partialInstance</from>
											<to>original</to>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="164761834ce94e4586241aa330b68759"
												fixedValue="true">
											<from>false</from>
											<to>changedOnly</to>
										</steps>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="f77e68038ee94b6a8a38b202d39947fc"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>result104dde8382fc43cf9beb8fee1f16aeaf/diffs</from>
										<to>diffToApply</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Map"
										comment="We only apply actual changes we noticed, not the full cdm, this leaves unreported changes as is for the next pickup"
										disabled="false"
										id="a0ab974ebd154ad19f88e92b89f2cdb6"
										lineNumber="72">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="ad8f25cc2fc14a6494e9143617e2e4d4"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>cdmDiff</from>
										<to>diffToApply</to>
									</steps>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Map"
									comment="Make a masked instance so we can diff changes"
									disabled="false"
									id="85cd6980258040bd86dcec236c73e940"
									lineNumber="73">
								<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
										disabled="false"
										id="13fa4bb6084649879ca04a33e97b6351"
										serviceId="nabu.utils.reflection.Type.mask"
										resultName="resultcd6647e639e348e6a41a7777bd6291d0"
										temporaryMapping="true"
										x="402"
										y="200"
										invocationOrder="1"
										asynchronous="false"
										recache="false">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="604f08378d4c412c892913caeae523ad"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>partialInstance</from>
										<to>instance</to>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="994d44f75c964612b60e2348e3a35156"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>result591302c7e709455bb2db428f4d111d3d/typeId</from>
										<to>type</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
										disabled="false"
										id="be635669b5b84bceae151af2557f771e"
										serviceId="nabu.utils.reflection.Type.of"
										resultName="result591302c7e709455bb2db428f4d111d3d"
										temporaryMapping="true"
										x="36"
										y="72"
										invocationOrder="0"
										asynchronous="false"
										recache="false">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="3a25268ad1be4350a79876356c26461a"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>partialInstance</from>
										<to>typeInstance</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="572f619afc814dc4964e7a817a66f8e3"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>resultcd6647e639e348e6a41a7777bd6291d0/masked</from>
									<to>patchedPartialInstance</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
										disabled="false"
										id="d875a87f877342eca113c3076a13aece"
										path="appliedDiffs" xsi:nil="true"/>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
									disabled="false"
									id="1d204adfc4294a98b199d56263e78644"
									label="diffToApply"
									lineNumber="74">
								<steps xsi:type="be.nabu.libs.services.vm.step.Map"
										comment="Patch the masked instance"
										disabled="false"
										id="7915d995367049a9b6221c79d23a2d79"
										lineNumber="75">
									<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
											disabled="false"
											id="7f19490b45e0449cb1e97162ab991083"
											serviceId="nabu.frameworks.cdm.utils.patch"
											resultName="result7c839e519cf5497296db0747c89b84ef"
											temporaryMapping="true"
											x="236"
											y="65"
											invocationOrder="0"
											asynchronous="false"
											recache="false">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="dc21c84746034d0bb00c90ce90aceb1b"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>diffToApply</from>
											<to>diffs</to>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="05db97e7f74645d2babad41e08d65e2a"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>patchedPartialInstance</from>
											<to>instance</to>
										</steps>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
										disabled="false"
										id="d5587294311e414d84c14cbc450d89f5"
										lineNumber="76"
										query="subscription/slaveTypeId">
									<steps xsi:type="be.nabu.libs.services.vm.step.Map"
											comment="Diff the masked"
											disabled="false"
											id="00e5fbbc222d431e8cf3fe9435fb8645"
											label="null"
											lineNumber="77">
										<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
												disabled="false"
												id="1410591b35474904a2332492e3b5405d"
												serviceId="nabu.frameworks.cdm.utils.diff"
												resultName="resultb0dec1ae89e04adb92a3b6c9c0200b0d"
												temporaryMapping="true"
												x="199"
												y="129"
												invocationOrder="0"
												asynchronous="false"
												recache="false">
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="e3375a9f39d04da2adc0dc89a8642a68"
													mask="false"
													optional="false"
													fixedValue="false">
												<from>partialInstance</from>
												<to>original</to>
											</steps>
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="39988f582450490a9dde2a157a8016b2"
													mask="false"
													optional="false"
													fixedValue="false">
												<from>patchedPartialInstance</from>
												<to>new</to>
											</steps>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="2cb07b89b9d54919a7715677feffc616"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>resultb0dec1ae89e04adb92a3b6c9c0200b0d/diffs</from>
											<to>appliedDiffs</to>
										</steps>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Map"
											comment="Diff the cast version of the slave. Any changes to unchangeable fields should not trigger a sync"
											disabled="false"
											id="8392d461f4be4e4c9eb3017a394d9e5f"
											lineNumber="78">
										<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
												disabled="false"
												id="8d4285fcbb3648eeb058711928dfb186"
												serviceId="nabu.frameworks.cdm.utils.diff"
												resultName="resultb0dec1ae89e04adb92a3b6c9c0200b0d"
												temporaryMapping="true"
												x="467"
												y="158"
												invocationOrder="1"
												asynchronous="false"
												recache="false">
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="ec969455174c49c08ac6fee19753a894"
													mask="false"
													optional="false"
													fixedValue="false">
												<from>resultea0f5c44cfc84354a0e6355e040c99c6/masked</from>
												<to>new</to>
											</steps>
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="ebe8ef050471492b9368e2d2d4906342"
													mask="false"
													optional="false"
													fixedValue="false">
												<from>result182474d388644f1b8019b741b6dcc5a5/masked</from>
												<to>original</to>
											</steps>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="93d410177a6b4f9bbfd4216d0941aac0"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>resultb0dec1ae89e04adb92a3b6c9c0200b0d/diffs</from>
											<to>appliedDiffs</to>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
												disabled="false"
												id="8e3f31a57b3448108f3f96e65e1575be"
												serviceId="nabu.utils.reflection.Type.mask"
												resultName="result182474d388644f1b8019b741b6dcc5a5"
												temporaryMapping="true"
												x="80"
												y="113"
												invocationOrder="0"
												asynchronous="false"
												recache="false">
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="b5c0440b78004e40a9a10a9cf8e571aa"
													mask="false"
													optional="false"
													fixedValue="false">
												<from>partialInstance</from>
												<to>instance</to>
											</steps>
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="30072ed135344c67a60d17a374781d17"
													mask="false"
													optional="false"
													fixedValue="false">
												<from>subscription/slaveTypeId</from>
												<to>type</to>
											</steps>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
												disabled="false"
												id="f7e3ad1419ad4748a593b3f14e642a24"
												serviceId="nabu.utils.reflection.Type.mask"
												resultName="resultea0f5c44cfc84354a0e6355e040c99c6"
												temporaryMapping="true"
												x="69"
												y="299"
												invocationOrder="0"
												asynchronous="false"
												recache="false">
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="cd2f21ed7ed2445a8c43ad986fd0f60e"
													mask="false"
													optional="false"
													fixedValue="false">
												<from>patchedPartialInstance</from>
												<to>instance</to>
											</steps>
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="93d03b4515fb405a92f34e24be545952"
													mask="false"
													optional="false"
													fixedValue="false">
												<from>subscription/slaveTypeId</from>
												<to>type</to>
											</steps>
										</steps>
									</steps>
								</steps>
							</steps>
						</steps>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="If we have a master type, we need to &quot;overwrite&quot; any changes you might have done to fields that you are not master off"
					disabled="false"
					id="74676bf0d79c413e814bc6be917d97b0"
					label="subscription/masterTypeId != null &amp;&amp; patchedPartialInstance != null"
					lineNumber="79">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Diff our patched instance against the cdm and get all the fields that you are allowed to change"
						disabled="false"
						id="5b4f2142a1074c869c31df85f4e4e125"
						lineNumber="80">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="14eb68465f884618b9f294884a73939b"
							serviceId="nabu.frameworks.cdm.utils.diff"
							resultName="result1a43fa07b3cc40379a81e47e265f4f9e"
							temporaryMapping="true"
							x="226"
							y="86"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="0f96c5db477041ea97200d2703c9134c"
								fixedValue="false">
							<from>cdmInstance</from>
							<to>new</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9998fb60ad2e436591aaba6acd81fba6"
								fixedValue="true">
							<from>false</from>
							<to>changedOnly</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="1271db31aa39442da275cf719a15ad32"
								fixedValue="false">
							<from>patchedPartialInstance</from>
							<to>original</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="f5642dd3533d4dd69b6343b516b9ff77"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result1a43fa07b3cc40379a81e47e265f4f9e/diffs</from>
						<to>revertToCdmDiffs</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="8d46de1e0b474c2e81acf124348ac626"
							serviceId="nabu.utils.reflection.Type.describe"
							resultName="result9f33297a72514b099dbfb0adeecaaa73"
							temporaryMapping="true"
							x="309"
							y="232"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="600929c84a0144e9872229fc930dd491"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/masterTypeId</from>
							<to>typeId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="0728b04685df42a88b1ac7d6973d8d28"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>true</from>
							<to>recursive</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="817ca823b38a44daab636970cbebb56c"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result9f33297a72514b099dbfb0adeecaaa73/parameters</from>
						<to>masterParameters</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Retain reversion diff for paths that are not in the master"
						disabled="false"
						id="cb201e15e2db49d6bd1f0e0d222d4511"
						lineNumber="81">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="99783725f68640c98ccd3e28e7f4e292"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>revertToCdmDiffs[propertyPath !# /masterParameters/path]</from>
						<to>revertToCdmDiffs</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						comment="If you have diffs to revert but you also have a slave document, make sure we only revert diffs you must follow"
						disabled="false"
						id="b3cb60c1785644c8b9b602b44527bdda"
						label="revertToCdmDiffs != null &amp;&amp; subscription/slaveTypeId != null"
						lineNumber="82">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="c18cf05c29ff4e31a12a5b4e05a49139"
							lineNumber="83">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="f4f50cb67385444da684b1e92d8a0516"
								serviceId="nabu.utils.reflection.Type.describe"
								resultName="result73061734c6434fc785f96ddeb0f4bff5"
								temporaryMapping="true"
								x="136"
								y="50"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="3f785c13b4744de58b19d0c10a615a95"
									fixedValue="false">
								<from>subscription/slaveTypeId</from>
								<to>typeId</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="871322267ff543b2a65c0cca1e9950d9"
								fixedValue="false">
							<from>result73061734c6434fc785f96ddeb0f4bff5/parameters</from>
							<to>slaveParameters</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Limit to slave parameters"
							disabled="false"
							id="9f153335fec249eb92fe802b716f33b3"
							lineNumber="84">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="90fc4fcac58b447fb14883dbcbae97ce"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>revertToCdmDiffs[propertyPath # /slaveParameters/path]</from>
							<to>revertToCdmDiffs</to>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						comment="If we have any, apply them and log the reversion"
						disabled="false"
						id="11d161d5050b4c81bb9d0937ccd92604"
						label="revertToCdmDiffs"
						lineNumber="85">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="If we have any, apply them and log the reversion"
							disabled="false"
							id="86fa36ed82134602ab1a6647d9d1c05c"
							lineNumber="86">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="b88d2e5f9e51407bb01568dd6c3baae2"
								serviceId="nabu.frameworks.cdm.utils.patch"
								resultName="resultfeb124fc2b5d448588e8092217b8fb67"
								temporaryMapping="true"
								x="73"
								y="207"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="657f3dc12d6a4f438d2e4a641abc0d8e"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>revertToCdmDiffs</from>
								<to>diffs</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="a07bdeb370b442f48a1d44eb65eb70fc"
									fixedValue="false">
								<from>patchedPartialInstance</from>
								<to>instance</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="94435dd483904024b766d59f1accb4e1"
								serviceId="nabu.frameworks.cdm.utils.instance.serializeDiff"
								resultName="resulte5fed61ac5c041a2b5357233f89ae8f6"
								temporaryMapping="true"
								x="82"
								y="20"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="6f82f84925a84be18ae04613ffd81cfd"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>revertToCdmDiffs</from>
								<to>diffs</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="328b86d88bfb4658b1fb4f44be9adbeb"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>resulte5fed61ac5c041a2b5357233f89ae8f6/marshalled</from>
							<to>log/content</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="e2578fa832144ce0a940318b6493156c"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>date</from>
							<to>log/created</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="67d81776d7d3428da9dde18f7ed24357"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>revert-changed</from>
							<to>log/logType</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="abb45fcb1127433889bb0849375f115e"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>instanceSubscription/id</from>
							<to>log/cdmInstanceSubscription</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="df8eb19893154e5f96fa9bf1389affac"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>instanceSync/id</from>
							<to>log/cdmInstanceSyncId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="c6d952aca6224226afd4e5119f3cd2e7"
								serviceId="nabu.utils.Server.uuid"
								resultName="result77f6e15778a842ae8c3b6955d9660cd8"
								temporaryMapping="true"
								x="441"
								y="39"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="3aa991026c8c45cb8ef682544d6e6209"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result77f6e15778a842ae8c3b6955d9660cd8/uuid</from>
							<to>log/id</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="7215ae518521442a940e7e9ec8b364d1"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/cdmInstanceId</from>
							<to>log/cdmInstanceId</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="747f8be86fb345a480bca525c83b95ff"
							lineNumber="87">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="f65c4114b1b040b89031e671d5810799"
								serviceId="nabu.utils.List.add"
								resultName="result747601e4b6b449709764bff79738a1c9"
								temporaryMapping="true"
								x="165"
								y="160"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="cb781405b4a14149834183793c310edb"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>logs</from>
								<to>list</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="71ae614ff83f4a4da44f2155e3788a86"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>log</from>
								<to>object</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="cdc7122d77d74dbd8bab64bc5015e93d"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result747601e4b6b449709764bff79738a1c9/list</from>
							<to>logs</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
								disabled="false"
								id="e89e8cb9dff14bf7b51729f136500897"
								path="log" xsi:nil="true"/>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="1dbbc9d8de384e2fbb12b9ae966e1256"
								serviceId="nabu.utils.List.addAll"
								resultName="result5dc2d8468f2c4dd88a075019deda23be"
								temporaryMapping="true"
								x="80"
								y="41"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="db753189e74c4eb2aff66a101a78ead9"
									fixedValue="false">
								<from>revertToCdmDiffs</from>
								<to>objects</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="9325d7bdb37c4844a9503fea1e5936b2"
									fixedValue="false">
								<from>appliedDiffs</from>
								<to>list</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="feae29ac9fe74798b97daa701e48253c"
								fixedValue="false">
							<from>result5dc2d8468f2c4dd88a075019deda23be/list</from>
							<to>appliedDiffs</to>
						</steps>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="We have never pushed, let's push the current CDM content to ensure that it is brought into sync with the cdm as it is currently. @2025-07-30: presumably not needed because without push we don't have a last instance, without last instance we don't have a cdm diff."
					disabled="false"
					id="97fae49803084fc9aef5bdfa8f39b6df"
					label="instanceSubscription/pushed == null"
					lineNumber="88">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="We push the cdm instance as a whole to make sure all fields are up to date"
						disabled="false"
						id="1c4de5306dcd48edbd6240e705c2950d"
						lineNumber="89">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="d1689152ebe947dfaee6ac91692a067f"
							serviceId="nabu.utils.Object.first"
							resultName="resulte32ee87752d141fa9355791d71dbd7ad"
							temporaryMapping="true"
							x="106"
							y="167"
							invocationOrder="1"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="838f12e180594bd6b6b8c1d217ef8a9a"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/coreTypeId</from>
							<to>options[1]</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="e4c6948cf93444cf860a0cbeab1ee142"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/typeId</from>
							<to>options[0]</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="e94e06fc5ec84b3797cb0b191662d24f"
							serviceId="nabu.utils.reflection.Type.mask"
							resultName="result9b558c1bc88b4dfe902826aa874c02b1"
							temporaryMapping="true"
							x="605"
							y="125"
							invocationOrder="2"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="8ee19e69c78046a093deba90975059db"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>cdmInstance</from>
							<to>instance</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="deb9c3f436cd402db560e672b9d42deb"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>resulte32ee87752d141fa9355791d71dbd7ad/first</from>
							<to>type</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="92655cd1f12342168be16a7b1a93d2cd"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result9b558c1bc88b4dfe902826aa874c02b1/masked</from>
						<to>patchedPartialInstance</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
						disabled="false"
						id="515c20bd9cad4784a6d8a0b91a96deb5"
						lineNumber="90"
						query="partialInstance">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="aaacbf0d824247f3be89198b891d7a86"
							label="null"
							lineNumber="91">
						<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
								disabled="false"
								id="9c87d4358f8b4dbab8ae87133ccf4b97"
								path="appliedDiffs" xsi:nil="true"/>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="3caa8c4cce694bbcbadd836dea973207"
							lineNumber="92">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="7e172438f45b46539e79c4d2b100af04"
								serviceId="nabu.frameworks.cdm.utils.diff"
								resultName="result40202e4f31f5463d89299d5e1317945d"
								temporaryMapping="true"
								x="259"
								y="146"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="9122c8bdff7241388a8c0367ce41d0c0"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>partialInstance</from>
								<to>original</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="442473a7d9cd4c0d8cc39391b40a7a35"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>patchedPartialInstance</from>
								<to>new</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="749b139e4f1a4fd9a83e1ca40316bdf9"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result40202e4f31f5463d89299d5e1317945d/diffs</from>
							<to>appliedDiffs</to>
						</steps>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Reset rejected"
					disabled="false"
					id="aac2cc0f93674610ae17f66ccfb9d156"
					lineNumber="93">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="cc9c1a3eb0e34771b53ed95c957ee8ad"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>false</from>
					<to>rejected</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="80f72e31849646b7a560bd2d8fdef313"
						path="rejectionReason" xsi:nil="true"/>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="Enrich with external ids"
					disabled="false"
					id="76746ebf4d544977a096530fddecbd09"
					label="interestingRelations"
					lineNumber="94">
				<steps xsi:type="be.nabu.libs.services.vm.step.For"
						disabled="false"
						id="f6a036ca5cd640a78c7ba6455c2191e8"
						lineNumber="95"
						variable="singleInterestingRelation"
						into="interestingRelationsWithIds">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Map initial"
							disabled="false"
							id="8175b453426e44e79c12655ad5c423a8"
							lineNumber="96">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="b407752e735847bf908c392869fd4a2e"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>singleInterestingRelation</from>
							<to>interestingRelationsWithIds[0]</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Map external ids"
							disabled="false"
							id="90c67617f13b453b8d6c9c32bd3b9fb9"
							label="singleInterestingRelation/targetId != null"
							lineNumber="97">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9c5a9465baa140a980b029b80aa8401b"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>allExistingRelationTargetExternalIds[cdmInstanceId == /singleInterestingRelation/targetId]</from>
							<to>interestingRelationsWithIds[0]/targetExternalIds</to>
						</steps>
					</steps>
					<query>interestingRelations</query>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					disabled="false"
					id="25ef206d71a54d4d9daef3baaf84dbbd"
					lineNumber="98"
					scopeDefaultTransaction="true">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="d6b3bf8a67954136acca6df8a0a8ec7b"
						lineNumber="99">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="fbb3af112b5c4c659b777757d7852d8a"
							serviceId="nabu.frameworks.cdm.specs.push"
							resultName="result66c3d0f3aebe4c9596df5ce60f3bda6f"
							temporaryMapping="true"
							x="137"
							y="65"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="d49f94464db04ebd8e8e8a6dcf93c720"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>externalIds</from>
							<to>externalIds</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="a26718217f73435abfb495e984b8d1cb"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>patchedPartialInstance</from>
							<to>cdmInstance</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="e1cd59656cbe4c9c94b464447fec36b4"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/pushId</from>
							<to>implementationId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f62d5967300e4c7ab931134b4ceca091"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>existingRelations</from>
							<to>relations</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="692799ef588f40f48d497b57c912c31f"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>interestingRelationsWithIds</from>
							<to>interestingRelations</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d9e8484f44274d98a13c0329f9d8d703"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result66c3d0f3aebe4c9596df5ce60f3bda6f/externalIds</from>
						<to>newExternalIds</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="8b0f86a9779e4886873c6c0a13a7cb7f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result66c3d0f3aebe4c9596df5ce60f3bda6f/rejected</from>
						<to>rejected</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="badf254c7a9848fa9dc3467e504ef3fc"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result66c3d0f3aebe4c9596df5ce60f3bda6f/relations</from>
						<to>newRelations</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Defaults to false"
						disabled="false"
						id="40c41df8c6bf44968e9b3b4ef01d79e8"
						label="rejected == null"
						lineNumber="100">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="b941796e12cd411b9a6ba07515b8ed46"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>false</from>
						<to>rejected</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
						disabled="false"
						id="c2243305dcd04460b9ecdbb8c2dd7ce8"
						lineNumber="101"
						variable="exception">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="d1d29d9eacfd4d38b854124ac5fbbfcc"
							lineNumber="102">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f9be0a5c0cef40cbaebc4e6bc21de404"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>true</from>
							<to>rejected</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="1a85a00b03a442aba785dc72e8cdf414"
								serviceId="nabu.utils.Runtime.summarizeException"
								resultName="result5990a55b187b4e80bb88d45ea66f8fad"
								temporaryMapping="true"
								x="161"
								y="311"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="2c435ef308db4628a30d2bd3991cc1d1"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>exception</from>
								<to>exception</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="7d787d09c6764c7996b66331d1194689"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result5990a55b187b4e80bb88d45ea66f8fad/summary/exceptionStack</from>
							<to>rejectionReason</to>
						</steps>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Update the ids"
					disabled="false"
					id="58998ed9bb87401695f0ec19f343fb3c"
					label="newExternalIds"
					lineNumber="103">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="08d00c30ca704f279e31c675ccec59e3"
						serviceId="nabu.frameworks.cdm.utils.externalId.update"
						resultName="result35cf43d44d4343a393614080fe7f194e"
						temporaryMapping="true"
						x="170"
						y="85"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0d665b6ae4914fb49c39cae32e1d2800"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/cdmInstanceId</from>
						<to>cdmInstanceId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="163b1bbe0a3045b3b824b9e6f2b30da2"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>newExternalIds</from>
						<to>newExternalIds</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="075cf384be5b4c84afccefe798670c60"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>externalIds</from>
						<to>existingExternalIds</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="2a4077fce07642a1bee90adbf532b263"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instanceSubscription/id</from>
						<to>cdmInstanceSubscription</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="131f0a00b3de4d47bf9f2f504115b453"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instanceSync/id</from>
						<to>cdmInstanceSyncId</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f4556219132a4c71913b408b1b01417e"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result35cf43d44d4343a393614080fe7f194e/externalIds</from>
					<to>externalIds</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="cfaada80951e418d89f8cc9767d1204b"
						serviceId="nabu.utils.List.addAll"
						resultName="result543706be45754788aade5bec423cfff1"
						temporaryMapping="true"
						x="426"
						y="317"
						invocationOrder="1"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="79f556e5678b488cae2b51aa18a20f72"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result35cf43d44d4343a393614080fe7f194e/logs</from>
						<to>objects</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="3546c113730945f8a8ba0d4335460257"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>logs</from>
						<to>list</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="b8cdebaad0174268bb0643da745b9ed7"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result543706be45754788aade5bec423cfff1/list</from>
					<to>logs</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="e89209d6bee94369af743739d05bd254"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>output/hasNewMetadata</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.For"
					disabled="false"
					id="9e141712ece540a781f468245641d9c5"
					lineNumber="104"
					variable="appliedDiff"
					into="instanceSyncDiffs">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="6441928ac44142639daf31fbfa9718ee"
						lineNumber="105">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="28fe544f5360439d819389e7a591a70e"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>appliedDiff/propertyPath</from>
						<to>instanceSyncDiffs[0]/propertyPath</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="7bf715b3860c48ad8f999c6710f89160"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>appliedDiff/path</from>
						<to>instanceSyncDiffs[0]/path</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="6e60e0906b7f4ac584a52a8e455ed40a"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>appliedDiff/action</from>
						<to>instanceSyncDiffs[0]/action</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="6cf15faaaaa642b2a9ed7f967bf8b387"
							serviceId="nabu.utils.Object.toString"
							resultName="result7f23da2910234dde84698ad4eb2d5b3b"
							temporaryMapping="true"
							x="160"
							y="467"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="b88ba5f8a7a141c482d5f513e30de154"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>appliedDiff/oldValue</from>
							<to>object</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="f905a5d6549b43bca8406cf7cfe41202"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result7f23da2910234dde84698ad4eb2d5b3b/string</from>
						<to>instanceSyncDiffs[0]/oldValue</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="4e23275bd9494b53922d832ff21da686"
							serviceId="nabu.utils.Object.toString"
							resultName="resultad43eeb1d4d34ea9ab08937b9dbbe0a0"
							temporaryMapping="true"
							x="170"
							y="589"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="e86fdbb2868b403588c469207630675c"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>appliedDiff/newValue</from>
							<to>object</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="b547fb8b0f454730b4804e562e7eb450"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultad43eeb1d4d34ea9ab08937b9dbbe0a0/string</from>
						<to>instanceSyncDiffs[0]/newValue</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="fabca94a582f4b84aedbfe6ad9d908df"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>instanceSync/id</from>
						<to>instanceSyncDiffs[0]/cdmInstanceSyncId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a1e424598de64c7098cbd6fb1a0b5fa9"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/id</from>
						<to>instanceSyncDiffs[0]/cdmSystemSubscriptionId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="54796e7d60244b1e9210ee699e8e48dc"
							serviceId="nabu.utils.Server.uuid"
							resultName="result7498bbd68eb34ae5b8a101026dc082d1"
							temporaryMapping="true"
							x="250"
							y="191"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="3efdf2dfa24a4f119f5bdf9a310142a7"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result7498bbd68eb34ae5b8a101026dc082d1/uuid</from>
						<to>instanceSyncDiffs[0]/id</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="8019ec7a485742f1ad8f10301ae5f48d"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>rejected</from>
						<to>instanceSyncDiffs[0]/rejected</to>
					</steps>
				</steps>
				<query>appliedDiffs</query>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Update the &quot;pushed&quot;, this is incorrect if it has been rejected!"
					disabled="true"
					id="47ce2c02fd6940e49af9c25a62a932f9"
					lineNumber="106">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1df901e2220943f494f58a70007211ed"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>date</from>
					<to>instanceSubscription/pushed</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="46d9ff9f96154e488540d51d5bb0daea"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>currentContent/id</from>
					<to>instanceSubscription/lastCdmInstanceContentId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
					disabled="false"
					id="2a80362c53a24e9a8da73b4701a30989"
					lineNumber="107">
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						disabled="false"
						id="db8bc11e546241a88a1b9b43adfbbf35"
						label="rejected"
						lineNumber="108">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="2e53fda4265a4fd985df381cc8f78a2b"
							lineNumber="109">
						<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
								disabled="false"
								id="38d63c670bcf4630a061b546e3d4c7df"
								path="rejectionReason" xsi:nil="true"/>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="2b1a286be9544eeaba786dfd60e2fa59"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/cdmInstanceId</from>
							<to>log/cdmInstanceId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="6e48e66b846845faba61e54ba1eb71f0"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>rejectionReason</from>
							<to>log/content</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="bdbd4dbf2cf44e51be84aa511d7cdd17"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>push-rejected</from>
							<to>log/logType</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="858085d092354897beab9f1630422828"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>date</from>
							<to>log/created</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="c68678b1889149878531e946f7f01b54"
								serviceId="nabu.utils.Server.uuid"
								resultName="result07535968f2e14ee5a09e25c91cac4d59"
								temporaryMapping="true"
								x="468"
								y="248"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="350f5edf63194ffaa786d839978e315e"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result07535968f2e14ee5a09e25c91cac4d59/uuid</from>
							<to>log/id</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f0ceefd735ac4354aaf1f19f9fe7ab82"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>instanceSync/id</from>
							<to>log/cdmInstanceSyncId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="afe5ed2d940c41c7bc76e5d8266c6c6e"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>instanceSubscription/id</from>
							<to>log/cdmInstanceSubscription</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="7e2ffe3021274775bdaba27b4a2b14b9"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>currentContent/typeId</from>
							<to>event/artifactId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="65a6cfc1fe9e4c6884556494da9e4a8c"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>cdm</from>
							<to>event/eventCategory</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="2060af265f0c433d9a7119004f653a21"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>push-rejected</from>
							<to>event/eventName</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f617aa408c60460e902a773c96b859b7"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/cdmInstanceId</from>
							<to>event/localId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="139d7e24d9b441d6a5a55328eb2b31c0"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>ERROR</from>
							<to>event/severity</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="09fd524f495643ba959314862290803f"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>rejectionReason</from>
							<to>event/stacktrace</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="6504e96e0907438f937b02ead0a3afd0"
								serviceId="nabu.data.json.Services.marshal"
								resultName="result85f146aa696f482788888e033f34a9f1"
								temporaryMapping="true"
								x="73"
								y="102"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="416c15586aac40c0a6ec01db99645037"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>patchedPartialInstance</from>
								<to>data</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="e0c852ef47af4049939dd30c30938493"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>true</from>
								<to>prettyPrint</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="ebb58091dc774d888506c819c2c1e17c"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>UTF-8</from>
								<to>charset</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="c817406881264e32b45e1b2117879945"
								serviceId="nabu.utils.Stream.toString"
								resultName="result0212553217084200898a67b256b93504"
								temporaryMapping="true"
								x="474"
								y="116"
								invocationOrder="1"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="c594089efbab47e0b336aff90166295e"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result85f146aa696f482788888e033f34a9f1/marshalled</from>
								<to>stream</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="8778a32baa234ebbb67428e26c1238af"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>UTF-8</from>
								<to>charset</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="971a69f8c30949018337dae684cdbc5e"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result0212553217084200898a67b256b93504/string</from>
							<to>event/data</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="86bb085ad57e423ab1d5c06e6cfc4173"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/system</from>
							<to>event/origin</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="d701a57c7eb1406e818fb30a24bb39a2"
							lineNumber="110">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="e6747e44dfb5457898363a6d1646fe80"
								serviceId="nabu.utils.List.add"
								resultName="result747601e4b6b449709764bff79738a1c9"
								temporaryMapping="true"
								x="165"
								y="160"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="b092038e44ad4863b7396dbf398116d8"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>logs</from>
								<to>list</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="f369be683f464f538211abfe19173419"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>log</from>
								<to>object</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="b35dd8443abb456ba3a58dc078850b53"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result747601e4b6b449709764bff79738a1c9/list</from>
							<to>logs</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
								disabled="false"
								id="b34749ac8c6244c3b91911ba9cc0ac05"
								path="log" xsi:nil="true"/>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="c93a8966faef47979ee2e0a24a0b8f4d"
								serviceId="nabu.utils.Event.fire"
								resultName="resultef7b7f7631234139ada4cf396d1d3451"
								temporaryMapping="true"
								x="245"
								y="384"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="a044240af170458c985600dd29ad9318"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>event</from>
								<to>event</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
								disabled="false"
								id="156448e945cd47b58b9f9860abeb9391"
								path="event" xsi:nil="true"/>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Marshal the content and update &quot;pulled&quot;. We assume that the data is now synchronized and pulling it would yield the same result"
						disabled="false"
						id="fa7f762ff61a489fa7b4361eb2da8eeb"
						lineNumber="111">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="dc1c5baeaf7f4f9481cedafcbd5eb200"
							serviceId="nabu.data.json.Services.marshal"
							resultName="result41b021e3eff64fd5a8d115315540a448"
							temporaryMapping="true"
							x="33"
							y="97"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="41ed42c5076f4e85931e441f19e233db"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>patchedPartialInstance</from>
							<to>data</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="da1eefb913804c43ab3d4e0e288b8f3d"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>UTF-8</from>
							<to>charset</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="46b1bbe4186a46559b6f6a916ff336d4"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>true</from>
							<to>prettyPrint</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="a01f4e50f86c44989faa9673b122bef0"
							serviceId="nabu.utils.Stream.toString"
							resultName="resultc080d996a16b454ba2a937a8580614de"
							temporaryMapping="true"
							x="529"
							y="268"
							invocationOrder="1"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="1e9f3611471042bab9660097322b03e5"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result41b021e3eff64fd5a8d115315540a448/marshalled</from>
							<to>stream</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9079bd6889544bbf8f2ff93941977ad3"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>UTF-8</from>
							<to>charset</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="06a1a5bfa6204615a0c0659703b6ecdb"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultc080d996a16b454ba2a937a8580614de/string</from>
						<to>instanceSubscription/content</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="ce3321e16bb84dc4aabfc753467d146a"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>date</from>
						<to>instanceSubscription/pulled</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="ab618da291cd430c9d8ffe7e99862cd4"
							serviceId="nabu.frameworks.cdm.utils.relation.update"
							resultName="result417ae9edbfb34d01a81411d1706558da"
							temporaryMapping="true"
							x="65"
							y="213"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="4b1c4d264d7141089ae48a876ae1c8db"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/cdmInstanceId</from>
							<to>cdmInstanceId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f593bad9f6d84baf8dd82889a7956fbf"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>existingRelations</from>
							<to>existingRelations</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9cbb3e8059eb40f7a8778dcdab8ef1b0"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>newRelations</from>
							<to>newRelations</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="357d566336f1492db1bf1211aac9ebc3"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/cdmDefinitionId</from>
							<to>cdmDefinitionId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9dc19a06570345f18293ae5bcc793e25"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/id</from>
							<to>cdmSystemSubscriptionId</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="cb60107e04cc49c6ba69df4a2c7bb414"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result417ae9edbfb34d01a81411d1706558da/existingRelations</from>
						<to>existingRelations</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="5ae9215b3fe245129ed2ce4b64e4b0bb"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>true</from>
						<to>instanceSubscription/assumedContent</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="aaac97be300648af804124c5369b7213"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>date</from>
						<to>instanceSubscription/pushed</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="4a1f5f9e059d4bf1a55d344e6ff85bb9"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>currentContent/id</from>
						<to>instanceSubscription/lastCdmInstanceContentId</to>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="If it is rejected and we have a provider service, check if it was perhaps deleted"
					disabled="false"
					id="4132d113246d4032b1696a06e5d3cf2e"
					label="rejected &amp;&amp; subscription/pullId != null"
					lineNumber="112">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="069dd61ddfa14701bcbf5b5979595f02"
						lineNumber="113">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="c33dfb78212641d99ef61702bad14fee"
							serviceId="nabu.frameworks.cdm.specs.pull"
							resultName="result7183429fcb04496d9a75bc61d18aba32"
							temporaryMapping="true"
							x="118"
							y="50"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="4e0342d25e184793b98322fda2206f94"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>externalIds</from>
							<to>externalIds</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9353eab251084659bd080f604fa6aa4f"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/cdmInstanceId</from>
							<to>cdmInstanceId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f15ccb055366456a97186206764d86b0"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/pullId</from>
							<to>implementationId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f427bc13628a44bbabd3cc4aaf7a432a"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>existingRelations</from>
							<to>relations</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="07f7445396ea43a7b75ed83d637ccd4f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result7183429fcb04496d9a75bc61d18aba32/externalIds</from>
						<to>newExternalIds</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="c37c29359ef748c4b9a0f401eae06bc3"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>date</from>
						<to>instanceSubscription/pulled</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="23f5e38548df4584b776d15698ed750a"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result7183429fcb04496d9a75bc61d18aba32/cdmInstance</from>
						<to>newestPartialInstance</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="5aedb71e2ed24cd68957cee73ca8ee29"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result7183429fcb04496d9a75bc61d18aba32/relations</from>
						<to>newRelations</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Update the ids, this might fail if the push partially succeeded. There should not be any new information at this point"
						disabled="true"
						id="bcc8f2de21804a80a8ac1489085f6e48"
						label="newExternalIds"
						lineNumber="114">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="6ef0320513574c938aa1a50db885f23a"
							serviceId="nabu.frameworks.cdm.utils.externalId.update"
							resultName="result35cf43d44d4343a393614080fe7f194e"
							temporaryMapping="true"
							x="170"
							y="85"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="82e73e972df04c1e9b3228f1b2a58510"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/cdmInstanceId</from>
							<to>cdmInstanceId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="071f19878350409fb907a756989da5db"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>newExternalIds</from>
							<to>newExternalIds</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="01d61456fae341e288b4c33e18abb3ad"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>externalIds</from>
							<to>existingExternalIds</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0ea9a81cfefd4a1c95df64ef7058f22a"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result35cf43d44d4343a393614080fe7f194e/externalIds</from>
						<to>externalIds</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
						disabled="false"
						id="6faf0afbca574587b2c91e211902f55a"
						lineNumber="115">
					<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
							comment="If we had an instance but no longer have one, we set to decoupled and skip"
							disabled="false"
							id="ffb7d4deb8fe479bae2861c08d7366e1"
							label="newestPartialInstance == null"
							lineNumber="116">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="If we had content before, set to decoupled. If the initial create failed (e.g. mandatory field missing), we don't want to set it to decoupled just yet"
								disabled="false"
								id="ef62fef8824a4a33be9d5a4d827b8e23"
								label="instanceSubscription/content != null"
								lineNumber="117">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="c85727e81e1b4527beb9ce4a963da28a"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>date</from>
								<to>instanceSubscription/decoupled</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
									disabled="false"
									id="d1e919ed1f0d487ebba56a0450c653d5"
									path="instanceSubscription/content" xsi:nil="true"/>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Break"
								disabled="false"
								id="ad081687be8c451d84b3542e473c1a7b"
								lineNumber="118">
							<count>3</count>
							<continueExecution>true</continueExecution>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
							comment="Otherwise we set the (potentially partially updated data) and update the pulled"
							disabled="false"
							id="deb73f6d87034eba93a02a1cdbc86e3b"
							lineNumber="119">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								disabled="false"
								id="e1160032a1b34a7ab0c0e3c97c8859cb"
								lineNumber="120">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="e518c8be6543420aa9924b333af18e03"
									serviceId="nabu.data.json.Services.marshal"
									resultName="result41b021e3eff64fd5a8d115315540a448"
									temporaryMapping="true"
									x="33"
									y="97"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="a82197097a0c4181add19c15acfd07df"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>UTF-8</from>
									<to>charset</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="b57cbfd8d19d4520b76efc5b055fdcaa"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>true</from>
									<to>prettyPrint</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="30976f74c4c74884a93a736041fba781"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>newestPartialInstance</from>
									<to>data</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="50f0cf4f69424a058e1ab7c429f9df7e"
									serviceId="nabu.utils.Stream.toString"
									resultName="resultc080d996a16b454ba2a937a8580614de"
									temporaryMapping="true"
									x="529"
									y="268"
									invocationOrder="1"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="44c7c862eb72460ca9d255d6c91e4bed"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>result41b021e3eff64fd5a8d115315540a448/marshalled</from>
									<to>stream</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="d3f402ea223048dcbc7a9692ce210511"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>UTF-8</from>
									<to>charset</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="6e7f7e6a4cdf493ea8f1d3c3291e988d"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>resultc080d996a16b454ba2a937a8580614de/string</from>
								<to>instanceSubscription/content</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="576535b9b92345a6acd0b2cb8b032725"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>date</from>
								<to>instanceSubscription/pulled</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="2fefbe9b0e9e48f5b85bb320872982a0"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>false</from>
								<to>instanceSubscription/assumedContent</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
									disabled="false"
									id="d4e8912cbd444f2f8ecb18769cea7cce"
									path="instanceSubscription/cdmSystemBatchPullId" xsi:nil="true"/>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								disabled="false"
								id="b3797462d2b243d1bbfcc71f906bd77c"
								lineNumber="121">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="fff2b0f16d2d4ec7af91d52f07d60e6f"
									serviceId="nabu.frameworks.cdm.utils.relation.update"
									resultName="result267941eb0565452e8d2e8bb5ebb9e2a9"
									temporaryMapping="true"
									x="91"
									y="41"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="a4c92ca50d1a477b8e9ff13956ccb71e"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>input/cdmInstanceId</from>
									<to>cdmInstanceId</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="f3ea5a12abfb46619f6456e9de9d7441"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>newRelations</from>
									<to>newRelations</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="8d05e48beb3d45c9add2f5d72aaad0cd"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>existingRelations</from>
									<to>existingRelations</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="7fed51059abb454f9bc10b2f72b01a51"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>subscription/cdmDefinitionId</from>
									<to>cdmDefinitionId</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="133e61b398254f9aa02faf2f257fafdf"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>subscription/id</from>
									<to>cdmSystemSubscriptionId</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="0463b8bfea8649bda54f68b01a523a29"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result267941eb0565452e8d2e8bb5ebb9e2a9/existingRelations</from>
								<to>existingRelations</to>
							</steps>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
						comment="The pull may fail!"
						disabled="false"
						id="697528cc03184dfebd90a4b9dab39651"
						lineNumber="122"
						variable="exception">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="0f1e3b08adeb4b7096c313a1ccc44c89"
							lineNumber="123">
						<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
								disabled="false"
								id="8cff4cf328bc42db9acd2b59a89d6f34"
								path="rejectionReason" xsi:nil="true"/>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="8485cffbae964c33976a469e873c4933"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/cdmInstanceId</from>
							<to>log/cdmInstanceId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="14e3408c36a047b2992e916e356737d3"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>rejection-pull-failed</from>
							<to>log/logType</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="b3cecca9100b4baaa06c96162099cf94"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>date</from>
							<to>log/created</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="720174b6704048e39a7cfa56224d6059"
								serviceId="nabu.utils.Server.uuid"
								resultName="result07535968f2e14ee5a09e25c91cac4d59"
								temporaryMapping="true"
								x="468"
								y="248"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="db2bbea51af348d18299460b854d406d"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result07535968f2e14ee5a09e25c91cac4d59/uuid</from>
							<to>log/id</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="f254f15257094644a3b8d8a54c135bed"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>instanceSync/id</from>
							<to>log/cdmInstanceSyncId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="fb95061561d44b6aa157ad5e691bcdaa"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>instanceSubscription/id</from>
							<to>log/cdmInstanceSubscription</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="c161d5ce62564fdc95d7f25a0c0b9201"
								serviceId="nabu.utils.Runtime.summarizeException"
								resultName="resultf57d2860be694b509c0fd44d1455b051"
								temporaryMapping="true"
								x="165"
								y="371"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="e97de77a4aeb405bb25110e2d102ef36"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>exception</from>
								<to>exception</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="4ebe0276b89c430b9d4dc9d32eea32d2"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>resultf57d2860be694b509c0fd44d1455b051/summary/exceptionStack</from>
							<to>log/content</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="daaca94b0b004ed78814d1d2764ce4a3"
							lineNumber="124">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="bc28af539ab342dd915685fce979b995"
								serviceId="nabu.utils.List.add"
								resultName="result747601e4b6b449709764bff79738a1c9"
								temporaryMapping="true"
								x="165"
								y="160"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="04c3b7e3d1954e67873ef67488598910"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>logs</from>
								<to>list</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="6bdb21e567894fdea61c0d1dfd16c3df"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>log</from>
								<to>object</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="2eafbb4f121f4a2aa515bf4e1ca021d5"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result747601e4b6b449709764bff79738a1c9/list</from>
							<to>logs</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
								disabled="false"
								id="8c67d9b8b2374fa5a3d9f5f2c15d6ce7"
								path="log" xsi:nil="true"/>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
					disabled="false"
					features="CDM_FAIL_ON_REJECT"
					id="113e7060dfdf49d0ad84f3596bf1a758"
					label="rejected"
					lineNumber="125"
					message="Rejected"
					whitelist="false" xsi:nil="true"/>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="If we didn't have new metadata yet, check if we created some this iteration"
				disabled="false"
				id="61d599c7bad648e1b095e1177243282c"
				label="!output/hasNewMetadata &amp;&amp; existingRelations != null"
				lineNumber="126">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Get amount of relations that were updated after the start of this service"
					disabled="false"
					id="3e3d6182d10a466ea99f5b2f15934ea1"
					lineNumber="127">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="c1bf92ab499a4ab785781b0794dd27d0"
						serviceId="nabu.utils.List.size"
						resultName="resulta5ccdde3e122448a94597bab6031eb70"
						temporaryMapping="true"
						x="292"
						y="188"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="4e5cd2d520ab4f13a97d36b42575662f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>existingRelations[modified != null &amp;&amp; modified &gt; date]</from>
						<to>list</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="3b5223422ffb42eb85ec086ad7c2c8ca"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resulta5ccdde3e122448a94597bab6031eb70/size</from>
					<to>amountOfChangedRelations</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Set to true "
					disabled="false"
					id="29b93f2518c74a57ac0f166ce22349e9"
					label="amountOfChangedRelations &gt; 0"
					lineNumber="128">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1c31ccabe0a4442782876284e345b4ce"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>output/hasNewMetadata</to>
				</steps>
			</steps>
		</steps>
		<query>subscriptions</query>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="973ff9e5d7214e1898fc333ee23eab74"
			label="instanceSubscriptions"
			lineNumber="129">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="aa2f63054aa74874baa41d5989e99a55"
				serviceId="nabu.services.jdbc.Services.update"
				resultName="resultfefc0156ccc547ac9de3704288e24200"
				temporaryMapping="true"
				x="94"
				y="64"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="3c184849a70947a5a0073a124a2ae7f4"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>instanceSubscriptions</from>
				<to>instances</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Map the stopped for the sync"
			disabled="false"
			id="55b22a44404e46f3a684e8a0bf07e1a4"
			lineNumber="130">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="7ceb0ed61b434367a70b84cac0b3d63b"
				serviceId="nabu.utils.Date.now"
				resultName="result19c939494411496aa2f85e7d09301754"
				temporaryMapping="true"
				x="295"
				y="276"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="53b4f645b59a4d5b9dcd79e7dfb2955f"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result19c939494411496aa2f85e7d09301754/date</from>
			<to>instanceSync/stopped</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="01fca7eadc9d4417adff5d814b3c04dd"
			lineNumber="131">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="20636b3db2f24c39bfa53a6371c21d84"
				serviceId="nabu.services.jdbc.Services.insert"
				resultName="result47b2d4ae6d8247699eaecbfe15a861a8"
				temporaryMapping="true"
				x="306"
				y="215"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="e5597656775c40afb7499c03c56156c1"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>instanceSync</from>
				<to>instances[0]</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="f483ce3eb03e4b0fbaa66c0e5ab6b8f3"
			label="instanceSyncDiffs"
			lineNumber="132">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="df3a6c1c27fd4fb786cb72d3faf3df3b"
				serviceId="nabu.services.jdbc.Services.insert"
				resultName="result1580698294f04cae92f5627ede6bc589"
				temporaryMapping="true"
				x="273"
				y="254"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="5d87c707981545b793f143d0b575dcc4"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>instanceSyncDiffs</from>
				<to>instances</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="a4335615970a434abc971065c7d8c73b"
			label="logs"
			lineNumber="133">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="c14050ce7d6f4fe285e4b280d6af1464"
				serviceId="nabu.services.jdbc.Services.insert"
				resultName="result545f30c888a14b8f83ce3c3cd30945b7"
				temporaryMapping="true"
				x="99"
				y="195"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="02b1c083978447b28bda8fd3369bbd18"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>logs</from>
				<to>instances</to>
			</steps>
		</steps>
	</steps>
</sequence>