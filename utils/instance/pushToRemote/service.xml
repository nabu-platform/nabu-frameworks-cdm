<sequence id="9ed0d1493d26483a8566c430da26a7ca">
	<map id="90666d38fdfa457582085830687ee690"
		comment="Get the latest content for the cdm instance">
		<invoke id="62bc4a2f5e8b4276ad909f3bfab1a518"
			resultName="result73d08e58afc14b1bb13c4bebd910fc19"
			serviceId="nabu.frameworks.cdm.crud.cdmInstanceContent.services.list"
			x="30"
			y="30">
			<link id="99d3f26244fa40679d7841d284081fc4">
				<from>input/cdmInstanceId</from>
				<to>filter/cdmInstanceId[0]</to>
			</link>
			<link id="77d8e8f40fb84bd8a2385122f311e601"
				fixedValue="true">
				<from>true</from>
				<to>filter/active</to>
			</link>
		</invoke>
		<link id="f05c810ff96d48e6b7f6951cbca9e619">
			<from>result73d08e58afc14b1bb13c4bebd910fc19/results[0]</from>
			<to>currentContent</to>
		</link>
		<invoke id="7881e167effa466dacd24d207de064fd"
			resultName="resultc2873d5da9474f8c99944f8a9583ae84"
			serviceId="nabu.frameworks.cdm.crud.cdmInstanceExternalId.services.list"
			x="117"
			y="166">
			<link id="77c58de785764ea881a9d631fdd6c5ec">
				<from>input/cdmInstanceId</from>
				<to>filter/cdmInstanceId[0]</to>
			</link>
		</invoke>
		<link id="b03532c38afe4085a2327f09004fa842">
			<from>resultc2873d5da9474f8c99944f8a9583ae84/results</from>
			<to>externalIds</to>
		</link>
		<link id="3337126201714c00a17b1d072e8c5450">
			<from>result73d08e58afc14b1bb13c4bebd910fc19/results[0]/typeId</from>
			<to>typeId</to>
		</link>
		<link id="00f9df07706843aa84b3fa640573931a">
			<from>resultc2873d5da9474f8c99944f8a9583ae84/results</from>
			<to>externalIds</to>
		</link>
		<invoke id="d244e28f88884e649b5154387408909e"
			invocationOrder="1"
			resultName="result8ae6b131e1d64a22ac6d7c1d3c0d7b37"
			serviceId="nabu.utils.List.maximum"
			x="552"
			y="347">
			<link id="e8a397d11d754d4c965c946e9f4cc8ea">
				<from>resultc2873d5da9474f8c99944f8a9583ae84/results/modified</from>
				<to>list</to>
			</link>
		</invoke>
		<link id="82038e1b6898475badebd75878105c90">
			<from>result8ae6b131e1d64a22ac6d7c1d3c0d7b37/maximum</from>
			<to>mostRecentExternalIdModification</to>
		</link>
	</map>
	<break id="489fe55e402840fd812ca00fc877e0ac"
		comment="Nothing to push"
		description="=&quot;There was no content to push for: &quot; + input/cdmInstanceId"
		label="!currentContent">
		<count>1</count>
	</break>
	<map id="ef2d2a2ea65f445780734515211d150c"
		comment="Unmarshal current content">
		<invoke id="13a29775aa5c49b282184bf13e3f1672"
			invocationOrder="1"
			resultName="result389a096181764bee92c6fe9502d8ff8c"
			serviceId="nabu.data.json.Services.unmarshal"
			x="311"
			y="222">
			<link id="9b073c434e6d4727acd1bba9dc749505">
				<from>result64523c7a322d4b29884fb98289034c18/stream</from>
				<to>input</to>
			</link>
			<link id="088e10497e1e48e2af3c56b9e6e0128b">
				<from>currentContent/typeId</from>
				<to>type</to>
			</link>
			<link id="9d266dff6e264a5a95b469b9e75508a4"
				fixedValue="true">
				<from>true</from>
				<to>ignoreUndefinedFields</to>
			</link>
		</invoke>
		<invoke id="7ce47ae820c443c1badae553de22e624"
			resultName="result64523c7a322d4b29884fb98289034c18"
			serviceId="nabu.utils.String.toStream"
			x="34"
			y="70">
			<link id="d8442c2e32e643ab96343efa7b2cf2d6">
				<from>currentContent/content</from>
				<to>string</to>
			</link>
			<link id="ce9bdeb3add948ceb212f4c022ce4997"
				fixedValue="true">
				<from>UTF-8</from>
				<to>charset</to>
			</link>
		</invoke>
		<link id="38524ec42ea048168b4f8b04f5ad7919">
			<from>result389a096181764bee92c6fe9502d8ff8c/unmarshalled</from>
			<to>cdmInstance</to>
		</link>
	</map>
	<map id="291ab9f24ea34568977d969207472c2f">
		<invoke id="c77eef3c3da049cba2dcbf234fa24ee7"
			resultName="resultca49f03b896e42a68dacb4f9b8b8d892"
			serviceId="nabu.frameworks.cdm.crud.cdmSystemSubscription.services.list"
			x="187"
			y="49">
			<link id="65d9d45ddb084deabb8330f7e439a931">
				<from>input/systems</from>
				<to>filter/system</to>
			</link>
			<link id="a86bc11f5ffe45bca20e8cb0ac133a93">
				<from>currentContent/typeId</from>
				<to>filter/coreTypeId[0]</to>
			</link>
			<link id="f9218b1059fe4c1ab2b1b868191fc3b5"
				fixedValue="true">
				<from>true</from>
				<to>filter/hasPush</to>
			</link>
			<link id="9ab66154e12141c38f3adf4a5cfc40e3"
				fixedValue="true">
				<from>priority desc</from>
				<to>orderBy[0]</to>
			</link>
		</invoke>
		<link id="d279dbe5d9354075a54d089270463b39">
			<from>resultca49f03b896e42a68dacb4f9b8b8d892/results</from>
			<to>subscriptions</to>
		</link>
		<invoke id="5e751d03b7d04b3bb2ee849e2ef7d68a"
			resultName="result5635c2495880477283d759f6cb0b4095"
			serviceId="nabu.utils.Date.now"
			x="159"
			y="238">
		</invoke>
		<link id="7d91685a79914b88ba7cac63ba5448f6">
			<from>result5635c2495880477283d759f6cb0b4095/date</from>
			<to>date</to>
		</link>
		<link id="20cc73e4237c401eb083d0c30076e0fb">
			<from>result5635c2495880477283d759f6cb0b4095/date</from>
			<to>instanceSync/started</to>
		</link>
		<invoke id="7b637276dc38495d8fd64daf4e7857d2"
			resultName="result687fb21079f443f2bc1b7b7396fc2e9a"
			serviceId="nabu.utils.Server.uuid"
			x="253"
			y="399">
		</invoke>
		<link id="aaa5955a462240f288227d886e81ac1d">
			<from>result687fb21079f443f2bc1b7b7396fc2e9a/uuid</from>
			<to>instanceSync/id</to>
		</link>
		<link id="b2ea7272ea3445608f9e92847dfb9787"
			fixedValue="true">
			<from>push</from>
			<to>instanceSync/direction</to>
		</link>
		<invoke id="0bd1df4be7154ce28fcdaebec45e22b3"
			resultName="result6e10cc864d1141119b3f09c516fc4863"
			serviceId="nabu.utils.Runtime.getCurrentToken"
			x="213"
			y="535">
		</invoke>
		<link id="a41a6db5a69340c988aacfbabe4f9586">
			<from>result6e10cc864d1141119b3f09c516fc4863/token/authenticationId</from>
			<to>instanceSync/actorId</to>
		</link>
		<link id="6438387a52854383a0d0a4c251deefa7">
			<from>input/cdmInstanceId</from>
			<to>instanceSync/cdmInstanceId</to>
		</link>
		<invoke id="97717ee73e504cc08bb27222ba908f1e"
			resultName="result6a0a6b578c354ee58666bd79219c724b"
			serviceId="nabu.utils.Runtime.getCorrelationId"
			x="567"
			y="519">
		</invoke>
		<link id="c008dbb6e0244f0d97a55fafff9a5af3">
			<from>result6a0a6b578c354ee58666bd79219c724b/correlationId</from>
			<to>instanceSync/correlationId</to>
		</link>
		<invoke id="d983cee80cf84fdf9f8ec280357c0a54"
			resultName="resultbb8f4f66659a4601b0fc951afb8aebee"
			serviceId="nabu.utils.Server.getServerName"
			x="924"
			y="560">
		</invoke>
		<link id="3018a1f9dae3468eb8cd9b1d44d0c49b">
			<from>resultbb8f4f66659a4601b0fc951afb8aebee/server</from>
			<to>instanceSync/server</to>
		</link>
		<link id="ea9b05cb089f45e5b525f641ebc5f56a">
			<from>input/source</from>
			<to>instanceSync/source</to>
		</link>
		<link id="80463c14480b4ee987d5aa141761fefb">
			<from>resultca49f03b896e42a68dacb4f9b8b8d892/results</from>
			<to>output/subscriptions</to>
		</link>
	</map>
	<map id="4c999f596d89436487761542da4fa4d4"
		comment="Get interesting relation types"
		label="subscriptions">
		<invoke id="cf25b001e9134edbb2885a18a5082cff"
			resultName="result28ccb09243694330b795acd19387506f"
			serviceId="nabu.frameworks.cdm.crud.cdmSystemRelationType.services.list"
			x="94"
			y="64">
			<link id="3b9e669a06cf49a2b551016cd15cdc43">
				<from>subscriptions/id</from>
				<to>filter/cdmSystemSubscriptionId</to>
			</link>
		</invoke>
		<link id="4f54f4864c334188966f78bc6755b8a6">
			<from>result28ccb09243694330b795acd19387506f/results</from>
			<to>allInterestedRelationTypes</to>
		</link>
	</map>
	<map id="acff44da480a47c2be1b6bb4d3f569bc"
		comment="Get the last data for the given subscriptions"
		label="subscriptions">
		<invoke id="4ec2fd1688c74ae7a67dd693ca81d4cf"
			resultName="result62e74915f6b947da898e6060967aec28"
			serviceId="nabu.frameworks.cdm.crud.cdmInstanceSubscription.services.list"
			x="167"
			y="104">
			<link id="890b6f404faf48e2869d9b2f990a2d04">
				<from>input/cdmInstanceId</from>
				<to>filter/cdmInstanceId[0]</to>
			</link>
			<link id="26c9bb39bd794f4e8e50c4bd0e35becb">
				<from>subscriptions/id</from>
				<to>filter/cdmSubscriptionId</to>
			</link>
		</invoke>
		<link id="edeb4ec19b72402b9a28496a31ca243d">
			<from>result62e74915f6b947da898e6060967aec28/results</from>
			<to>instanceSubscriptions</to>
		</link>
		<invoke id="25f1c8757cf14ea8b19f084214bf59dd"
			invocationOrder="1"
			resultName="result3b3716981b0448f09a4b117d46688e6c"
			serviceId="nabu.utils.List.minimum"
			x="657"
			y="327">
			<link id="58b94e0a06ba4046877b79a1a40741c3">
				<from>result62e74915f6b947da898e6060967aec28/results[pushed != null]/pushed</from>
				<to>list</to>
			</link>
		</invoke>
		<link id="ea18b8b912b847db9ba62a2fd8a859d8">
			<from>result3b3716981b0448f09a4b117d46688e6c/minimum</from>
			<to>oldestPush</to>
		</link>
	</map>
	<map id="f4ba31c10d3347569435c217267280de"
		comment="Always get all active relations">
		<invoke id="9120cee72316448a9f6542e3201bd52a"
			resultName="result9fcad811ad5743d9a0848f060ca00eda"
			serviceId="nabu.frameworks.cdm.crud.cdmInstanceRelation.services.list"
			x="57"
			y="43">
			<link id="8fa1d9616a4748a095486fd06c06d258">
				<from>input/cdmInstanceId</from>
				<to>filter/sourceId[0]</to>
			</link>
			<link id="d1912a49999549e09dd8f1777bc4a520"
				fixedValue="true">
				<from>true</from>
				<to>filter/active</to>
			</link>
		</invoke>
		<link id="500fff2df6524a90af8b975c730cbcb1">
			<from>result9fcad811ad5743d9a0848f060ca00eda/results</from>
			<to>allExistingRelations</to>
		</link>
		<invoke id="4cc37b7d542b4835beff1331994248f2"
			invocationOrder="1"
			resultName="result0170555d261942f3969a23237ce52d44"
			serviceId="nabu.utils.List.unique"
			x="558"
			y="372">
			<link id="b40a55e4e639483c8fb02c137560f885">
				<from>result9fcad811ad5743d9a0848f060ca00eda/results[targetId != null]/targetId</from>
				<to>list</to>
			</link>
		</invoke>
		<link id="2f0d230d432843d0ad555d0cffce718d">
			<from>result0170555d261942f3969a23237ce52d44/list</from>
			<to>allExistingRelationTargetIds</to>
		</link>
	</map>
	<map id="b15e56c8c96a4f10934a8481b447c8dc"
		comment="If we have a previous (oldest) push date, get the inactivated ones as well with a modified after that time"
		label="oldestPush != null">
		<invoke id="0dd76794d96e41cd81e2e6e4f2bd7273"
			resultName="result9fcad811ad5743d9a0848f060ca00eda"
			serviceId="nabu.frameworks.cdm.crud.cdmInstanceRelation.services.list"
			x="57"
			y="43">
			<link id="d0bbeeb153694475a7342798c0569e83">
				<from>input/cdmInstanceId</from>
				<to>filter/sourceId[0]</to>
			</link>
			<link id="495d6e91714547e8aaf65f6125fe9d10">
				<from>oldestPush</from>
				<to>filter/modifiedSince</to>
			</link>
			<link id="0fedd472e834480089dee8b8f2dc8bd9"
				fixedValue="true">
				<from>false</from>
				<to>filter/active</to>
			</link>
		</invoke>
		<invoke id="2a50a6cd619a45ee86144599da112270"
			invocationOrder="2"
			resultName="result0170555d261942f3969a23237ce52d44"
			serviceId="nabu.utils.List.unique"
			x="692"
			y="455">
			<link id="7a5b5759b9ad491faf465b72a61ad820">
				<from>resultbd8ee1ddd5494fd1a6f6de6656f13a60/list</from>
				<to>list</to>
			</link>
		</invoke>
		<link id="922c9b18b669437c8fe4481bc48ac806">
			<from>result0170555d261942f3969a23237ce52d44/list</from>
			<to>allExistingRelationTargetIds</to>
		</link>
		<link id="f5aadef9bb9e4e27901be7ac12873a19">
			<from>result9fcad811ad5743d9a0848f060ca00eda/results[active != true]</from>
			<to>allInactivatedRelations</to>
		</link>
		<invoke id="faf1c59c139848ec992763ed08a937b2"
			invocationOrder="1"
			resultName="resultbd8ee1ddd5494fd1a6f6de6656f13a60"
			serviceId="nabu.utils.List.addAll"
			x="423"
			y="590">
			<link id="d855202f8ad248c39ae28a0c96cc0127">
				<from>result9fcad811ad5743d9a0848f060ca00eda/results[targetId != null]/targetId</from>
				<to>objects</to>
			</link>
			<link id="eddee44066d145ad8cd6375359313602">
				<from>allExistingRelationTargetIds</from>
				<to>list</to>
			</link>
		</invoke>
	</map>
	<map id="b4e109485e724950a4ae68f7747c0bb1"
		label="allExistingRelationTargetIds">
		<invoke id="acd921c75e7241758673f7118700718d"
			resultName="result5451f0c02f834df991e49f2ec8bcd01f"
			serviceId="nabu.frameworks.cdm.crud.cdmInstanceExternalId.services.list"
			x="140"
			y="51">
			<link id="15dd23cfa1cd4e7b8e5e455e2b9cc48a">
				<from>allExistingRelationTargetIds</from>
				<to>filter/cdmInstanceId</to>
			</link>
		</invoke>
		<link id="9a57f3f0e97845429a580a233517258b">
			<from>result5451f0c02f834df991e49f2ec8bcd01f/results</from>
			<to>allExistingRelationTargetExternalIds</to>
		</link>
	</map>
	<for id="9cd35a45cbdc4142ae9bcd48a15e2383"
		variable="subscription">
		<sequence id="451e79842264480ca429eb4d1634cb5b"
			comment="If we have a filter, check that we are interested"
			label="subscription/filter != null">
			<map id="cb6e9a08b5e5477299fbe50495d8e1fc">
				<invoke id="24a5d12f96634fcab70aa3cc0cf4d3eb"
					resultName="result8af07d66e6454123861a8e82b3a52997"
					serviceId="nabu.services.glue.Services.evaluate"
					x="299"
					y="182">
					<link id="baf3e7305540488793bc9eff0b30b871">
						<from>subscription/filter</from>
						<to>rule</to>
					</link>
					<link id="6c1000d625524c3387b28b0b623865f2">
						<from>cdmInstance</from>
						<to>context[0]</to>
					</link>
				</invoke>
				<link id="296d708f3e104cc4ba53ee29ab43883b">
					<from>result8af07d66e6454123861a8e82b3a52997/response</from>
					<to>interested</to>
				</link>
			</map>
			<break id="9a8718c21dce42f2b4bbb7497280c089"
				label="!interested">
				<count>2</count>
				<continueExecution>true</continueExecution>
			</break>
		</sequence>
		<map id="6b69e25f25b348cd81d7661da8f30231"
			comment="Get the current instance subscription and relations">
			<link id="269cbf1b43394045baf081894df4f742">
				<from>instanceSubscriptions[cdmSubscriptionId == /subscription/id]</from>
				<to>instanceSubscription</to>
			</link>
			<drop id="cd049a87c41444bf93b30d5abfb11367"
				path="partialInstance"/>
			<link id="478269a449c1400cadfe55d00b2cc922"
				fixedValue="true">
				<from>false</from>
				<to>push</to>
			</link>
			<link id="99769bddef89485d919b9fcc34c04bbd">
				<from>allExistingRelations[cdmSystemSubscriptionId == /subscription/id]</from>
				<to>existingRelations</to>
			</link>
			<link id="62bcf17dde4745388d37400fb7b1bcd5">
				<from>input/forcePull</from>
				<to>pullNewData</to>
			</link>
			<link id="4f36f7db38f54dbda3176006e5869573">
				<from>allInterestedRelationTypes[cdmSystemSubscriptionId == /subscription/id]</from>
				<to>interestedRelationTypes</to>
			</link>
			<drop id="52169474f12f41a4a46f92791a25e278"
				path="changedRelations"/>
			<drop id="53fbe20a2a4f49d5b975891ca49b9ed7"
				path="interestingRelations"/>
			<drop id="2317e5a738df4e7e8267f41a260c8376"
				path="cdmDiff"/>
			<drop id="371b020d2cbd4c409fce6b3fe3aedf1e"
				path="interestingRelationsWithIds"/>
			<link id="0d75d09bfa1e4bcb9ea14e5410e5198c"
				fixedValue="true">
				<from>true</from>
				<to>isFirstSync</to>
			</link>
		</map>
		<break id="a1affa07e8624896ad26b46418528a25"
			comment="If it's decoupled, we ignore it"
			label="instanceSubscription/decoupled != null &amp;&amp; instanceSubscription/decoupled &lt;= date">
			<count>1</count>
			<continueExecution>true</continueExecution>
		</break>
		<sequence id="99ebd193fddb43f58a710305c863bc8d"
			comment="If we have a previous content, diff it to get the actual change"
			label="instanceSubscription/lastCdmInstanceContentId != null">
			<map id="e70e7f07a3aa4068918c2927112c0a2e"
				label="instanceSubscription/lastCdmInstanceContentId != previousContent/id">
				<invoke id="a3ed3ed41e194407a4cd64f4ebe86678"
					resultName="resultdf5cc0d03d394024a8d633ae95e084df"
					serviceId="nabu.frameworks.cdm.crud.cdmInstanceContent.services.get"
					x="37"
					y="61">
					<link id="40a29aaef66349ea97ab8de046517d34">
						<from>instanceSubscription/lastCdmInstanceContentId</from>
						<to>id</to>
					</link>
				</invoke>
				<link id="cfc1b39f966240318c58575af8923b16">
					<from>resultdf5cc0d03d394024a8d633ae95e084df/result</from>
					<to>previousContent</to>
				</link>
				<drop id="556ad604630246f1bfbf8d8595ffda30"
					path="previousCdmInstance"/>
			</map>
			<map id="b24b7b0511ec4d9eb3606b482b49d0f9"
				comment="Unmarshal previous content"
				label="previousCdmInstance == null">
				<invoke id="b3e3996a31cf44cda60637a20b09ba5b"
					invocationOrder="1"
					resultName="result389a096181764bee92c6fe9502d8ff8c"
					serviceId="nabu.data.json.Services.unmarshal"
					x="311"
					y="222">
					<link id="aa02e434d63d4667a4fb705d9bd69a2c">
						<from>result64523c7a322d4b29884fb98289034c18/stream</from>
						<to>input</to>
					</link>
					<link id="7a433842247b497b89f4697d97bf89b4">
						<from>previousContent/typeId</from>
						<to>type</to>
					</link>
					<link id="8bca85e68c794d89b616968cb31d36eb"
						fixedValue="true">
						<from>true</from>
						<to>ignoreUndefinedFields</to>
					</link>
				</invoke>
				<invoke id="5253859bc0724d3db5f59925fa18ec50"
					resultName="result64523c7a322d4b29884fb98289034c18"
					serviceId="nabu.utils.String.toStream"
					x="34"
					y="70">
					<link id="c5151e7f9df54b2d9a0f08d5e7eb0bf1"
						fixedValue="true">
						<from>UTF-8</from>
						<to>charset</to>
					</link>
					<link id="e9bd1dcd5e104e5e881e10708cc2efcd">
						<from>previousContent/content</from>
						<to>string</to>
					</link>
				</invoke>
				<link id="910298c1f9004ec592c19353ff4b50ed">
					<from>result389a096181764bee92c6fe9502d8ff8c/unmarshalled</from>
					<to>previousCdmInstance</to>
				</link>
			</map>
			<map id="72e2b8f360b4499cb894f29d47ce51f9">
				<invoke id="264ceab5834849179d50d5e363c497ff"
					resultName="resultf24d401a3c634222bf52c8ac718d43aa"
					serviceId="nabu.frameworks.cdm.utils.diff"
					x="95"
					y="152">
					<link id="df311ac275944f17a8c0a40c7a21488d">
						<from>previousCdmInstance</from>
						<to>original</to>
					</link>
					<link id="3163388fa9424db0ac1f4def4eab3236">
						<from>cdmInstance</from>
						<to>new</to>
					</link>
					<link id="0d0b7ac01a774e66a80917e8b70eaf43"
						fixedValue="true">
						<from>false</from>
						<to>changedOnly</to>
					</link>
				</invoke>
				<link id="639e3529d5434deeb4f5ebb1085ae2fa">
					<from>resultf24d401a3c634222bf52c8ac718d43aa/diffs</from>
					<to>cdmDiff</to>
				</link>
				<link id="9f89b582dc254cf6b63fdba9e502a3b0"
					fixedValue="true">
					<from>false</from>
					<to>isFirstSync</to>
				</link>
			</map>
			<break id="db88595e76b64ef88d652376343c7556"
				description="No changes between versions, this should not occur"
				disabled="true"
				label="!cdmDiff &amp;&amp; subscription/system !# input/forcePushForSystem">
				<count>2</count>
				<continueExecution>true</continueExecution>
			</break>
		</sequence>
		<map id="86804d5db1924c979911c8e9715265f9"
			comment="No subscription yet, create it"
			label="!instanceSubscription">
			<invoke id="3185ee12cd6544c98bb7ff320322c17d"
				resultName="resultb3e4c754b5454ba189248b491714cdec"
				serviceId="nabu.frameworks.cdm.crud.cdmInstanceSubscription.services.create"
				x="269"
				y="89">
				<link id="8176d9b51b2a45bd9949dd4fe5ac866f">
					<from>input/cdmInstanceId</from>
					<to>instance/cdmInstanceId</to>
				</link>
				<link id="f6bf40fed78c4ad9b7f29f1d9c0a4c43">
					<from>subscription/id</from>
					<to>instance/cdmSubscriptionId</to>
				</link>
			</invoke>
			<link id="8ee02f293d5342d98950ddb646b333d9">
				<from>resultb3e4c754b5454ba189248b491714cdec/created</from>
				<to>instanceSubscription</to>
			</link>
			<invoke id="28a0e53c43804565a955ad0274723dad"
				invocationOrder="1"
				resultName="resultd01e31c6574e4a49b5c1ab70576dc5fe"
				serviceId="nabu.utils.List.add"
				x="776"
				y="213">
				<link id="bb7094631d04439183ca2e9813727f2d">
					<from>resultb3e4c754b5454ba189248b491714cdec/created</from>
					<to>object</to>
				</link>
				<link id="931ab98e43f04db39f4e515675ebaef3">
					<from>instanceSubscriptions</from>
					<to>list</to>
				</link>
			</invoke>
			<link id="54f7bc65dc1a4d1bb3b865cf358912f0">
				<from>resultd01e31c6574e4a49b5c1ab70576dc5fe/list</from>
				<to>instanceSubscriptions</to>
			</link>
		</map>
		<map id="b9a17fc543e749089e00a37c2671a397"
			comment="Unmarshal the content if we have it"
			label="instanceSubscription/content != null">
			<invoke id="9d7bfca6ffc742b9be6a2c45c0f2b5a1"
				invocationOrder="1"
				resultName="resultffe171ae34a4424a980935209f42ef0b"
				serviceId="nabu.data.json.Services.unmarshal"
				x="460"
				y="108">
				<link id="744bcc4f6d614fd08e4b472850902f9f">
					<from>result902358dc10374006a97af3a8d18f7146/first</from>
					<to>type</to>
				</link>
				<link id="d3c8ce3269fa49c4aa7d2b0592a6a9b4">
					<from>result3bc1f50959f946408d8cb565bf8660ce/stream</from>
					<to>input</to>
				</link>
				<link id="c595e547401442bc837080fb34673a0c"
					fixedValue="true">
					<from>true</from>
					<to>ignoreUndefinedFields</to>
				</link>
			</invoke>
			<invoke id="b5af7116ed8041e6842d26debcceb228"
				resultName="result902358dc10374006a97af3a8d18f7146"
				serviceId="nabu.utils.Object.first"
				x="23"
				y="58">
				<link id="d29f415361d1407aa9141bdae91c5c92">
					<from>subscription/typeId</from>
					<to>options[0]</to>
				</link>
				<link id="899cc828e755416085470034484b3bbe">
					<from>subscription/coreTypeId</from>
					<to>options[1]</to>
				</link>
			</invoke>
			<invoke id="666bd20f09d04f42939c7e57d7b52d5f"
				resultName="result3bc1f50959f946408d8cb565bf8660ce"
				serviceId="nabu.utils.String.toStream"
				x="59"
				y="245">
				<link id="b9b07165b6a74a2c9de439d11c7f69c1">
					<from>instanceSubscription/content</from>
					<to>string</to>
				</link>
				<link id="c9255f798fec4c1a94dd60f34d8cb77d"
					fixedValue="true">
					<from>UTF-8</from>
					<to>charset</to>
				</link>
			</invoke>
			<link id="e4565322aaf043548b9a4fc7f478557e">
				<from>resultffe171ae34a4424a980935209f42ef0b/unmarshalled</from>
				<to>partialInstance</to>
			</link>
		</map>
		<map id="465168b1357345f78eb4ae556c041912"
			comment="Get interested relations"
			label="interestedRelationTypes">
			<link id="651f0d3dc8b441e9a310f38d08b289f5">
				<from>allExistingRelations[cdmSystemSubscriptionId != /subscription/id &amp;&amp; cdmRelationTypeId # /interestedRelationTypes/cdmRelationTypeId]</from>
				<to>interestingRelations</to>
			</link>
			<link id="d5700c9ee6424bf78b62e22ea76decb2">
				<from>allInactivatedRelations[cdmSystemSubscriptionId != /subscription/id &amp;&amp; cdmRelationTypeId # /interestedRelationTypes/cdmRelationTypeId]</from>
				<to>interestingInactivatedRelations</to>
			</link>
		</map>
		<switch id="1f634d45a4c645d4a5d4d8b64e66819c"
			comment="Get changed relations (if any)"
			label="interestingRelations">
			<map id="dc626554df834aedb5dd4bf449381ee0"
				comment="Figure out the changed relations before we do any updates to them. Note that if the change is &quot;inactivation&quot;, we are also interested!"
				label="instanceSubscription/pushed != null">
				<invoke id="dcf31bd6049448de968bc77db22e90cf"
					resultName="resulte23301bc39ff441e8af58605096ec600"
					serviceId="nabu.utils.List.addAll"
					x="331"
					y="94">
					<link id="fcc12eb87a054a529c40af31571d1f46">
						<from>interestingInactivatedRelations[started &gt;= /instanceSubscription/pushed || (stopped != null &amp;&amp; stopped &gt;= /instanceSubscription/pushed) || (modified != null &amp;&amp; modified &gt;= /instanceSubscription/pushed)]</from>
						<to>list</to>
					</link>
					<link id="d9f00a7705dc4861a0d5602baaf546e9">
						<from>interestingRelations[started &gt;= /instanceSubscription/pushed || (stopped != null &amp;&amp; stopped &gt;= /instanceSubscription/pushed) || (modified != null &amp;&amp; modified &gt;= /instanceSubscription/pushed)]</from>
						<to>objects</to>
					</link>
				</invoke>
				<link id="cab57a16e6344b58a52deba3d193ff0a">
					<from>resulte23301bc39ff441e8af58605096ec600/list</from>
					<to>changedRelations</to>
				</link>
			</map>
			<map id="3ef996e0abc44352b436a7d4c1aabb31">
				<link id="ee77f9966fff44efa25a1cfe3c90234c">
					<from>interestingRelations</from>
					<to>changedRelations</to>
				</link>
			</map>
		</switch>
		<map id="9f5df03d2f8c48bfab684f9018f5eb54"
			comment="If we aren't pushing but interesting relations have been updated, push anyway"
			label="!push &amp;&amp; changedRelations != null">
			<link id="11886c295f2c47b3a13eeacb62ba1c29"
				fixedValue="true">
				<from>true</from>
				<to>push</to>
			</link>
		</map>
		<map id="040be642c7a545b4806f9dfaae178076"
			comment="If the external ids were modified, also do a push. This assumes external ids do not modify often!"
			label="!push &amp;&amp; instanceSubscription/pushed != null &amp;&amp; instanceSubscription/pushed &lt;= mostRecentExternalIdModification">
			<link id="bbe99dbf7f0644488b4e893a2a5cb927"
				fixedValue="true">
				<from>true</from>
				<to>push</to>
			</link>
		</map>
		<map id="99135964fd6446a4a6a7b4656bae5b2a"
			label="!push &amp;&amp; input/forcePushForSystem != null &amp;&amp; subscription/system # input/forcePushForSystem">
			<link id="02b9dc4f96904670809830d0038f391c"
				fixedValue="true">
				<from>true</from>
				<to>push</to>
			</link>
		</map>
		<map id="2e48891ebde246348d528eb8d7f4afbd"
			comment="If we are not intent on pushing but there is no partial instance just yet, push it"
			label="!push &amp;&amp; partialInstance == null">
			<link id="622a7fdd4d8b405495562a6415254271"
				fixedValue="true">
				<from>true</from>
				<to>push</to>
			</link>
		</map>
		<map id="5f96cf2352b84ceb8b8628f78fd49074"
			comment="If we have never pushed, push now"
			label="!push &amp;&amp; instanceSubscription/pushed == null">
			<link id="d62810af82ba4541b3bccb13a3944536"
				fixedValue="true">
				<from>true</from>
				<to>push</to>
			</link>
		</map>
		<sequence id="36a1cf0cce5441748b055782b4d9d2c3"
			comment="Always calculate the patched instance in case we want to push it must be available"
			label="partialInstance != null">
			<switch id="e994ed4aefbc4d6589795824aa463cff"
				comment="Check which diff we want to apply">
				<map id="b92c2b521a424531b6b877d250ca9fb8"
					comment="If we have no cdm diff (first sync of entire cdm instance), we diff against the full thing"
					label="isFirstSync || subscription/system # input/fullPushForSystem">
					<invoke id="b41e8892d2c54e57b9a3b0db397f0587"
						resultName="result104dde8382fc43cf9beb8fee1f16aeaf"
						serviceId="nabu.frameworks.cdm.utils.diff"
						x="71"
						y="110">
						<link id="75c817201d21486ab7300d959cdc7580">
							<from>cdmInstance</from>
							<to>new</to>
						</link>
						<link id="bc8e106dc941409a97196c7b23fa3a9e">
							<from>partialInstance</from>
							<to>original</to>
						</link>
						<link id="9e55d6c3b0da4bd4a5b849232a63fc7b"
							fixedValue="true">
							<from>false</from>
							<to>changedOnly</to>
						</link>
					</invoke>
					<link id="bf0d2b94d3a84dac8faa0f9d5ab5c863">
						<from>result104dde8382fc43cf9beb8fee1f16aeaf/diffs</from>
						<to>diffToApply</to>
					</link>
				</map>
				<map id="667b9763e0cf4c61a6dcfb8d975a5374"
					comment="We only apply actual changes we noticed, not the full cdm, this leaves unreported changes as is for the next pickup">
					<link id="3dd14a4ce4f34e2491bca0240d6ee05b">
						<from>cdmDiff</from>
						<to>diffToApply</to>
					</link>
				</map>
			</switch>
			<map id="54055938073d43b3bfcff754c8990e8c"
				comment="Make a masked instance so we can diff changes">
				<invoke id="9fe510af26ef4800835cf85adef3dd73"
					invocationOrder="1"
					resultName="resultcd6647e639e348e6a41a7777bd6291d0"
					serviceId="nabu.utils.reflection.Type.mask"
					x="402"
					y="200">
					<link id="60be8a5d32cc42bbac41df4480d8a2cf">
						<from>partialInstance</from>
						<to>instance</to>
					</link>
					<link id="8441c32898f746658aab9ac38c4b62a7">
						<from>result591302c7e709455bb2db428f4d111d3d/typeId</from>
						<to>type</to>
					</link>
				</invoke>
				<invoke id="dc8241e03d294af2ae63e09eeb041eed"
					resultName="result591302c7e709455bb2db428f4d111d3d"
					serviceId="nabu.utils.reflection.Type.of"
					x="36"
					y="72">
					<link id="255c3d30f90643d29fecf83ff86dcdc0">
						<from>partialInstance</from>
						<to>typeInstance</to>
					</link>
				</invoke>
				<link id="8608849a0aff44e8ada2ffdd30f6d6d8">
					<from>resultcd6647e639e348e6a41a7777bd6291d0/masked</from>
					<to>patchedPartialInstance</to>
				</link>
				<drop id="01b1b8bb08304eedb8cc3c8ca0b55aaa"
					path="appliedDiffs"/>
			</map>
			<sequence id="ca336aefba324a3bb1e89d395f9b56a9"
				label="diffToApply">
				<map id="a4544dc730364f2a8038a3923fa974b6"
					comment="Patch the masked instance">
					<invoke id="0e25811c26f04012b8b14e19850069a3"
						resultName="result7c839e519cf5497296db0747c89b84ef"
						serviceId="nabu.frameworks.cdm.utils.patch"
						x="236"
						y="65">
						<link id="6dda9496368c4e4d93ee5822d68f3748">
							<from>diffToApply</from>
							<to>diffs</to>
						</link>
						<link id="b917d4e88b05422786aae4376f0306bb">
							<from>patchedPartialInstance</from>
							<to>instance</to>
						</link>
					</invoke>
				</map>
				<switch id="e81e6d652e2e427c95d0679678f08990"
					query="subscription/slaveTypeId">
					<map id="d451521b8eee4bba9f4a8c198d356db5"
						comment="Diff the masked"
						label="null">
						<invoke id="b48ae9930ddf4069b1a9412b3b9b8079"
							resultName="resultb0dec1ae89e04adb92a3b6c9c0200b0d"
							serviceId="nabu.frameworks.cdm.utils.diff"
							x="199"
							y="129">
							<link id="318367004d8b491c88d0ea19b9d938f9">
								<from>partialInstance</from>
								<to>original</to>
							</link>
							<link id="82eb9eb3620541c69cfa2a71030fcfcf">
								<from>patchedPartialInstance</from>
								<to>new</to>
							</link>
						</invoke>
						<link id="9b383f2d672e4dd89f40cf1796d868a5">
							<from>resultb0dec1ae89e04adb92a3b6c9c0200b0d/diffs</from>
							<to>appliedDiffs</to>
						</link>
					</map>
					<map id="face5ee0121342f78e1cbdc05fc281a4"
						comment="Diff the cast version of the slave. Any changes to unchangeable fields should not trigger a sync">
						<invoke id="a800e161f2984b02a900b5b843edc37b"
							invocationOrder="1"
							resultName="resultb0dec1ae89e04adb92a3b6c9c0200b0d"
							serviceId="nabu.frameworks.cdm.utils.diff"
							x="467"
							y="158">
							<link id="4b9011eda1214a3b9565f5214f811fdb">
								<from>resultea0f5c44cfc84354a0e6355e040c99c6/masked</from>
								<to>new</to>
							</link>
							<link id="f0af537b03e34bbdb37d52c5de25b933">
								<from>result182474d388644f1b8019b741b6dcc5a5/masked</from>
								<to>original</to>
							</link>
						</invoke>
						<link id="e8bab844bd59421a820e8be3d52bc3c6">
							<from>resultb0dec1ae89e04adb92a3b6c9c0200b0d/diffs</from>
							<to>appliedDiffs</to>
						</link>
						<invoke id="0a0dccc107854281a4bd30dde4beb16c"
							resultName="result182474d388644f1b8019b741b6dcc5a5"
							serviceId="nabu.utils.reflection.Type.mask"
							x="80"
							y="113">
							<link id="7d980fc374e446099d427d6e3c880d2b">
								<from>partialInstance</from>
								<to>instance</to>
							</link>
							<link id="911ef24e5c7f4f3db0b83d95b7a37398">
								<from>subscription/slaveTypeId</from>
								<to>type</to>
							</link>
						</invoke>
						<invoke id="efa719c88b3348a28c6f62a4872f17e5"
							resultName="resultea0f5c44cfc84354a0e6355e040c99c6"
							serviceId="nabu.utils.reflection.Type.mask"
							x="69"
							y="299">
							<link id="196b2de560dd4005ac94a5798cef4722">
								<from>patchedPartialInstance</from>
								<to>instance</to>
							</link>
							<link id="baeff43293d842f480505ce4d90c1d99">
								<from>subscription/slaveTypeId</from>
								<to>type</to>
							</link>
						</invoke>
					</map>
				</switch>
				<map id="f7a2d5a4e13145a2a622b2530477c8ef"
					comment="If we were not intending on pushing just yet, we do now"
					label="!push">
					<link id="ed6d0816566f48cdab98744dd25360ff"
						fixedValue="true">
						<from>=appliedDiffs != null</from>
						<to>push</to>
					</link>
				</map>
			</sequence>
			<sequence id="fb884cb0c87e408385992d9348570773"
				comment="We want to proactively revert forbidden diffs if you have changed something you are not master of"
				label="subscription/masterTypeId != null">
				<map id="14a8096fad534d2aaaa1634592e92131"
					comment="Diff our patched instance against the cdm and get all the fields that you are allowed to change">
					<invoke id="6a661863fd304ef7a75fcbfcfe8d7a83"
						resultName="result1a43fa07b3cc40379a81e47e265f4f9e"
						serviceId="nabu.frameworks.cdm.utils.diff"
						x="226"
						y="86">
						<link id="8cbb02c396d74159927bad42a4bd98f3">
							<from>cdmInstance</from>
							<to>new</to>
						</link>
						<link id="f74c1e45f2584d108903e548febdfa46"
							fixedValue="true">
							<from>false</from>
							<to>changedOnly</to>
						</link>
						<link id="995bc13492a14aaa94e570c789c7ab46">
							<from>patchedPartialInstance</from>
							<to>original</to>
						</link>
					</invoke>
					<link id="2bcfe197be6948ad83dd3fa4c57b37f7">
						<from>result1a43fa07b3cc40379a81e47e265f4f9e/diffs</from>
						<to>revertToCdmDiffs</to>
					</link>
					<invoke id="bc0407b02eeb4068a10ad3e629de8a3e"
						resultName="result9f33297a72514b099dbfb0adeecaaa73"
						serviceId="nabu.utils.reflection.Type.describe"
						x="309"
						y="232">
						<link id="076841beb8f242d2a3ce8d144806b1e4">
							<from>subscription/masterTypeId</from>
							<to>typeId</to>
						</link>
						<link id="fac0526b943d479e881f676da01356ff"
							fixedValue="true">
							<from>true</from>
							<to>recursive</to>
						</link>
					</invoke>
					<link id="58d9d30182194ca78fd1733ec3e24a43">
						<from>result9f33297a72514b099dbfb0adeecaaa73/parameters</from>
						<to>masterParameters</to>
					</link>
				</map>
				<map id="48307ca528cb46bd8a85586cbe3ad4de"
					comment="Retain reversion diff for paths that are not in the master">
					<link id="95840b02b4cd403dbe776a5e0307a0ba">
						<from>revertToCdmDiffs[propertyPath !# /masterParameters/path]</from>
						<to>revertToCdmDiffs</to>
					</link>
				</map>
				<sequence id="e8038aa36aad46fab72a1d7208b4cf0c"
					comment="If you have diffs to revert but you also have a slave document, make sure we only revert diffs you must follow"
					label="revertToCdmDiffs != null &amp;&amp; subscription/slaveTypeId != null">
					<map id="2ba687c91060428b894110d4013599e4">
						<invoke id="c05b71bb86214a2f858d04d97ea144a2"
							resultName="result73061734c6434fc785f96ddeb0f4bff5"
							serviceId="nabu.utils.reflection.Type.describe"
							x="136"
							y="50">
							<link id="fecd8bb8d104454ba8830c7b46cec6a6">
								<from>subscription/slaveTypeId</from>
								<to>typeId</to>
							</link>
						</invoke>
						<link id="85d0859864bb4833ab552a03e57ac79f">
							<from>result73061734c6434fc785f96ddeb0f4bff5/parameters</from>
							<to>slaveParameters</to>
						</link>
					</map>
					<map id="ebced4c734a44a208912c8fe78f18e65"
						comment="Limit to slave parameters">
						<link id="98c167387a3f45659bb70c3fb4285b13">
							<from>revertToCdmDiffs[propertyPath # /slaveParameters/path]</from>
							<to>revertToCdmDiffs</to>
						</link>
					</map>
				</sequence>
				<map id="fee008aaa5394e029cf7032bff3a9dc7"
					comment="Make sure we push to revert unauthorized changes"
					label="revertToCdmDiffs">
					<link id="6dffdd2934624751889e93e8c0e24f06"
						fixedValue="true">
						<from>true</from>
						<to>push</to>
					</link>
				</map>
			</sequence>
		</sequence>
		<sequence id="cbf94e36ee064b4ea604de0b810e5e32"
			comment="If we want to push at this point, let's do it"
			label="push">
			<sequence id="dba4d61c39224cf28cefc4e79363a336"
				comment="Pull: in some cases we need to refresh the data BEFORE we push it, to make sure we don't rollback pending changes">
				<switch id="cbf7945cc16b452fa4b152af6223f17f">
					<sequence id="1cff32cfb0b847bfb8b1ef14e69852a5"
						comment="If you have a pullinterval, check if we are beyond it"
						label="instanceSubscription/pulled != null &amp;&amp; subscription/pullInterval != null">
						<map id="c5f3a44f253449e8b6444ff5eeff9656"
							comment="Calculate the next pull window">
							<invoke id="e03df6f8b9b74b0bbb1b446860b795c0"
								resultName="result5bfa6321f9b640cbb5facac56d37561d"
								serviceId="nabu.utils.Date.incrementDuration"
								x="219"
								y="120">
								<link id="f22e33ff33e04a38907958c80e5291a5">
									<from>subscription/pullInterval</from>
									<to>duration</to>
								</link>
								<link id="7194becb482a47fe9eb045add5fc7bd1">
									<from>instanceSubscription/pulled</from>
									<to>start</to>
								</link>
							</invoke>
							<link id="4a136e76cc9a41ec9fd863db9c989247">
								<from>result5bfa6321f9b640cbb5facac56d37561d/date</from>
								<to>nextPull</to>
							</link>
						</map>
						<map id="6b01386f6b4942a29c1a274af44e1766"
							comment="Calculate whether or not to pull based on the available interval">
							<link id="0d31bbc53e8b4ba68c6d3dc2c2927c51"
								fixedValue="true">
								<from>=date &gt;= nextPull</from>
								<to>pullNewData</to>
							</link>
						</map>
						<map id="3aac6e8f3bd64460be4d7cb7421dd813"
							comment="Check that we don't need to skip it"
							label="input/skipPullForSystem != null &amp;&amp; pullNewData">
							<link id="4a3e4989e86f491c8e1b62a4a37fe7dc"
								fixedValue="true">
								<from>=subscription/system !# /input/skipPullForSystem</from>
								<to>pullNewData</to>
							</link>
						</map>
					</sequence>
					<map id="8c39e658dac5486a9383159b66570372"
						comment="If we have a pull service but have not yet pulled, do that first. If we have pulled before but you claim to be trigger only, we want to make absolutely sure we didn't miss a trigger. Either webhook failure, configuration error,..."
						label="subscription/pullId != null &amp;&amp; (instanceSubscription/pulled == null || subscription/triggerOnly == true)">
						<link id="96bac7c05a734c3c9fd4df63204b96fc"
							fixedValue="true">
							<from>true</from>
							<to>pullNewData</to>
						</link>
					</map>
				</switch>
				<sequence id="f1a03dc39cb6491482ab9662175c4974"
					comment="Refresh potentially stale data first"
					label="subscription/pullId != null &amp;&amp; pullNewData">
					<map id="d4e23b29cbc94b71bfa396fad18c33b6">
						<invoke id="82a793554830497997dc523ec3ee1602"
							resultName="result7183429fcb04496d9a75bc61d18aba32"
							serviceId="nabu.frameworks.cdm.specs.pull"
							x="78"
							y="36">
							<link id="d9111639041e4fc4b6181c368cd94ffb">
								<from>externalIds</from>
								<to>externalIds</to>
							</link>
							<link id="5e78a274c44843b2ab85fd95b2c3d943">
								<from>input/cdmInstanceId</from>
								<to>cdmInstanceId</to>
							</link>
							<link id="ab5412bd2b9f4084920568e991af313d">
								<from>subscription/pullId</from>
								<to>implementationId</to>
							</link>
							<link id="6eea7e65f43545039c41732070b765d5">
								<from>existingRelations</from>
								<to>relations</to>
							</link>
						</invoke>
						<link id="fefbacb7deae4630833a61630f1b85f8">
							<from>result7183429fcb04496d9a75bc61d18aba32/externalIds</from>
							<to>newExternalIds</to>
						</link>
						<link id="39c24ff1b8cb4afda9a22c04f2c99355">
							<from>date</from>
							<to>instanceSubscription/pulled</to>
						</link>
						<link id="848dd845961b48b192b39a8db2af890e">
							<from>result7183429fcb04496d9a75bc61d18aba32/cdmInstance</from>
							<to>newestPartialInstance</to>
						</link>
						<link id="34a2c0c039f84c8bbe9d39208388afbd">
							<from>result7183429fcb04496d9a75bc61d18aba32/relations</from>
							<to>newRelations</to>
						</link>
					</map>
					<map id="85b3245ea4094a81be16363511293e35"
						comment="Update the ids"
						label="newExternalIds">
						<invoke id="6cf7e93e611e4992b036a591cfde2745"
							resultName="result35cf43d44d4343a393614080fe7f194e"
							serviceId="nabu.frameworks.cdm.utils.externalId.update"
							x="170"
							y="85">
							<link id="964472ec7f674609956afb0468b8a211">
								<from>input/cdmInstanceId</from>
								<to>cdmInstanceId</to>
							</link>
							<link id="0508f1ac7976489da0addf480f2ad304">
								<from>newExternalIds</from>
								<to>newExternalIds</to>
							</link>
							<link id="894bfedb901c4031b2557fac6fe04a73">
								<from>externalIds</from>
								<to>existingExternalIds</to>
							</link>
							<link id="f4e5788c7ee74349a72edc6511579af1">
								<from>instanceSync/id</from>
								<to>cdmInstanceSyncId</to>
							</link>
							<link id="501d507de8414642897e932df8c3b2a3">
								<from>instanceSubscription/id</from>
								<to>cdmInstanceSubscription</to>
							</link>
						</invoke>
						<link id="3d7cd2ee60bb442db884be87f2ed583d">
							<from>result35cf43d44d4343a393614080fe7f194e/externalIds</from>
							<to>externalIds</to>
						</link>
						<invoke id="d3fd90407aa44234820d0059fa121c88"
							invocationOrder="1"
							resultName="result7984e6eb17a841c68fb85731972df2ef"
							serviceId="nabu.utils.List.addAll"
							x="507"
							y="341">
							<link id="7a38626d6933411795948ecb967a89cb">
								<from>result35cf43d44d4343a393614080fe7f194e/logs</from>
								<to>objects</to>
							</link>
							<link id="190c061fcd664632940e5a08b135a97c">
								<from>logs</from>
								<to>list</to>
							</link>
						</invoke>
						<link id="c4a3d23bc5664f07a0cb4522d3f58df7">
							<from>result7984e6eb17a841c68fb85731972df2ef/list</from>
							<to>logs</to>
						</link>
						<link id="2815fabf31764ac2866a61cd2a3c7da7"
							fixedValue="true">
							<from>true</from>
							<to>output/hasNewMetadata</to>
						</link>
					</map>
					<sequence id="257de5fdc8074f2fa2ddb923e512c2eb"
						comment="If we had an instance but no longer have one, we set to decoupled and skip"
						label="newestPartialInstance == null &amp;&amp; partialInstance != null">
						<map id="f5d7b17cc44e4dbb92c42318e8915d70"
							comment="Set decoupled">
							<link id="7d4137b6a8e140d1b784ad0709feed7d">
								<from>date</from>
								<to>instanceSubscription/decoupled</to>
							</link>
							<drop id="31d40dce32714d33a250892463f576f0"
								path="instanceSubscription/content"/>
						</map>
						<break id="d858080656ed46a9984cf6cc68cff605">
							<count>5</count>
							<continueExecution>true</continueExecution>
						</break>
					</sequence>
					<map id="073aa9d29a7745f8a83c0356cb40fa61">
						<invoke id="26fdfc8c9c774cc1b9a1f5dadebe6f59"
							resultName="result267941eb0565452e8d2e8bb5ebb9e2a9"
							serviceId="nabu.frameworks.cdm.utils.relation.update"
							x="66"
							y="54">
							<link id="ed59964937b94933ae3c163434642819">
								<from>input/cdmInstanceId</from>
								<to>cdmInstanceId</to>
							</link>
							<link id="f30d584c21934784b75073d1bb681bec">
								<from>newRelations</from>
								<to>newRelations</to>
							</link>
							<link id="60044718bfc84ba6a0030f37b4782197">
								<from>existingRelations</from>
								<to>existingRelations</to>
							</link>
							<link id="6c5eff5419a64ecea233ded70b956d06">
								<from>subscription/cdmDefinitionId</from>
								<to>cdmDefinitionId</to>
							</link>
							<link id="cd25dda848364291bfd4c97f7c798d24">
								<from>subscription/id</from>
								<to>cdmSystemSubscriptionId</to>
							</link>
						</invoke>
						<link id="78c6cb7f04c44ea9aa56ecf92e09d90b">
							<from>result267941eb0565452e8d2e8bb5ebb9e2a9/existingRelations</from>
							<to>existingRelations</to>
						</link>
						<invoke id="0457906455594e34862ed55a49975477"
							invocationOrder="1"
							resultName="resultae3aa067c5cb471d842ca58b086b7ea8"
							serviceId="nabu.utils.List.addAll"
							x="299"
							y="266">
							<link id="a9a221186f9f4f40afd53d5e9e0cdddf">
								<from>result267941eb0565452e8d2e8bb5ebb9e2a9/newRelations</from>
								<to>objects</to>
							</link>
							<link id="4f732e3f56b44bb1b50144f4290fd3d6">
								<from>allExistingRelations</from>
								<to>list</to>
							</link>
						</invoke>
						<link id="e9c04a8cdd694f53ba1e0e398fe5ae6c">
							<from>resultae3aa067c5cb471d842ca58b086b7ea8/list</from>
							<to>allExistingRelations</to>
						</link>
					</map>
					<map id="f177683cfedf4ebdbf3489a925b89bdc"
						comment="If we have a new instance, it may be of a different type (e.g. master) which may have less information than the core definition. So we don't map it in full but use a map by key to update specific values"
						label="partialInstance != null">
						<invoke id="a28ca62f5f7a4b8686ba1c78691e26a5"
							resultName="result7face7d0f076489fa07ea825790e0f64"
							serviceId="nabu.utils.Object.mapByKey"
							x="244"
							y="234">
							<link id="9f03ac6f883249fe9e0e581825d22431">
								<from>newestPartialInstance</from>
								<to>from</to>
							</link>
							<link id="ff7bbbab16dd45d4ad885699c6f0a719">
								<from>partialInstance</from>
								<to>into</to>
							</link>
						</invoke>
					</map>
					<switch id="042d9859899445629b1caa39b950eb71"
						comment="Make sure we have a correct partial instance, we recalculate the diff to apply (same code as above) on the new partial instance"
						query="partialInstance">
						<map id="754602a8b8b34af2afe15099fbda80c5"
							comment="Push a masked version of the current content"
							label="null">
							<invoke id="34666b682dff4a5ab199d8f23508b2b4"
								invocationOrder="1"
								resultName="result5211ea5434e34fee8c30dfb90b6241ed"
								serviceId="nabu.utils.reflection.Type.mask"
								x="350"
								y="211">
								<link id="83be00fbf7d241f3a987672bb22cff92">
									<from>resultb9458ad39dd24836aabbf5d2cfec7afe/first</from>
									<to>type</to>
								</link>
								<link id="11dd87e480244b23bd2ec2c4c2cd38cc">
									<from>cdmInstance</from>
									<to>instance</to>
								</link>
							</invoke>
							<invoke id="1619b6afa96147debe2197e9a5728a18"
								resultName="resultb9458ad39dd24836aabbf5d2cfec7afe"
								serviceId="nabu.utils.Object.first"
								x="14"
								y="135">
								<link id="9fcc4bd987ca40ce9b19b98dc7fcf6ff">
									<from>subscription/coreTypeId</from>
									<to>options[1]</to>
								</link>
								<link id="604346b0735f4bcd82b03215fcbb0b74">
									<from>subscription/typeId</from>
									<to>options[0]</to>
								</link>
							</invoke>
							<link id="34a11e2e14154cad8e91c5981a2dc1c7">
								<from>result5211ea5434e34fee8c30dfb90b6241ed/masked</from>
								<to>patchedPartialInstance</to>
							</link>
							<drop id="3ebcf4ab030145bd800566cf5a9044c0"
								path="appliedDiffs"/>
						</map>
						<sequence id="8a8899f28b7641bcac5546c3c531a834">
							<switch id="ec294afc6a0f45c086fd33124403f7ba"
								comment="Check which diff we want to apply">
								<map id="49fec5a94f3646c38aa4eecefd0b8f73"
									comment="If we have no cdm diff (first sync of entire cdm instance), we diff against the full thing"
									label="isFirstSync|| subscription/system # input/fullPushForSystem">
									<invoke id="a1f8e0295b654532bf64854a17d6f141"
										resultName="result104dde8382fc43cf9beb8fee1f16aeaf"
										serviceId="nabu.frameworks.cdm.utils.diff"
										x="71"
										y="110">
										<link id="196b460e42404ad98d911ede4bc986f2">
											<from>cdmInstance</from>
											<to>new</to>
										</link>
										<link id="e912e012212a49dbb4538103d0d94817">
											<from>partialInstance</from>
											<to>original</to>
										</link>
										<link id="164761834ce94e4586241aa330b68759"
											fixedValue="true">
											<from>false</from>
											<to>changedOnly</to>
										</link>
									</invoke>
									<link id="f77e68038ee94b6a8a38b202d39947fc">
										<from>result104dde8382fc43cf9beb8fee1f16aeaf/diffs</from>
										<to>diffToApply</to>
									</link>
								</map>
								<map id="a0ab974ebd154ad19f88e92b89f2cdb6"
									comment="We only apply actual changes we noticed, not the full cdm, this leaves unreported changes as is for the next pickup">
									<link id="ad8f25cc2fc14a6494e9143617e2e4d4">
										<from>cdmDiff</from>
										<to>diffToApply</to>
									</link>
								</map>
							</switch>
							<map id="85cd6980258040bd86dcec236c73e940"
								comment="Make a masked instance so we can diff changes">
								<invoke id="13fa4bb6084649879ca04a33e97b6351"
									invocationOrder="1"
									resultName="resultcd6647e639e348e6a41a7777bd6291d0"
									serviceId="nabu.utils.reflection.Type.mask"
									x="402"
									y="200">
									<link id="604f08378d4c412c892913caeae523ad">
										<from>partialInstance</from>
										<to>instance</to>
									</link>
									<link id="994d44f75c964612b60e2348e3a35156">
										<from>result591302c7e709455bb2db428f4d111d3d/typeId</from>
										<to>type</to>
									</link>
								</invoke>
								<invoke id="be635669b5b84bceae151af2557f771e"
									resultName="result591302c7e709455bb2db428f4d111d3d"
									serviceId="nabu.utils.reflection.Type.of"
									x="36"
									y="72">
									<link id="3a25268ad1be4350a79876356c26461a">
										<from>partialInstance</from>
										<to>typeInstance</to>
									</link>
								</invoke>
								<link id="572f619afc814dc4964e7a817a66f8e3">
									<from>resultcd6647e639e348e6a41a7777bd6291d0/masked</from>
									<to>patchedPartialInstance</to>
								</link>
								<drop id="d875a87f877342eca113c3076a13aece"
									path="appliedDiffs"/>
							</map>
							<sequence id="1d204adfc4294a98b199d56263e78644"
								label="diffToApply">
								<map id="7915d995367049a9b6221c79d23a2d79"
									comment="Patch the masked instance">
									<invoke id="7f19490b45e0449cb1e97162ab991083"
										resultName="result7c839e519cf5497296db0747c89b84ef"
										serviceId="nabu.frameworks.cdm.utils.patch"
										x="236"
										y="65">
										<link id="dc21c84746034d0bb00c90ce90aceb1b">
											<from>diffToApply</from>
											<to>diffs</to>
										</link>
										<link id="05db97e7f74645d2babad41e08d65e2a">
											<from>patchedPartialInstance</from>
											<to>instance</to>
										</link>
									</invoke>
								</map>
								<switch id="d5587294311e414d84c14cbc450d89f5"
									query="subscription/slaveTypeId">
									<map id="00e5fbbc222d431e8cf3fe9435fb8645"
										comment="Diff the masked"
										label="null">
										<invoke id="1410591b35474904a2332492e3b5405d"
											resultName="resultb0dec1ae89e04adb92a3b6c9c0200b0d"
											serviceId="nabu.frameworks.cdm.utils.diff"
											x="199"
											y="129">
											<link id="e3375a9f39d04da2adc0dc89a8642a68">
												<from>partialInstance</from>
												<to>original</to>
											</link>
											<link id="39988f582450490a9dde2a157a8016b2">
												<from>patchedPartialInstance</from>
												<to>new</to>
											</link>
										</invoke>
										<link id="2cb07b89b9d54919a7715677feffc616">
											<from>resultb0dec1ae89e04adb92a3b6c9c0200b0d/diffs</from>
											<to>appliedDiffs</to>
										</link>
									</map>
									<map id="8392d461f4be4e4c9eb3017a394d9e5f"
										comment="Diff the cast version of the slave. Any changes to unchangeable fields should not trigger a sync">
										<invoke id="8d4285fcbb3648eeb058711928dfb186"
											invocationOrder="1"
											resultName="resultb0dec1ae89e04adb92a3b6c9c0200b0d"
											serviceId="nabu.frameworks.cdm.utils.diff"
											x="467"
											y="158">
											<link id="ec969455174c49c08ac6fee19753a894">
												<from>resultea0f5c44cfc84354a0e6355e040c99c6/masked</from>
												<to>new</to>
											</link>
											<link id="ebe8ef050471492b9368e2d2d4906342">
												<from>result182474d388644f1b8019b741b6dcc5a5/masked</from>
												<to>original</to>
											</link>
										</invoke>
										<link id="93d410177a6b4f9bbfd4216d0941aac0">
											<from>resultb0dec1ae89e04adb92a3b6c9c0200b0d/diffs</from>
											<to>appliedDiffs</to>
										</link>
										<invoke id="8e3f31a57b3448108f3f96e65e1575be"
											resultName="result182474d388644f1b8019b741b6dcc5a5"
											serviceId="nabu.utils.reflection.Type.mask"
											x="80"
											y="113">
											<link id="b5c0440b78004e40a9a10a9cf8e571aa">
												<from>partialInstance</from>
												<to>instance</to>
											</link>
											<link id="30072ed135344c67a60d17a374781d17">
												<from>subscription/slaveTypeId</from>
												<to>type</to>
											</link>
										</invoke>
										<invoke id="f7e3ad1419ad4748a593b3f14e642a24"
											resultName="resultea0f5c44cfc84354a0e6355e040c99c6"
											serviceId="nabu.utils.reflection.Type.mask"
											x="69"
											y="299">
											<link id="cd2f21ed7ed2445a8c43ad986fd0f60e">
												<from>patchedPartialInstance</from>
												<to>instance</to>
											</link>
											<link id="93d03b4515fb405a92f34e24be545952">
												<from>subscription/slaveTypeId</from>
												<to>type</to>
											</link>
										</invoke>
									</map>
								</switch>
							</sequence>
						</sequence>
					</switch>
				</sequence>
			</sequence>
			<sequence id="74676bf0d79c413e814bc6be917d97b0"
				comment="If we have a master type, we need to &quot;overwrite&quot; any changes you might have done to fields that you are not master off"
				label="subscription/masterTypeId != null &amp;&amp; patchedPartialInstance != null">
				<map id="5b4f2142a1074c869c31df85f4e4e125"
					comment="Diff our patched instance against the cdm and get all the fields that you are allowed to change">
					<invoke id="14eb68465f884618b9f294884a73939b"
						resultName="result1a43fa07b3cc40379a81e47e265f4f9e"
						serviceId="nabu.frameworks.cdm.utils.diff"
						x="226"
						y="86">
						<link id="0f96c5db477041ea97200d2703c9134c">
							<from>cdmInstance</from>
							<to>new</to>
						</link>
						<link id="9998fb60ad2e436591aaba6acd81fba6"
							fixedValue="true">
							<from>false</from>
							<to>changedOnly</to>
						</link>
						<link id="1271db31aa39442da275cf719a15ad32">
							<from>patchedPartialInstance</from>
							<to>original</to>
						</link>
					</invoke>
					<link id="f5642dd3533d4dd69b6343b516b9ff77">
						<from>result1a43fa07b3cc40379a81e47e265f4f9e/diffs</from>
						<to>revertToCdmDiffs</to>
					</link>
					<invoke id="8d46de1e0b474c2e81acf124348ac626"
						resultName="result9f33297a72514b099dbfb0adeecaaa73"
						serviceId="nabu.utils.reflection.Type.describe"
						x="309"
						y="232">
						<link id="600929c84a0144e9872229fc930dd491">
							<from>subscription/masterTypeId</from>
							<to>typeId</to>
						</link>
						<link id="0728b04685df42a88b1ac7d6973d8d28"
							fixedValue="true">
							<from>true</from>
							<to>recursive</to>
						</link>
					</invoke>
					<link id="817ca823b38a44daab636970cbebb56c">
						<from>result9f33297a72514b099dbfb0adeecaaa73/parameters</from>
						<to>masterParameters</to>
					</link>
				</map>
				<map id="cb201e15e2db49d6bd1f0e0d222d4511"
					comment="Retain reversion diff for paths that are not in the master">
					<link id="99783725f68640c98ccd3e28e7f4e292">
						<from>revertToCdmDiffs[propertyPath !# /masterParameters/path]</from>
						<to>revertToCdmDiffs</to>
					</link>
				</map>
				<sequence id="b3cb60c1785644c8b9b602b44527bdda"
					comment="If you have diffs to revert but you also have a slave document, make sure we only revert diffs you must follow"
					label="revertToCdmDiffs != null &amp;&amp; subscription/slaveTypeId != null">
					<map id="c18cf05c29ff4e31a12a5b4e05a49139">
						<invoke id="f4f50cb67385444da684b1e92d8a0516"
							resultName="result73061734c6434fc785f96ddeb0f4bff5"
							serviceId="nabu.utils.reflection.Type.describe"
							x="136"
							y="50">
							<link id="3f785c13b4744de58b19d0c10a615a95">
								<from>subscription/slaveTypeId</from>
								<to>typeId</to>
							</link>
						</invoke>
						<link id="871322267ff543b2a65c0cca1e9950d9">
							<from>result73061734c6434fc785f96ddeb0f4bff5/parameters</from>
							<to>slaveParameters</to>
						</link>
					</map>
					<map id="9f153335fec249eb92fe802b716f33b3"
						comment="Limit to slave parameters">
						<link id="90fc4fcac58b447fb14883dbcbae97ce">
							<from>revertToCdmDiffs[propertyPath # /slaveParameters/path]</from>
							<to>revertToCdmDiffs</to>
						</link>
					</map>
				</sequence>
				<sequence id="11d161d5050b4c81bb9d0937ccd92604"
					comment="If we have any, apply them and log the reversion"
					label="revertToCdmDiffs">
					<map id="86fa36ed82134602ab1a6647d9d1c05c"
						comment="If we have any, apply them and log the reversion">
						<invoke id="b88d2e5f9e51407bb01568dd6c3baae2"
							resultName="resultfeb124fc2b5d448588e8092217b8fb67"
							serviceId="nabu.frameworks.cdm.utils.patch"
							x="73"
							y="207">
							<link id="657f3dc12d6a4f438d2e4a641abc0d8e">
								<from>revertToCdmDiffs</from>
								<to>diffs</to>
							</link>
							<link id="a07bdeb370b442f48a1d44eb65eb70fc">
								<from>patchedPartialInstance</from>
								<to>instance</to>
							</link>
						</invoke>
						<invoke id="94435dd483904024b766d59f1accb4e1"
							resultName="resulte5fed61ac5c041a2b5357233f89ae8f6"
							serviceId="nabu.frameworks.cdm.utils.instance.serializeDiff"
							x="82"
							y="20">
							<link id="6f82f84925a84be18ae04613ffd81cfd">
								<from>revertToCdmDiffs</from>
								<to>diffs</to>
							</link>
						</invoke>
						<link id="328b86d88bfb4658b1fb4f44be9adbeb">
							<from>resulte5fed61ac5c041a2b5357233f89ae8f6/marshalled</from>
							<to>log/content</to>
						</link>
						<link id="e2578fa832144ce0a940318b6493156c">
							<from>date</from>
							<to>log/created</to>
						</link>
						<link id="67d81776d7d3428da9dde18f7ed24357"
							fixedValue="true">
							<from>revert-changed</from>
							<to>log/logType</to>
						</link>
						<link id="abb45fcb1127433889bb0849375f115e">
							<from>instanceSubscription/id</from>
							<to>log/cdmInstanceSubscription</to>
						</link>
						<link id="df8eb19893154e5f96fa9bf1389affac">
							<from>instanceSync/id</from>
							<to>log/cdmInstanceSyncId</to>
						</link>
						<invoke id="c6d952aca6224226afd4e5119f3cd2e7"
							resultName="result77f6e15778a842ae8c3b6955d9660cd8"
							serviceId="nabu.utils.Server.uuid"
							x="441"
							y="39">
						</invoke>
						<link id="3aa991026c8c45cb8ef682544d6e6209">
							<from>result77f6e15778a842ae8c3b6955d9660cd8/uuid</from>
							<to>log/id</to>
						</link>
						<link id="7215ae518521442a940e7e9ec8b364d1">
							<from>input/cdmInstanceId</from>
							<to>log/cdmInstanceId</to>
						</link>
					</map>
					<map id="747f8be86fb345a480bca525c83b95ff">
						<invoke id="f65c4114b1b040b89031e671d5810799"
							resultName="result747601e4b6b449709764bff79738a1c9"
							serviceId="nabu.utils.List.add"
							x="165"
							y="160">
							<link id="cb781405b4a14149834183793c310edb">
								<from>logs</from>
								<to>list</to>
							</link>
							<link id="71ae614ff83f4a4da44f2155e3788a86">
								<from>log</from>
								<to>object</to>
							</link>
						</invoke>
						<link id="cdc7122d77d74dbd8bab64bc5015e93d">
							<from>result747601e4b6b449709764bff79738a1c9/list</from>
							<to>logs</to>
						</link>
						<drop id="e89e8cb9dff14bf7b51729f136500897"
							path="log"/>
						<invoke id="1dbbc9d8de384e2fbb12b9ae966e1256"
							resultName="result5dc2d8468f2c4dd88a075019deda23be"
							serviceId="nabu.utils.List.addAll"
							x="80"
							y="41">
							<link id="db753189e74c4eb2aff66a101a78ead9">
								<from>revertToCdmDiffs</from>
								<to>objects</to>
							</link>
							<link id="9325d7bdb37c4844a9503fea1e5936b2">
								<from>appliedDiffs</from>
								<to>list</to>
							</link>
						</invoke>
						<link id="feae29ac9fe74798b97daa701e48253c">
							<from>result5dc2d8468f2c4dd88a075019deda23be/list</from>
							<to>appliedDiffs</to>
						</link>
					</map>
				</sequence>
			</sequence>
			<sequence id="97fae49803084fc9aef5bdfa8f39b6df"
				comment="We have never pushed or the content is &quot;lost&quot;, let's push the current CDM content to ensure that it is brought into sync with the cdm as it is currently. @2025-07-30: presumably not needed because without push we don't have a last instance, without last instance we don't have a cdm diff."
				label="instanceSubscription/pushed == null || instanceSubscription/content == null">
				<map id="1c4de5306dcd48edbd6240e705c2950d"
					comment="We push the cdm instance as a whole to make sure all fields are up to date">
					<invoke id="d1689152ebe947dfaee6ac91692a067f"
						invocationOrder="1"
						resultName="resulte32ee87752d141fa9355791d71dbd7ad"
						serviceId="nabu.utils.Object.first"
						x="106"
						y="167">
						<link id="838f12e180594bd6b6b8c1d217ef8a9a">
							<from>subscription/coreTypeId</from>
							<to>options[1]</to>
						</link>
						<link id="e4c6948cf93444cf860a0cbeab1ee142">
							<from>subscription/typeId</from>
							<to>options[0]</to>
						</link>
					</invoke>
					<invoke id="e94e06fc5ec84b3797cb0b191662d24f"
						invocationOrder="2"
						resultName="result9b558c1bc88b4dfe902826aa874c02b1"
						serviceId="nabu.utils.reflection.Type.mask"
						x="605"
						y="125">
						<link id="8ee19e69c78046a093deba90975059db">
							<from>cdmInstance</from>
							<to>instance</to>
						</link>
						<link id="deb9c3f436cd402db560e672b9d42deb">
							<from>resulte32ee87752d141fa9355791d71dbd7ad/first</from>
							<to>type</to>
						</link>
					</invoke>
					<link id="92655cd1f12342168be16a7b1a93d2cd">
						<from>result9b558c1bc88b4dfe902826aa874c02b1/masked</from>
						<to>patchedPartialInstance</to>
					</link>
				</map>
				<switch id="515c20bd9cad4784a6d8a0b91a96deb5"
					query="partialInstance">
					<map id="aaacbf0d824247f3be89198b891d7a86"
						label="null">
						<drop id="9c87d4358f8b4dbab8ae87133ccf4b97"
							path="appliedDiffs"/>
					</map>
					<map id="3caa8c4cce694bbcbadd836dea973207">
						<invoke id="7e172438f45b46539e79c4d2b100af04"
							resultName="result40202e4f31f5463d89299d5e1317945d"
							serviceId="nabu.frameworks.cdm.utils.diff"
							x="259"
							y="146">
							<link id="9122c8bdff7241388a8c0367ce41d0c0">
								<from>partialInstance</from>
								<to>original</to>
							</link>
							<link id="442473a7d9cd4c0d8cc39391b40a7a35">
								<from>patchedPartialInstance</from>
								<to>new</to>
							</link>
						</invoke>
						<link id="749b139e4f1a4fd9a83e1ca40316bdf9">
							<from>result40202e4f31f5463d89299d5e1317945d/diffs</from>
							<to>appliedDiffs</to>
						</link>
					</map>
				</switch>
			</sequence>
			<map id="aac2cc0f93674610ae17f66ccfb9d156"
				comment="Reset rejected">
				<link id="cc9c1a3eb0e34771b53ed95c957ee8ad"
					fixedValue="true">
					<from>false</from>
					<to>rejected</to>
				</link>
				<drop id="80f72e31849646b7a560bd2d8fdef313"
					path="rejectionReason"/>
			</map>
			<sequence id="76746ebf4d544977a096530fddecbd09"
				comment="Enrich with external ids"
				label="interestingRelations">
				<for id="f6a036ca5cd640a78c7ba6455c2191e8"
					into="interestingRelationsWithIds"
					variable="singleInterestingRelation">
					<map id="8175b453426e44e79c12655ad5c423a8"
						comment="Map initial">
						<link id="b407752e735847bf908c392869fd4a2e">
							<from>singleInterestingRelation</from>
							<to>interestingRelationsWithIds[0]</to>
						</link>
					</map>
					<map id="90c67617f13b453b8d6c9c32bd3b9fb9"
						comment="Map external ids"
						label="singleInterestingRelation/targetId != null">
						<link id="9c5a9465baa140a980b029b80aa8401b">
							<from>allExistingRelationTargetExternalIds[cdmInstanceId == /singleInterestingRelation/targetId]</from>
							<to>interestingRelationsWithIds[0]/targetExternalIds</to>
						</link>
					</map>
					<query>interestingRelations</query>
				</for>
			</sequence>
			<sequence id="25ef206d71a54d4d9daef3baaf84dbbd"
				comment="Do the actual push"
				scopeDefaultTransaction="true">
				<map id="c12f6b5a969e4c20a5ca5a4f4f1b020a"
					label="subscription/pullId != null">
					<invoke id="d482e25d94494829bc69c669c569fd17"
						invocationOrder="1"
						resultName="resultd482e25d94494829bc69c669c569fd17"
						serviceId="nabu.frameworks.cdm.utils.instance.mapMissingFields"
						x="485"
						y="121">
						<link id="664bff12f541465580a0417c2fd7c72b">
							<from>subscription/pullId</from>
							<to>pullServiceId</to>
						</link>
						<link id="cee8ffbe26124316a6f94326d7d93a29">
							<from>cdmInstance</from>
							<to>cdmInstance</to>
						</link>
						<link id="9f197531da87407d90dbc2517b5113ea">
							<from>patchedPartialInstance</from>
							<to>partialInstance</to>
						</link>
						<link id="cced44593d034ae086d93bc422381f67">
							<from>resultf86f8cb0dee94510b92c26d2f9a88481/first</from>
							<to>definitionTypeId</to>
						</link>
					</invoke>
					<invoke id="f86f8cb0dee94510b92c26d2f9a88481"
						resultName="resultf86f8cb0dee94510b92c26d2f9a88481"
						serviceId="nabu.utils.Object.first"
						x="94"
						y="274">
						<link id="cd0bc0f1fed143fb8eb03c2efb70ae1b">
							<from>subscription/coreTypeId</from>
							<to>options[1]</to>
						</link>
						<link id="2e14b39cc5ea461f9403df00b7ed8eed">
							<from>subscription/typeId</from>
							<to>options[0]</to>
						</link>
					</invoke>
				</map>
				<map id="d6b3bf8a67954136acca6df8a0a8ec7b"
					comment="It is unclear whether we want the unpatched partial instance OR the previous cdm instance. Given &quot;assumed&quot; content and potentially unreported changes these might diverge from your reality?">
					<invoke id="fbb3af112b5c4c659b777757d7852d8a"
						resultName="result66c3d0f3aebe4c9596df5ce60f3bda6f"
						serviceId="nabu.frameworks.cdm.specs.push"
						x="137"
						y="65">
						<link id="d49f94464db04ebd8e8e8a6dcf93c720">
							<from>externalIds</from>
							<to>externalIds</to>
						</link>
						<link id="a26718217f73435abfb495e984b8d1cb">
							<from>patchedPartialInstance</from>
							<to>cdmInstance</to>
						</link>
						<link id="e1cd59656cbe4c9c94b464447fec36b4">
							<from>subscription/pushId</from>
							<to>implementationId</to>
						</link>
						<link id="f62d5967300e4c7ab931134b4ceca091">
							<from>existingRelations</from>
							<to>relations</to>
						</link>
						<link id="692799ef588f40f48d497b57c912c31f">
							<from>interestingRelationsWithIds</from>
							<to>interestingRelations</to>
						</link>
						<link id="1c5e6922861a4a8887ba7bcff02fe296">
							<from>partialInstance</from>
							<to>previousInstance</to>
						</link>
					</invoke>
					<link id="d9e8484f44274d98a13c0329f9d8d703">
						<from>result66c3d0f3aebe4c9596df5ce60f3bda6f/externalIds</from>
						<to>newExternalIds</to>
					</link>
					<link id="8b0f86a9779e4886873c6c0a13a7cb7f">
						<from>result66c3d0f3aebe4c9596df5ce60f3bda6f/rejected</from>
						<to>rejected</to>
					</link>
					<link id="badf254c7a9848fa9dc3467e504ef3fc">
						<from>result66c3d0f3aebe4c9596df5ce60f3bda6f/relations</from>
						<to>newRelations</to>
					</link>
				</map>
				<map id="40c41df8c6bf44968e9b3b4ef01d79e8"
					comment="Defaults to false"
					label="rejected == null">
					<link id="b941796e12cd411b9a6ba07515b8ed46"
						fixedValue="true">
						<from>false</from>
						<to>rejected</to>
					</link>
				</map>
				<catch id="c2243305dcd04460b9ecdbb8c2dd7ce8"
					variable="exception">
					<map id="d1d29d9eacfd4d38b854124ac5fbbfcc">
						<link id="f9be0a5c0cef40cbaebc4e6bc21de404"
							fixedValue="true">
							<from>true</from>
							<to>rejected</to>
						</link>
						<invoke id="1a85a00b03a442aba785dc72e8cdf414"
							resultName="result5990a55b187b4e80bb88d45ea66f8fad"
							serviceId="nabu.utils.Runtime.summarizeException"
							x="161"
							y="311">
							<link id="2c435ef308db4628a30d2bd3991cc1d1">
								<from>exception</from>
								<to>exception</to>
							</link>
						</invoke>
						<link id="7d787d09c6764c7996b66331d1194689">
							<from>result5990a55b187b4e80bb88d45ea66f8fad/summary/exceptionStack</from>
							<to>rejectionReason</to>
						</link>
					</map>
				</catch>
			</sequence>
			<map id="58998ed9bb87401695f0ec19f343fb3c"
				comment="Update the ids"
				label="newExternalIds">
				<invoke id="08d00c30ca704f279e31c675ccec59e3"
					resultName="result35cf43d44d4343a393614080fe7f194e"
					serviceId="nabu.frameworks.cdm.utils.externalId.update"
					x="170"
					y="85">
					<link id="0d665b6ae4914fb49c39cae32e1d2800">
						<from>input/cdmInstanceId</from>
						<to>cdmInstanceId</to>
					</link>
					<link id="163b1bbe0a3045b3b824b9e6f2b30da2">
						<from>newExternalIds</from>
						<to>newExternalIds</to>
					</link>
					<link id="075cf384be5b4c84afccefe798670c60">
						<from>externalIds</from>
						<to>existingExternalIds</to>
					</link>
					<link id="2a4077fce07642a1bee90adbf532b263">
						<from>instanceSubscription/id</from>
						<to>cdmInstanceSubscription</to>
					</link>
					<link id="131f0a00b3de4d47bf9f2f504115b453">
						<from>instanceSync/id</from>
						<to>cdmInstanceSyncId</to>
					</link>
				</invoke>
				<link id="f4556219132a4c71913b408b1b01417e">
					<from>result35cf43d44d4343a393614080fe7f194e/externalIds</from>
					<to>externalIds</to>
				</link>
				<invoke id="cfaada80951e418d89f8cc9767d1204b"
					invocationOrder="1"
					resultName="result543706be45754788aade5bec423cfff1"
					serviceId="nabu.utils.List.addAll"
					x="426"
					y="317">
					<link id="79f556e5678b488cae2b51aa18a20f72">
						<from>result35cf43d44d4343a393614080fe7f194e/logs</from>
						<to>objects</to>
					</link>
					<link id="3546c113730945f8a8ba0d4335460257">
						<from>logs</from>
						<to>list</to>
					</link>
				</invoke>
				<link id="b8cdebaad0174268bb0643da745b9ed7">
					<from>result543706be45754788aade5bec423cfff1/list</from>
					<to>logs</to>
				</link>
				<link id="e89209d6bee94369af743739d05bd254"
					fixedValue="true">
					<from>true</from>
					<to>output/hasNewMetadata</to>
				</link>
			</map>
			<for id="9e141712ece540a781f468245641d9c5"
				into="instanceSyncDiffs"
				variable="appliedDiff">
				<map id="6441928ac44142639daf31fbfa9718ee">
					<link id="28fe544f5360439d819389e7a591a70e">
						<from>appliedDiff/propertyPath</from>
						<to>instanceSyncDiffs[0]/propertyPath</to>
					</link>
					<link id="7bf715b3860c48ad8f999c6710f89160">
						<from>appliedDiff/path</from>
						<to>instanceSyncDiffs[0]/path</to>
					</link>
					<link id="6e60e0906b7f4ac584a52a8e455ed40a">
						<from>appliedDiff/action</from>
						<to>instanceSyncDiffs[0]/action</to>
					</link>
					<invoke id="6cf15faaaaa642b2a9ed7f967bf8b387"
						resultName="result7f23da2910234dde84698ad4eb2d5b3b"
						serviceId="nabu.utils.Object.toString"
						x="160"
						y="467">
						<link id="b88ba5f8a7a141c482d5f513e30de154">
							<from>appliedDiff/oldValue</from>
							<to>object</to>
						</link>
					</invoke>
					<link id="f905a5d6549b43bca8406cf7cfe41202">
						<from>result7f23da2910234dde84698ad4eb2d5b3b/string</from>
						<to>instanceSyncDiffs[0]/oldValue</to>
					</link>
					<invoke id="4e23275bd9494b53922d832ff21da686"
						resultName="resultad43eeb1d4d34ea9ab08937b9dbbe0a0"
						serviceId="nabu.utils.Object.toString"
						x="170"
						y="589">
						<link id="e86fdbb2868b403588c469207630675c">
							<from>appliedDiff/newValue</from>
							<to>object</to>
						</link>
					</invoke>
					<link id="b547fb8b0f454730b4804e562e7eb450">
						<from>resultad43eeb1d4d34ea9ab08937b9dbbe0a0/string</from>
						<to>instanceSyncDiffs[0]/newValue</to>
					</link>
					<link id="fabca94a582f4b84aedbfe6ad9d908df">
						<from>instanceSync/id</from>
						<to>instanceSyncDiffs[0]/cdmInstanceSyncId</to>
					</link>
					<link id="a1e424598de64c7098cbd6fb1a0b5fa9">
						<from>subscription/id</from>
						<to>instanceSyncDiffs[0]/cdmSystemSubscriptionId</to>
					</link>
					<invoke id="54796e7d60244b1e9210ee699e8e48dc"
						resultName="result7498bbd68eb34ae5b8a101026dc082d1"
						serviceId="nabu.utils.Server.uuid"
						x="250"
						y="191">
					</invoke>
					<link id="3efdf2dfa24a4f119f5bdf9a310142a7">
						<from>result7498bbd68eb34ae5b8a101026dc082d1/uuid</from>
						<to>instanceSyncDiffs[0]/id</to>
					</link>
					<link id="8019ec7a485742f1ad8f10301ae5f48d">
						<from>rejected</from>
						<to>instanceSyncDiffs[0]/rejected</to>
					</link>
				</map>
				<query>appliedDiffs</query>
			</for>
			<map id="47ce2c02fd6940e49af9c25a62a932f9"
				comment="Update the &quot;pushed&quot;, this is incorrect if it has been rejected!"
				disabled="true">
				<link id="1df901e2220943f494f58a70007211ed">
					<from>date</from>
					<to>instanceSubscription/pushed</to>
				</link>
				<link id="46d9ff9f96154e488540d51d5bb0daea">
					<from>currentContent/id</from>
					<to>instanceSubscription/lastCdmInstanceContentId</to>
				</link>
			</map>
			<switch id="2a80362c53a24e9a8da73b4701a30989">
				<sequence id="db8bc11e546241a88a1b9b43adfbbf35"
					label="rejected">
					<map id="2e53fda4265a4fd985df381cc8f78a2b">
						<drop id="38d63c670bcf4630a061b546e3d4c7df"
							path="rejectionReason"/>
						<link id="2b1a286be9544eeaba786dfd60e2fa59">
							<from>input/cdmInstanceId</from>
							<to>log/cdmInstanceId</to>
						</link>
						<link id="6e48e66b846845faba61e54ba1eb71f0">
							<from>rejectionReason</from>
							<to>log/content</to>
						</link>
						<link id="bdbd4dbf2cf44e51be84aa511d7cdd17"
							fixedValue="true">
							<from>push-rejected</from>
							<to>log/logType</to>
						</link>
						<link id="858085d092354897beab9f1630422828">
							<from>date</from>
							<to>log/created</to>
						</link>
						<invoke id="c68678b1889149878531e946f7f01b54"
							resultName="result07535968f2e14ee5a09e25c91cac4d59"
							serviceId="nabu.utils.Server.uuid"
							x="468"
							y="248">
						</invoke>
						<link id="350f5edf63194ffaa786d839978e315e">
							<from>result07535968f2e14ee5a09e25c91cac4d59/uuid</from>
							<to>log/id</to>
						</link>
						<link id="f0ceefd735ac4354aaf1f19f9fe7ab82">
							<from>instanceSync/id</from>
							<to>log/cdmInstanceSyncId</to>
						</link>
						<link id="afe5ed2d940c41c7bc76e5d8266c6c6e">
							<from>instanceSubscription/id</from>
							<to>log/cdmInstanceSubscription</to>
						</link>
						<link id="7e2ffe3021274775bdaba27b4a2b14b9">
							<from>currentContent/typeId</from>
							<to>event/artifactId</to>
						</link>
						<link id="65a6cfc1fe9e4c6884556494da9e4a8c"
							fixedValue="true">
							<from>cdm</from>
							<to>event/eventCategory</to>
						</link>
						<link id="2060af265f0c433d9a7119004f653a21"
							fixedValue="true">
							<from>push-rejected</from>
							<to>event/eventName</to>
						</link>
						<link id="f617aa408c60460e902a773c96b859b7">
							<from>input/cdmInstanceId</from>
							<to>event/localId</to>
						</link>
						<link id="139d7e24d9b441d6a5a55328eb2b31c0"
							fixedValue="true">
							<from>ERROR</from>
							<to>event/severity</to>
						</link>
						<link id="09fd524f495643ba959314862290803f">
							<from>rejectionReason</from>
							<to>event/stacktrace</to>
						</link>
						<invoke id="6504e96e0907438f937b02ead0a3afd0"
							resultName="result85f146aa696f482788888e033f34a9f1"
							serviceId="nabu.data.json.Services.marshal"
							x="73"
							y="102">
							<link id="416c15586aac40c0a6ec01db99645037">
								<from>patchedPartialInstance</from>
								<to>data</to>
							</link>
							<link id="e0c852ef47af4049939dd30c30938493"
								fixedValue="true">
								<from>true</from>
								<to>prettyPrint</to>
							</link>
							<link id="ebb58091dc774d888506c819c2c1e17c"
								fixedValue="true">
								<from>UTF-8</from>
								<to>charset</to>
							</link>
						</invoke>
						<invoke id="c817406881264e32b45e1b2117879945"
							invocationOrder="1"
							resultName="result0212553217084200898a67b256b93504"
							serviceId="nabu.utils.Stream.toString"
							x="474"
							y="116">
							<link id="c594089efbab47e0b336aff90166295e">
								<from>result85f146aa696f482788888e033f34a9f1/marshalled</from>
								<to>stream</to>
							</link>
							<link id="8778a32baa234ebbb67428e26c1238af"
								fixedValue="true">
								<from>UTF-8</from>
								<to>charset</to>
							</link>
						</invoke>
						<link id="971a69f8c30949018337dae684cdbc5e">
							<from>result0212553217084200898a67b256b93504/string</from>
							<to>event/data</to>
						</link>
						<link id="86bb085ad57e423ab1d5c06e6cfc4173">
							<from>subscription/system</from>
							<to>event/origin</to>
						</link>
					</map>
					<map id="d701a57c7eb1406e818fb30a24bb39a2">
						<invoke id="e6747e44dfb5457898363a6d1646fe80"
							resultName="result747601e4b6b449709764bff79738a1c9"
							serviceId="nabu.utils.List.add"
							x="165"
							y="160">
							<link id="b092038e44ad4863b7396dbf398116d8">
								<from>logs</from>
								<to>list</to>
							</link>
							<link id="f369be683f464f538211abfe19173419">
								<from>log</from>
								<to>object</to>
							</link>
						</invoke>
						<link id="b35dd8443abb456ba3a58dc078850b53">
							<from>result747601e4b6b449709764bff79738a1c9/list</from>
							<to>logs</to>
						</link>
						<drop id="b34749ac8c6244c3b91911ba9cc0ac05"
							path="log"/>
						<invoke id="c93a8966faef47979ee2e0a24a0b8f4d"
							resultName="resultef7b7f7631234139ada4cf396d1d3451"
							serviceId="nabu.utils.Event.fire"
							x="245"
							y="384">
							<link id="a044240af170458c985600dd29ad9318">
								<from>event</from>
								<to>event</to>
							</link>
						</invoke>
						<drop id="156448e945cd47b58b9f9860abeb9391"
							path="event"/>
					</map>
				</sequence>
				<map id="fa7f762ff61a489fa7b4361eb2da8eeb"
					comment="Marshal the content and update &quot;pulled&quot;. We assume that the data is now synchronized and pulling it would yield the same result">
					<invoke id="dc1c5baeaf7f4f9481cedafcbd5eb200"
						resultName="result41b021e3eff64fd5a8d115315540a448"
						serviceId="nabu.data.json.Services.marshal"
						x="33"
						y="97">
						<link id="41ed42c5076f4e85931e441f19e233db">
							<from>patchedPartialInstance</from>
							<to>data</to>
						</link>
						<link id="da1eefb913804c43ab3d4e0e288b8f3d"
							fixedValue="true">
							<from>UTF-8</from>
							<to>charset</to>
						</link>
						<link id="46b1bbe4186a46559b6f6a916ff336d4"
							fixedValue="true">
							<from>true</from>
							<to>prettyPrint</to>
						</link>
					</invoke>
					<invoke id="a01f4e50f86c44989faa9673b122bef0"
						invocationOrder="1"
						resultName="resultc080d996a16b454ba2a937a8580614de"
						serviceId="nabu.utils.Stream.toString"
						x="529"
						y="268">
						<link id="1e9f3611471042bab9660097322b03e5">
							<from>result41b021e3eff64fd5a8d115315540a448/marshalled</from>
							<to>stream</to>
						</link>
						<link id="9079bd6889544bbf8f2ff93941977ad3"
							fixedValue="true">
							<from>UTF-8</from>
							<to>charset</to>
						</link>
					</invoke>
					<link id="06a1a5bfa6204615a0c0659703b6ecdb">
						<from>resultc080d996a16b454ba2a937a8580614de/string</from>
						<to>instanceSubscription/content</to>
					</link>
					<link id="ce3321e16bb84dc4aabfc753467d146a">
						<from>date</from>
						<to>instanceSubscription/pulled</to>
					</link>
					<invoke id="ab618da291cd430c9d8ffe7e99862cd4"
						resultName="result417ae9edbfb34d01a81411d1706558da"
						serviceId="nabu.frameworks.cdm.utils.relation.update"
						x="65"
						y="213">
						<link id="4b1c4d264d7141089ae48a876ae1c8db">
							<from>input/cdmInstanceId</from>
							<to>cdmInstanceId</to>
						</link>
						<link id="f593bad9f6d84baf8dd82889a7956fbf">
							<from>existingRelations</from>
							<to>existingRelations</to>
						</link>
						<link id="9cbb3e8059eb40f7a8778dcdab8ef1b0">
							<from>newRelations</from>
							<to>newRelations</to>
						</link>
						<link id="357d566336f1492db1bf1211aac9ebc3">
							<from>subscription/cdmDefinitionId</from>
							<to>cdmDefinitionId</to>
						</link>
						<link id="9dc19a06570345f18293ae5bcc793e25">
							<from>subscription/id</from>
							<to>cdmSystemSubscriptionId</to>
						</link>
					</invoke>
					<link id="cb60107e04cc49c6ba69df4a2c7bb414">
						<from>result417ae9edbfb34d01a81411d1706558da/existingRelations</from>
						<to>existingRelations</to>
					</link>
					<link id="5ae9215b3fe245129ed2ce4b64e4b0bb"
						fixedValue="true">
						<from>true</from>
						<to>instanceSubscription/assumedContent</to>
					</link>
					<link id="aaac97be300648af804124c5369b7213">
						<from>date</from>
						<to>instanceSubscription/pushed</to>
					</link>
					<link id="4a1f5f9e059d4bf1a55d344e6ff85bb9">
						<from>currentContent/id</from>
						<to>instanceSubscription/lastCdmInstanceContentId</to>
					</link>
				</map>
			</switch>
			<sequence id="4132d113246d4032b1696a06e5d3cf2e"
				comment="If it is rejected and we have a provider service, check if it was perhaps deleted"
				label="rejected &amp;&amp; subscription/pullId != null">
				<map id="069dd61ddfa14701bcbf5b5979595f02">
					<invoke id="c33dfb78212641d99ef61702bad14fee"
						resultName="result7183429fcb04496d9a75bc61d18aba32"
						serviceId="nabu.frameworks.cdm.specs.pull"
						x="118"
						y="50">
						<link id="4e0342d25e184793b98322fda2206f94">
							<from>externalIds</from>
							<to>externalIds</to>
						</link>
						<link id="9353eab251084659bd080f604fa6aa4f">
							<from>input/cdmInstanceId</from>
							<to>cdmInstanceId</to>
						</link>
						<link id="f15ccb055366456a97186206764d86b0">
							<from>subscription/pullId</from>
							<to>implementationId</to>
						</link>
						<link id="f427bc13628a44bbabd3cc4aaf7a432a">
							<from>existingRelations</from>
							<to>relations</to>
						</link>
					</invoke>
					<link id="07f7445396ea43a7b75ed83d637ccd4f">
						<from>result7183429fcb04496d9a75bc61d18aba32/externalIds</from>
						<to>newExternalIds</to>
					</link>
					<link id="c37c29359ef748c4b9a0f401eae06bc3">
						<from>date</from>
						<to>instanceSubscription/pulled</to>
					</link>
					<link id="23f5e38548df4584b776d15698ed750a">
						<from>result7183429fcb04496d9a75bc61d18aba32/cdmInstance</from>
						<to>newestPartialInstance</to>
					</link>
					<link id="5aedb71e2ed24cd68957cee73ca8ee29">
						<from>result7183429fcb04496d9a75bc61d18aba32/relations</from>
						<to>newRelations</to>
					</link>
				</map>
				<map id="bcc8f2de21804a80a8ac1489085f6e48"
					comment="Update the ids, this might fail if the push partially succeeded. There should not be any new information at this point"
					disabled="true"
					label="newExternalIds">
					<invoke id="6ef0320513574c938aa1a50db885f23a"
						resultName="result35cf43d44d4343a393614080fe7f194e"
						serviceId="nabu.frameworks.cdm.utils.externalId.update"
						x="170"
						y="85">
						<link id="82e73e972df04c1e9b3228f1b2a58510">
							<from>input/cdmInstanceId</from>
							<to>cdmInstanceId</to>
						</link>
						<link id="071f19878350409fb907a756989da5db">
							<from>newExternalIds</from>
							<to>newExternalIds</to>
						</link>
						<link id="01d61456fae341e288b4c33e18abb3ad">
							<from>externalIds</from>
							<to>existingExternalIds</to>
						</link>
					</invoke>
					<link id="0ea9a81cfefd4a1c95df64ef7058f22a">
						<from>result35cf43d44d4343a393614080fe7f194e/externalIds</from>
						<to>externalIds</to>
					</link>
				</map>
				<switch id="6faf0afbca574587b2c91e211902f55a">
					<sequence id="ffb7d4deb8fe479bae2861c08d7366e1"
						comment="If we had an instance but no longer have one, we set to decoupled and skip"
						label="newestPartialInstance == null">
						<map id="ef62fef8824a4a33be9d5a4d827b8e23"
							comment="If we had content before, set to decoupled. If the initial create failed (e.g. mandatory field missing), we don't want to set it to decoupled just yet"
							label="instanceSubscription/content != null">
							<link id="c85727e81e1b4527beb9ce4a963da28a">
								<from>date</from>
								<to>instanceSubscription/decoupled</to>
							</link>
							<drop id="d1e919ed1f0d487ebba56a0450c653d5"
								path="instanceSubscription/content"/>
						</map>
						<break id="ad081687be8c451d84b3542e473c1a7b">
							<count>3</count>
							<continueExecution>true</continueExecution>
						</break>
					</sequence>
					<sequence id="deb73f6d87034eba93a02a1cdbc86e3b"
						comment="Otherwise we set the (potentially partially updated data) and update the pulled">
						<map id="e1160032a1b34a7ab0c0e3c97c8859cb">
							<invoke id="e518c8be6543420aa9924b333af18e03"
								resultName="result41b021e3eff64fd5a8d115315540a448"
								serviceId="nabu.data.json.Services.marshal"
								x="33"
								y="97">
								<link id="a82197097a0c4181add19c15acfd07df"
									fixedValue="true">
									<from>UTF-8</from>
									<to>charset</to>
								</link>
								<link id="b57cbfd8d19d4520b76efc5b055fdcaa"
									fixedValue="true">
									<from>true</from>
									<to>prettyPrint</to>
								</link>
								<link id="30976f74c4c74884a93a736041fba781">
									<from>newestPartialInstance</from>
									<to>data</to>
								</link>
							</invoke>
							<invoke id="50f0cf4f69424a058e1ab7c429f9df7e"
								invocationOrder="1"
								resultName="resultc080d996a16b454ba2a937a8580614de"
								serviceId="nabu.utils.Stream.toString"
								x="529"
								y="268">
								<link id="44c7c862eb72460ca9d255d6c91e4bed">
									<from>result41b021e3eff64fd5a8d115315540a448/marshalled</from>
									<to>stream</to>
								</link>
								<link id="d3f402ea223048dcbc7a9692ce210511"
									fixedValue="true">
									<from>UTF-8</from>
									<to>charset</to>
								</link>
							</invoke>
							<link id="6e7f7e6a4cdf493ea8f1d3c3291e988d">
								<from>resultc080d996a16b454ba2a937a8580614de/string</from>
								<to>instanceSubscription/content</to>
							</link>
							<link id="576535b9b92345a6acd0b2cb8b032725">
								<from>date</from>
								<to>instanceSubscription/pulled</to>
							</link>
							<link id="2fefbe9b0e9e48f5b85bb320872982a0"
								fixedValue="true">
								<from>false</from>
								<to>instanceSubscription/assumedContent</to>
							</link>
							<drop id="d4e8912cbd444f2f8ecb18769cea7cce"
								path="instanceSubscription/cdmSystemBatchPullId"/>
						</map>
						<map id="b3797462d2b243d1bbfcc71f906bd77c">
							<invoke id="fff2b0f16d2d4ec7af91d52f07d60e6f"
								resultName="result267941eb0565452e8d2e8bb5ebb9e2a9"
								serviceId="nabu.frameworks.cdm.utils.relation.update"
								x="91"
								y="41">
								<link id="a4c92ca50d1a477b8e9ff13956ccb71e">
									<from>input/cdmInstanceId</from>
									<to>cdmInstanceId</to>
								</link>
								<link id="f3ea5a12abfb46619f6456e9de9d7441">
									<from>newRelations</from>
									<to>newRelations</to>
								</link>
								<link id="8d05e48beb3d45c9add2f5d72aaad0cd">
									<from>existingRelations</from>
									<to>existingRelations</to>
								</link>
								<link id="7fed51059abb454f9bc10b2f72b01a51">
									<from>subscription/cdmDefinitionId</from>
									<to>cdmDefinitionId</to>
								</link>
								<link id="133e61b398254f9aa02faf2f257fafdf">
									<from>subscription/id</from>
									<to>cdmSystemSubscriptionId</to>
								</link>
							</invoke>
							<link id="0463b8bfea8649bda54f68b01a523a29">
								<from>result267941eb0565452e8d2e8bb5ebb9e2a9/existingRelations</from>
								<to>existingRelations</to>
							</link>
						</map>
					</sequence>
				</switch>
				<catch id="697528cc03184dfebd90a4b9dab39651"
					comment="The pull may fail!"
					variable="exception">
					<map id="0f1e3b08adeb4b7096c313a1ccc44c89">
						<drop id="8cff4cf328bc42db9acd2b59a89d6f34"
							path="rejectionReason"/>
						<link id="8485cffbae964c33976a469e873c4933">
							<from>input/cdmInstanceId</from>
							<to>log/cdmInstanceId</to>
						</link>
						<link id="14e3408c36a047b2992e916e356737d3"
							fixedValue="true">
							<from>rejection-pull-failed</from>
							<to>log/logType</to>
						</link>
						<link id="b3cecca9100b4baaa06c96162099cf94">
							<from>date</from>
							<to>log/created</to>
						</link>
						<invoke id="720174b6704048e39a7cfa56224d6059"
							resultName="result07535968f2e14ee5a09e25c91cac4d59"
							serviceId="nabu.utils.Server.uuid"
							x="468"
							y="248">
						</invoke>
						<link id="db2bbea51af348d18299460b854d406d">
							<from>result07535968f2e14ee5a09e25c91cac4d59/uuid</from>
							<to>log/id</to>
						</link>
						<link id="f254f15257094644a3b8d8a54c135bed">
							<from>instanceSync/id</from>
							<to>log/cdmInstanceSyncId</to>
						</link>
						<link id="fb95061561d44b6aa157ad5e691bcdaa">
							<from>instanceSubscription/id</from>
							<to>log/cdmInstanceSubscription</to>
						</link>
						<invoke id="c161d5ce62564fdc95d7f25a0c0b9201"
							resultName="resultf57d2860be694b509c0fd44d1455b051"
							serviceId="nabu.utils.Runtime.summarizeException"
							x="165"
							y="371">
							<link id="e97de77a4aeb405bb25110e2d102ef36">
								<from>exception</from>
								<to>exception</to>
							</link>
						</invoke>
						<link id="4ebe0276b89c430b9d4dc9d32eea32d2">
							<from>resultf57d2860be694b509c0fd44d1455b051/summary/exceptionStack</from>
							<to>log/content</to>
						</link>
					</map>
					<map id="daaca94b0b004ed78814d1d2764ce4a3">
						<invoke id="bc28af539ab342dd915685fce979b995"
							resultName="result747601e4b6b449709764bff79738a1c9"
							serviceId="nabu.utils.List.add"
							x="165"
							y="160">
							<link id="04c3b7e3d1954e67873ef67488598910">
								<from>logs</from>
								<to>list</to>
							</link>
							<link id="6bdb21e567894fdea61c0d1dfd16c3df">
								<from>log</from>
								<to>object</to>
							</link>
						</invoke>
						<link id="2eafbb4f121f4a2aa515bf4e1ca021d5">
							<from>result747601e4b6b449709764bff79738a1c9/list</from>
							<to>logs</to>
						</link>
						<drop id="8c67d9b8b2374fa5a3d9f5f2c15d6ce7"
							path="log"/>
					</map>
				</catch>
			</sequence>
			<throw id="113e7060dfdf49d0ad84f3596bf1a758"
				features="CDM_FAIL_ON_REJECT"
				label="rejected"
				message="Rejected"/>
		</sequence>
		<sequence id="61d599c7bad648e1b095e1177243282c"
			comment="If we didn't have new metadata yet, check if we created some this iteration"
			label="!output/hasNewMetadata &amp;&amp; existingRelations != null">
			<map id="3e3d6182d10a466ea99f5b2f15934ea1"
				comment="Get amount of relations that were updated after the start of this service">
				<invoke id="c1bf92ab499a4ab785781b0794dd27d0"
					resultName="resulta5ccdde3e122448a94597bab6031eb70"
					serviceId="nabu.utils.List.size"
					x="292"
					y="188">
					<link id="4e5cd2d520ab4f13a97d36b42575662f">
						<from>existingRelations[modified != null &amp;&amp; modified &gt; date]</from>
						<to>list</to>
					</link>
				</invoke>
				<link id="3b5223422ffb42eb85ec086ad7c2c8ca">
					<from>resulta5ccdde3e122448a94597bab6031eb70/size</from>
					<to>amountOfChangedRelations</to>
				</link>
			</map>
			<map id="29b93f2518c74a57ac0f166ce22349e9"
				comment="Set to true "
				label="amountOfChangedRelations &gt; 0">
				<link id="1c31ccabe0a4442782876284e345b4ce"
					fixedValue="true">
					<from>true</from>
					<to>output/hasNewMetadata</to>
				</link>
			</map>
		</sequence>
		<query>subscriptions</query>
	</for>
	<map id="973ff9e5d7214e1898fc333ee23eab74"
		label="instanceSubscriptions">
		<invoke id="aa2f63054aa74874baa41d5989e99a55"
			resultName="resultfefc0156ccc547ac9de3704288e24200"
			serviceId="nabu.services.jdbc.Services.update"
			x="94"
			y="64">
			<link id="3c184849a70947a5a0073a124a2ae7f4">
				<from>instanceSubscriptions</from>
				<to>instances</to>
			</link>
		</invoke>
	</map>
	<map id="55b22a44404e46f3a684e8a0bf07e1a4"
		comment="Map the stopped for the sync">
		<invoke id="7ceb0ed61b434367a70b84cac0b3d63b"
			resultName="result19c939494411496aa2f85e7d09301754"
			serviceId="nabu.utils.Date.now"
			x="295"
			y="276">
		</invoke>
		<link id="53b4f645b59a4d5b9dcd79e7dfb2955f">
			<from>result19c939494411496aa2f85e7d09301754/date</from>
			<to>instanceSync/stopped</to>
		</link>
	</map>
	<map id="01fca7eadc9d4417adff5d814b3c04dd">
		<invoke id="20636b3db2f24c39bfa53a6371c21d84"
			resultName="result47b2d4ae6d8247699eaecbfe15a861a8"
			serviceId="nabu.services.jdbc.Services.insert"
			x="306"
			y="215">
			<link id="e5597656775c40afb7499c03c56156c1">
				<from>instanceSync</from>
				<to>instances[0]</to>
			</link>
		</invoke>
	</map>
	<map id="f483ce3eb03e4b0fbaa66c0e5ab6b8f3"
		label="instanceSyncDiffs">
		<invoke id="df3a6c1c27fd4fb786cb72d3faf3df3b"
			resultName="result1580698294f04cae92f5627ede6bc589"
			serviceId="nabu.services.jdbc.Services.insert"
			x="273"
			y="254">
			<link id="5d87c707981545b793f143d0b575dcc4">
				<from>instanceSyncDiffs</from>
				<to>instances</to>
			</link>
		</invoke>
	</map>
	<map id="a4335615970a434abc971065c7d8c73b"
		label="logs">
		<invoke id="c14050ce7d6f4fe285e4b280d6af1464"
			resultName="result545f30c888a14b8f83ce3c3cd30945b7"
			serviceId="nabu.services.jdbc.Services.insert"
			x="99"
			y="195">
			<link id="02b1c083978447b28bda8fd3369bbd18">
				<from>logs</from>
				<to>instances</to>
			</link>
		</invoke>
	</map>
</sequence>