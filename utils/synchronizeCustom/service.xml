<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="eaadbde488f14feeb811ae76796a61f9"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="c837627e28e643bea2619cd749b15352"
			lineNumber="2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="a9ea8bdc13d6437b9d586ef6101a8ba9"
				serviceId="nabu.frameworks.cdm.crud.cdmSystemSubscription.services.get"
				resultName="resulte8e3fb67a29e49f9858509aa259a07ae"
				temporaryMapping="true"
				x="316"
				y="101"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="82e877d7327d4f18b0bc6add0b20f7ea"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cdmSystemSubscriptionId</from>
				<to>id</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="1960a0a18a8d4b76ace0d0ab6c5ed0ce"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resulte8e3fb67a29e49f9858509aa259a07ae/result</from>
			<to>subscription</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="c073ae5cf5954b7f9abee51e0977b307"
				serviceId="nabu.utils.Date.now"
				resultName="resultf74c9b550c5b4ce59d68a9a68c6e1ecd"
				temporaryMapping="true"
				x="406"
				y="211"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="374a4875bf654d6ea08be4537c5b7889"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultf74c9b550c5b4ce59d68a9a68c6e1ecd/date</from>
			<to>started</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Break"
			disabled="false"
			id="6724575a86d1468bbe6383a9fb4192ba"
			label="subscription/batchPullId == null"
			lineNumber="3">
		<count>1</count>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Set to 100"
			disabled="false"
			id="ea2e316e562749e5b538a9a701c36418"
			label="subscription/batchPullLimit == null"
			lineNumber="4">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6eccde83f67a46baaac5948c755301e1"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>100</from>
			<to>subscription/batchPullLimit</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="6acd70c740a041ec9e096b7f98031404"
			lineNumber="5">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="c382fcec2fbf47c58ad5df7a31206f48"
				serviceId="nabu.frameworks.cdm.crud.cdmSystemBatchPull.services.list"
				resultName="resultfd642ff4fcc249a59f2163bf7732d42d"
				temporaryMapping="true"
				x="194"
				y="113"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="02b1c75d4cd84ddaa3270a30c7b65b58"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>subscription/id</from>
				<to>filter/cdmSystemSubscriptionId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="904341f1b61d4e06888af26b33840619"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>started desc</from>
				<to>orderBy[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="dc2629779544405ca611a5352aa500a5"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>1</from>
				<to>limit</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="1d59378683a74f33adc728777c700b8f"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultfd642ff4fcc249a59f2163bf7732d42d/results[0]</from>
			<to>lastRun</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
			disabled="false"
			id="89670e632508403aad03e7a70bd33628"
			label="lastRun/stopped == null"
			lineNumber="6"
			message="Run still ongoing"
			whitelist="false" xsi:nil="true"/>
	<steps xsi:type="be.nabu.libs.services.vm.step.For"
			disabled="false"
			id="57eab5a08ba94efaa00ad3c7f2fd7e2b"
			lineNumber="7"
			index="page">
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				disabled="false"
				id="554a62320a58494f858f44a1540cfd3e"
				lineNumber="8"
				scopeDefaultTransaction="true">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="963b4fd0444445279a189801564104e4"
					lineNumber="9">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="ac3ad7a67ed447c48dde457ca585e0b9"
						serviceId="nabu.frameworks.cdm.specs.batchPull"
						resultName="result85d2256b082247069c1b0bbbfdad1572"
						temporaryMapping="true"
						x="290"
						y="84"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="7c07391a03cb4be0820c05c7642381c5"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>lastRun/started</from>
						<to>lastRun</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="b5154d6e2b134691bea5ac42de9ae119"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/batchPullLimit</from>
						<to>limit</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a16084273d314c7694ca0ba82fa02d47"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>=subscription/batchPullLimit * page</from>
						<to>offset</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e5e3030ffc9c4bcbbf62bfb07fd822bc"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>subscription/batchPullId</from>
						<to>implementationId</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1146240bd0b54dfa8362d19ef3078551"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result85d2256b082247069c1b0bbbfdad1572/instances</from>
					<to>instances</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Break"
					disabled="false"
					id="5cae6b1d85c24b4ead61e900c7602519"
					label="!instances"
					lineNumber="10">
				<count>2</count>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.For"
					disabled="false"
					id="58a971ef487d47edb5dfb7687a2d001c"
					lineNumber="11"
					variable="remoteInstance">
				<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
						description="=instance"
						disabled="false"
						id="fce5f85406a84b5dac93633c41b2ea80"
						label="!remoteInstance/externalIds"
						lineNumber="12"
						code="CDM-NO-IDENTIFIERS"
						whitelist="false" xsi:nil="true"/>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Fetch existing instance"
						disabled="false"
						id="5252f8fab15e41db99737071bdf99ed0"
						lineNumber="13">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="947579df7fa54e7280bb626085aaa96e"
							serviceId="nabu.frameworks.cdm.utils.searchExternalIdSql"
							resultName="result1b739bdafff1440eb475a8f8befc58ef"
							temporaryMapping="true"
							x="139"
							y="64"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="2a0e9b26e6134c1680a9675b254da642"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>remoteInstance/externalIds</from>
							<to>externalIds</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="c1a521d8f9624efba94b1f65afd26b99"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/coreTypeId</from>
							<to>typeId</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="e6087b86e62849ea9841e9759e6d98f7"
							serviceId="nabu.services.jdbc.Services.selectDynamic"
							resultName="resultf16a6e16f6864651a0bc343dac2d44b2"
							temporaryMapping="true"
							x="564"
							y="94"
							invocationOrder="1"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="88a95f88b18c4b79910daa91878e6ef6"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result1b739bdafff1440eb475a8f8befc58ef/values</from>
							<to>properties</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="e6240ef6b73d4620955f074d91f79173"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result1b739bdafff1440eb475a8f8befc58ef/sql</from>
							<to>sql</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="24a9ee8ef74d437f8062cc56ae11db6b"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>nabu.frameworks.cdm.database.types.cdmInstance</from>
							<to>typeId</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="aeb46bdf6df94801ba96533e7a75c267"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultf16a6e16f6864651a0bc343dac2d44b2/response/results[0]</from>
						<to>localInstance</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e6ea567ac99549d7b98d58e58eb8e01f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultf16a6e16f6864651a0bc343dac2d44b2/response/rowCount</from>
						<to>amountOfMatches</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
						description="=instance"
						disabled="false"
						id="23455f961d0749d8add6f3def3cf6fc0"
						label="amountOfMatches &gt;= 2"
						lineNumber="14"
						code="CDM-MULTIPLE-MATCHES"
						whitelist="false" xsi:nil="true"/>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Create the instance"
						disabled="false"
						id="1594d9fdd5494340a99d57e88d04da64"
						label="!localInstance"
						lineNumber="15">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="9dae8a7d2dc14c9593ab94a4b6cc00c9"
							serviceId="nabu.frameworks.cdm.crud.cdmInstance.services.create"
							resultName="result1b960321de124c90857dbd01adcee950"
							temporaryMapping="true"
							x="350"
							y="103"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="3efdef01e2684aeba1089cf9334901ad"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>true</from>
							<to>instance/active</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="ea86c36108fb4b65b4c03c522198077f"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>subscription/cdmDefinitionId</from>
							<to>instance/cdmDefinitionId</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d17122488256435d8fe8fac09b2eb7b1"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result1b960321de124c90857dbd01adcee950/created</from>
						<to>localInstance</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Synchronize the external ids"
						disabled="false"
						id="deb5e1195cae46e0bf667f3e97a3ac41"
						lineNumber="16">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="04061905fa05432ab887d6d402e0a65e"
							serviceId="nabu.frameworks.cdm.utils.externalId.update"
							resultName="resultdda790f21bae433b8180710b3f7073f9"
							temporaryMapping="true"
							x="495"
							y="108"
							invocationOrder="1"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="06fb1e934c39466eab1d2f622faa2210"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>localInstance/id</from>
							<to>cdmInstanceId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="915b836d74ca4faeb9227d81217ddb4e"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result54c99ee7ff2445d385d3ca3bc0a3c0f3/results</from>
							<to>existingExternalIds</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="2bd7b27289fb47bb8816087b50b95fb4"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>remoteInstance/externalIds</from>
							<to>newExternalIds</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="2330896b896f4b4aa6ecad519ed26463"
							serviceId="nabu.frameworks.cdm.crud.cdmInstanceExternalId.services.list"
							resultName="result54c99ee7ff2445d385d3ca3bc0a3c0f3"
							temporaryMapping="true"
							x="20"
							y="53"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="02c0e032a5c542f0aa3492646c3749f6"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>localInstance/id</from>
							<to>filter/cdmInstanceId[0]</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="ce6c66c4d2dd40d6a6463a0452d8462b"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultdda790f21bae433b8180710b3f7073f9/externalIds</from>
						<to>externalIds</to>
					</steps>
				</steps>
				<query>instances</query>
			</steps>
		</steps>
		<query>true</query>
	</steps>
</sequence>